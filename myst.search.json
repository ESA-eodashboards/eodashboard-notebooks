{"version":"1","records":[{"hierarchy":{"lvl1":"Example Viewer Template"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"Example Viewer Template"},"content":"This template repository is intended to allow easy instantiation of an example viewer for jupyterlab notebooks.\nExternal repositories can be added via git submodules to the external_notebooks folder.\nThe github action will traverse available notebooks and try to extract metadata information as well as build them with Jupyterbook (v2 and MYST).\nThe build package is then deployed on github pages.","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel"},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel","position":0},{"hierarchy":{"lvl1":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel"},"content":"\n\nThis concise notebook demonstrates guidelines for submission of your projects developed under the Earth System Science Open Challenge! Please use this notebook as a template for delivering your workflow with the code you used to produce the results! For more information, refer to Open Challenge website: \n\nhttps://​eo4society​.esa​.int​/event​/sciencehubchallengefeb2024/\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel","position":1},{"hierarchy":{"lvl1":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel"},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#earth-system-science-open-challenge-1-l-jessel-s-hezzi-m-roussel","position":2},{"hierarchy":{"lvl1":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#earth-system-science-open-challenge-1-l-jessel-s-hezzi-m-roussel","position":3},{"hierarchy":{"lvl1":"1. Title "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-1-title","position":4},{"hierarchy":{"lvl1":"1. Title "},"content":"Author(s): Lucas Jessel, Sabrine Hezzi, Marie-Laure Roussel  \nGroup name: Extreme precip  \nChallenge: 1 - “Cevenols episodes” or rainfall extreme events in the South-East of France \n\nSubmission date: 01/03/2024 \n\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-1-title","position":5},{"hierarchy":{"lvl1":"2. Description "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-2-description","position":6},{"hierarchy":{"lvl1":"2. Description "},"content":"","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-2-description","position":7},{"hierarchy":{"lvl1":"2. Description ","lvl3":"Description of research approach"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#description-of-research-approach","position":8},{"hierarchy":{"lvl1":"2. Description ","lvl3":"Description of research approach"},"content":"Mediterranean events of intense rainfall can happen in late summer or in fall in the south-east of France (Cevennes, Rhone valley, Roussillon, Provence) due to warm and humid air coming from the heated sea, thanks to south-east flux mainly driven by any disturbance on France. It causes thunderstorms and heavy precipitation because of the cold air in altitude (that is explained in this region because of the topography : Massif Central, Alpes, Pyrenees). Flooding, runoff and landslides are the most important consequences of these events, due to blocked rainfall in the area.\n\nMonitoring this kind of extreme event is a massive challenge for weather forecasts models, that is why observations from space are a really great tool to help in that way.\n\nIn this study, the objective is to use observations products from space to try to detect massive rainfall events and evaluate the accuracy of the results in terms of caracteristics of the precipitation event (daily maximum value and location).\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#description-of-research-approach","position":9},{"hierarchy":{"lvl1":"3. Table of Contents "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-3-table-of-contents","position":10},{"hierarchy":{"lvl1":"3. Table of Contents "},"content":"Title\n\nDescription\n\nTable of Contents\n\nReferences\n\nKey Conclusions\n\nSocietal Context\n\nImport libraries\n\nAccess dataset\n\nAnalysis cells\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-3-table-of-contents","position":11},{"hierarchy":{"lvl1":"4. References "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-4-references","position":12},{"hierarchy":{"lvl1":"4. References "},"content":"Brocca et al. 2014. Soil as a natural rain gauge: Estimating global rainfall from satellite soil moisture data, \n\nBrocca et al. (2014).\n\nHuffman et al. 2001. Global Precipitation at One-Degree Daily Resolution from Multisatellite Observations, \n\nhttps://​doi​.org​/10​.1175​/1525​-7541(2001)002<0036:GPAODD>\n\n2.0.CO;2\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-4-references","position":13},{"hierarchy":{"lvl1":"5. Key Conclusions "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-5-key-conclusions","position":14},{"hierarchy":{"lvl1":"5. Key Conclusions "},"content":"Among the two observational datasets compared to ERA5 reanalyses, which we have taken as a reference, it emerges as a conclusion that the GPM-CPC product provides a more accurate and faithful representation of an extreme Cevenol precipitation event, such as the one studied, both for the location and the value of the maximum of precipitation.\n\nOn the contrary, the GPCP product appears to produce too little precipitation for a Mediterranean episode day and fails to reproduce the maximum precipitation at the correct location.\n\nA more in-depth analysis could be considered to account for differences in spatial resolution between the datasets, as well as to study different days over a longer period of time.\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-5-key-conclusions","position":15},{"hierarchy":{"lvl1":"6. Societal Context "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-6-societal-context","position":16},{"hierarchy":{"lvl1":"6. Societal Context "},"content":"Mediterranean episodes can be dangerous for the population due to their significant and difficult-to-predict consequences such as floods and landslides. Numerous damages need to be considered during these sometimes dramatic events.\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-6-societal-context","position":17},{"hierarchy":{"lvl1":"PART 2: SCIENTIFIC EXPLOITATION AND ANALYSIS"},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#part-2-scientific-exploitation-and-analysis","position":18},{"hierarchy":{"lvl1":"PART 2: SCIENTIFIC EXPLOITATION AND ANALYSIS"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#part-2-scientific-exploitation-and-analysis","position":19},{"hierarchy":{"lvl1":"7. Import Libraries "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-7-import-libraries","position":20},{"hierarchy":{"lvl1":"7. Import Libraries "},"content":"This notebook runs with the python environment deepesdl-xcube-1.1.2, please checkout the documentation for \n\nhelp on changing the environment.\n\nimport xcube\nfrom xcube.core.store import find_data_store_extensions\nfrom xcube.core.store import get_data_store_params_schema\nfrom xcube.core.store import new_data_store\n\nimport boto3\nfrom botocore.exceptions import NoCredentialsError\n\nimport os\nimport shapely.geometry\nfrom IPython.display import JSON\nimport numpy as np\nimport xarray as xr\n\n# for the plots\nfrom cartopy import crs as ccrs, feature as cfeature\nprojPC = ccrs.PlateCarree(central_longitude=0)\nimport matplotlib.pyplot as plt\nimport matplotlib.colors as mcolors\nimport matplotlib.ticker as ticker\n%matplotlib inline\nplt.rcParams[\"figure.figsize\"] = 16,8\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-7-import-libraries","position":21},{"hierarchy":{"lvl1":"8. Data sources "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-8-data-sources","position":22},{"hierarchy":{"lvl1":"8. Data sources "},"content":"\n\nDatacube name\n\nVariable name\n\nDescription\n\nReference*\n\nRegion\n\nTime range\n\nResolution\n\n(GPM-CPC) hydrology-1D-0.009deg-100x60x60-3.0.2.zarr\n\nprecip\n\nmetadata description\n\nlink to source\n\nsouth-east of France (40-45°N, 0-10°E)\n\ndaily\n\n0.01°\n\n(GPCP) cube_GPCP_complete_nomissingvalue_lat_1996-2022.zarr\n\nprecip\n\nmetadata description\n\nlink to source\n\nsouth-east of France (40-45°N, 0-10°E)\n\ndaily\n\n1°\n\n(ERA5) cube_tpsum.2015-2022.fs1e5.GLOBAL_025.zarr\n\ntp\n\nmetadata description\n\nlink to source\n\nsouth-east of France (40-45°N, 0-10°E)\n\ndaily\n\n0.25°\n\n# CODE SECTION\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-8-data-sources","position":23},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Setting stores variables"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#setting-stores-variables","position":24},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Setting stores variables"},"content":"\n\n# PUBLIC STORE : for GPM-CPC dataset in the hydrology cube\npublic_store = new_data_store(\"s3\", root=\"deep-esdl-public\", storage_options=dict(anon=True))\n\n# USER/TEAM STORE : for GPCP and ERA5 datasets in the \"homemade\" cubes\nS3_USER_STORAGE_KEY = os.environ[\"S3_USER_STORAGE_KEY\"]\nS3_USER_STORAGE_SECRET = os.environ[\"S3_USER_STORAGE_SECRET\"]\nS3_USER_STORAGE_BUCKET = os.environ[\"endpoint\"]\nuser_store = new_data_store(\"s3\", max_depth=3, root=S3_USER_STORAGE_BUCKET,storage_options=dict(anon=False, key=S3_USER_STORAGE_KEY,secret=S3_USER_STORAGE_SECRET))\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#setting-stores-variables","position":25},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting GPM-CPC SM2RAIN ASCAT Dataset (from hydrology cube)"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-gpm-cpc-sm2rain-ascat-dataset-from-hydrology-cube","position":26},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting GPM-CPC SM2RAIN ASCAT Dataset (from hydrology cube)"},"content":"\n\nhydro_cube = public_store.open_data('hydrology-1D-0.009deg-100x60x60-3.0.2.zarr')\nprecip_data_hydro=hydro_cube['precip']\nprecip_data_hydro\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-gpm-cpc-sm2rain-ascat-dataset-from-hydrology-cube","position":27},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting GPCP Dataset"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-gpcp-dataset","position":28},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting GPCP Dataset"},"content":"\n\ngpcp_cube = user_store.open_data('cube_GPCP_complete_nomissingvalue_lat_1996-2022.zarr')\nprecip_data_gpcp = gpcp_cube['precip']\nprecip_data_gpcp\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-gpcp-dataset","position":29},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting ERA5 Dataset"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-era5-dataset","position":30},{"hierarchy":{"lvl1":"8. Data sources ","lvl4":"Extracting ERA5 Dataset"},"content":"\n\nera_cube = user_store.open_data('cube_tpsum.2015-2022.fs1e5.GLOBAL_025.zarr')\nprecip_data_era = era_cube['tp']*3600. # convert mm/s to mm/d \nprecip_data_era\n\n\n\n\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#extracting-era5-dataset","position":31},{"hierarchy":{"lvl1":"9. Analysis cells "},"type":"lvl1","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-analysis-cells","position":32},{"hierarchy":{"lvl1":"9. Analysis cells "},"content":"\n\n# defining some coordinates inside the region of interest\n\nlat1=45 ; lon1=5\nlat2=45 ; lon2=7\nlat3=43 ; lon3=3\nlat4=44 ; lon4=7\nlat5=44 ; lon5=4\nlat6=44 ; lon6=5\nlat7=44 ; lon7=6\nlat8=44 ; lon8=3\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-analysis-cells","position":33},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.1) Plots of the long-term time-series"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-plots-of-the-long-term-time-series","position":34},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.1) Plots of the long-term time-series"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-plots-of-the-long-term-time-series","position":35},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.1) From the hydrology cube :","lvl3":"9.1) Plots of the long-term time-series"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-1-from-the-hydrology-cube","position":36},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.1) From the hydrology cube :","lvl3":"9.1) Plots of the long-term time-series"},"content":"\n\n# selecting local precipitation data\n\nprecip_point1 = precip_data_hydro.sel(lat=lat1, lon=lon1, method='nearest')\nprecip_point2 = precip_data_hydro.sel(lat=lat2, lon=lon2, method='nearest')\nprecip_point3 = precip_data_hydro.sel(lat=lat3, lon=lon3, method='nearest')\nprecip_point4 = precip_data_hydro.sel(lat=lat4, lon=lon4, method='nearest')\nprecip_point5 = precip_data_hydro.sel(lat=lat5, lon=lon5, method='nearest')\nprecip_point6 = precip_data_hydro.sel(lat=lat6, lon=lon6, method='nearest')\nprecip_point7 = precip_data_hydro.sel(lat=lat7, lon=lon7, method='nearest')\nprecip_point8 = precip_data_hydro.sel(lat=lat8, lon=lon8, method='nearest')\n\nplt.figure(figsize=(20, 6))\nprecip_point1.plot(marker='o', linestyle='-',color='blue')\nprecip_point2.plot(marker='o', linestyle='-',color='red')\nprecip_point3.plot(marker='o', linestyle='-',color='green')\nprecip_point4.plot(marker='o', linestyle='-',color='yellow')\nprecip_point5.plot(marker='o', linestyle='-',color='purple')\nprecip_point6.plot(marker='o', linestyle='-',color='cyan')\nprecip_point7.plot(marker='o', linestyle='-',color='magenta')\nprecip_point8.plot(marker='o', linestyle='-',color='orange')\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.title('Precipitation from GPM-CPC SM2RAIN-ASCAT (hydrology cube)')\nplt.grid(True)\nplt.show()\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-1-from-the-hydrology-cube","position":37},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.2) From the GPCP cube :","lvl3":"9.1) Plots of the long-term time-series"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-2-from-the-gpcp-cube","position":38},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.2) From the GPCP cube :","lvl3":"9.1) Plots of the long-term time-series"},"content":"\n\n# selecting local precipitation data\nprecip_point1 = precip_data_gpcp.sel(latitude=lat1, longitude=lon1, method='nearest')\nprecip_point2 = precip_data_gpcp.sel(latitude=lat2, longitude=lon2, method='nearest')\nprecip_point3 = precip_data_gpcp.sel(latitude=lat3, longitude=lon3, method='nearest')\nprecip_point4 = precip_data_gpcp.sel(latitude=lat4, longitude=lon4, method='nearest')\nprecip_point5 = precip_data_gpcp.sel(latitude=lat5, longitude=lon5, method='nearest')\nprecip_point6 = precip_data_gpcp.sel(latitude=lat6, longitude=lon6, method='nearest')\nprecip_point7 = precip_data_gpcp.sel(latitude=lat7, longitude=lon7, method='nearest')\nprecip_point8 = precip_data_gpcp.sel(latitude=lat8, longitude=lon8, method='nearest')\n\nplt.figure(figsize=(20, 6))\nprecip_point1.plot(marker='o', linestyle='-',color='blue')\nprecip_point2.plot(marker='o', linestyle='-',color='red')\nprecip_point3.plot(marker='o', linestyle='-',color='green')\nprecip_point4.plot(marker='o', linestyle='-',color='yellow')\nprecip_point5.plot(marker='o', linestyle='-',color='purple')\nprecip_point6.plot(marker='o', linestyle='-',color='cyan')\nprecip_point7.plot(marker='o', linestyle='-',color='magenta')\nprecip_point8.plot(marker='o', linestyle='-',color='orange')\n\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.ylim(0,80)\nplt.title('Precipitation from GPCP')\nplt.grid(True)\nplt.show()\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-2-from-the-gpcp-cube","position":39},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.3) From the ERA5 cube :","lvl3":"9.1) Plots of the long-term time-series"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-3-from-the-era5-cube","position":40},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.1.3) From the ERA5 cube :","lvl3":"9.1) Plots of the long-term time-series"},"content":"\n\n# selecting local precipitation data\n\nprecip_point1 = precip_data_era.sel(latitude=lat1, longitude=lon1, method='nearest')\nprecip_point2 = precip_data_era.sel(latitude=lat2, longitude=lon2, method='nearest')\nprecip_point3 = precip_data_era.sel(latitude=lat3, longitude=lon3, method='nearest')\nprecip_point4 = precip_data_era.sel(latitude=lat4, longitude=lon4, method='nearest')\nprecip_point5 = precip_data_era.sel(latitude=lat5, longitude=lon5, method='nearest')\nprecip_point6 = precip_data_era.sel(latitude=lat6, longitude=lon6, method='nearest')\nprecip_point7 = precip_data_era.sel(latitude=lat7, longitude=lon7, method='nearest')\nprecip_point8 = precip_data_era.sel(latitude=lat8, longitude=lon8, method='nearest')\n\nplt.figure(figsize=(20, 6))\nprecip_point1.plot(marker='o', linestyle='-',color='blue')\nprecip_point2.plot(marker='o', linestyle='-',color='red')\nprecip_point3.plot(marker='o', linestyle='-',color='green')\nprecip_point4.plot(marker='o', linestyle='-',color='yellow')\nprecip_point5.plot(marker='o', linestyle='-',color='purple')\nprecip_point6.plot(marker='o', linestyle='-',color='cyan')\nprecip_point7.plot(marker='o', linestyle='-',color='magenta')\nprecip_point8.plot(marker='o', linestyle='-',color='orange')\n\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.title('Precipitation from ERA5')\nplt.grid(True)\nplt.show()\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-1-3-from-the-era5-cube","position":41},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.2) Filtering => minicube selection on the studied region"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-filtering-minicube-selection-on-the-studied-region","position":42},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.2) Filtering => minicube selection on the studied region"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-filtering-minicube-selection-on-the-studied-region","position":43},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.1) On the hydrology cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-1-on-the-hydrology-cube","position":44},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.1) On the hydrology cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"content":"\n\nlatm=43; latM=45; lonm=2.5; lonM=8  \n\nhydro_region_precip = hydro_cube['precip'].sel(lat=slice(latM,latm), lon = slice(lonm,lonM))\nhydro_region_precip\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-1-on-the-hydrology-cube","position":45},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.2) On the GPCP cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-2-on-the-gpcp-cube","position":46},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.2) On the GPCP cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"content":"\n\ngpcp_region_precip = gpcp_cube['precip'].sel(latitude=slice(latm,latM), longitude= slice(lonm,lonM))\ngpcp_region_precip\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-2-on-the-gpcp-cube","position":47},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.3) On the ERA5 cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-3-on-the-era5-cube","position":48},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.2.3) On the ERA5 cube","lvl3":"9.2) Filtering => minicube selection on the studied region"},"content":"\n\nera_region_precip = era_cube['tp'].sel(latitude=slice(latM,latm), longitude= slice(lonm,lonM))\nera_region_precip \n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-2-3-on-the-era5-cube","position":49},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-searching-the-maximum-values-at-each-grid-point-for-the-whole-time-serie","position":50},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-searching-the-maximum-values-at-each-grid-point-for-the-whole-time-serie","position":51},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.3.1) compute the maximum values on the region during the whole time-serie for each grid cell","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-1-compute-the-maximum-values-on-the-region-during-the-whole-time-serie-for-each-grid-cell","position":52},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.3.1) compute the maximum values on the region during the whole time-serie for each grid cell","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"content":"\n\nhydro_region_precip_max = hydro_region_precip.max(dim = ['time'])\n\ngpcp_region_precip_max = gpcp_cube['precip'].max(dim = ['time'])\n\nera_region_precip_max = era_region_precip.max(dim = ['time'])\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-1-compute-the-maximum-values-on-the-region-during-the-whole-time-serie-for-each-grid-cell","position":53},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.3.2) Searching the days of massive precip events","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-2-searching-the-days-of-massive-precip-events","position":54},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.3.2) Searching the days of massive precip events","lvl3":"9.3) Searching the maximum values at each grid point for the whole time-serie"},"content":"\n\n# defining the threshold matrix (maximum values to consider extreme events) \n# applying to datasets to find dates (where the daily precip > threshold)\n\nhydro_threshold = 0.99 * hydro_region_precip_max  \nhydro_dates_sup_threshold = hydro_region_precip['time'].where(hydro_region_precip >= hydro_threshold)\nhydro_tt = hydro_dates_sup_threshold.dropna(dim='time', how='all')\n\ngpcp_threshold = 0.99 * gpcp_region_precip_max  \ngpcp_dates_sup_threshold = gpcp_region_precip['time'].where(gpcp_cube['precip'] >= gpcp_threshold)\ngpcp_tt = gpcp_dates_sup_threshold.dropna(dim='time', how='all')\n\nera_threshold = 0.99 * era_region_precip_max \nera_dates_sup_threshold = era_region_precip['time'].where(era_cube['tp'] >= era_threshold)\nera_tt = era_dates_sup_threshold.dropna(dim='time', how='all')\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-3-2-searching-the-days-of-massive-precip-events","position":55},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl2","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-we-select-the-2nd-of-october-2020-detected-by-gpm-cpc-and-gpcp","position":56},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-we-select-the-2nd-of-october-2020-detected-by-gpm-cpc-and-gpcp","position":57},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.4) Maps of the daily precipitation for the three datasets on that particular day","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-4-maps-of-the-daily-precipitation-for-the-three-datasets-on-that-particular-day","position":58},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.4) Maps of the daily precipitation for the three datasets on that particular day","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\nhydro_xtrem_precip_20201002 = hydro_cube['precip'].sel(time='2020-10-02') \n\nfig = plt.figure()\nax = plt.axes(projection = projPC)\nim = ax.pcolormesh(hydro_xtrem_precip_20201002.lon, hydro_xtrem_precip_20201002.lat, hydro_xtrem_precip_20201002.values)\nax.set_extent([lonm, lonM, latm, latM], crs=projPC)\ngl = ax.gridlines(draw_labels=True, linewidth=0, alpha=0.5)\n\nax.coastlines()          \nax.add_feature(cfeature.LAND)\nax.add_feature(cfeature.COASTLINE)\nax.add_feature(cfeature.LAKES, alpha=0.5)\nax.add_feature(cfeature.RIVERS)\ncbar = plt.colorbar(im, label='precipitation (mm/d)',  extend='max', anchor=(0.2, 0.5), shrink=0.6, aspect=20)  # ajout de la colorbar\nax.set_title('Total precipitation (mm) on the south-east of France on the 02/10/2020 - from GPM-CPC dataset') \n\ngpcp_xtrem_precip_20201002 = gpcp_region_precip.sel(time='2020-10-02', latitude=slice(latm,latM)) \n\n# Define a normalization instance for the colorbar (not used here)\nnorm1 = mcolors.TwoSlopeNorm(vmin=0, vcenter=131.45/2, vmax=131.45)\n\nfig = plt.figure()\nax = plt.axes(projection = projPC)\nim = ax.pcolormesh(gpcp_xtrem_precip_20201002.longitude, gpcp_xtrem_precip_20201002.latitude, gpcp_xtrem_precip_20201002.values)#, norm=norm1)\nax.set_extent([lonm, lonM, latm, latM], crs=projPC)\ngl = ax.gridlines(draw_labels=True, linewidth=0, alpha=0.5)\n\nax.coastlines()          \nax.add_feature(cfeature.LAND)\nax.add_feature(cfeature.COASTLINE)\nax.add_feature(cfeature.LAKES, alpha=0.5)\nax.add_feature(cfeature.RIVERS)\ncbar = plt.colorbar(im, label='precipitation (mm/d)',  extend='max', anchor=(0.2, 0.5), shrink=0.6, aspect=20) \nax.set_title('Total precipitation (mm) on the south-east of France on the 02/10/2020 - from GPCP dataset')\n\nera_xtrem_precip_20201002 = 3600.*era_region_precip.sel(time='2020-10-02')[0] \n\n# Define a normalization instance for the colorbar (not used here)\nnorm2 = mcolors.TwoSlopeNorm(vmin=0, vcenter=131.45/2, vmax=131.45)\n\nfig = plt.figure()\nax = plt.axes(projection = projPC)\nim = ax.pcolormesh(era_xtrem_precip_20201002.longitude, era_xtrem_precip_20201002.latitude, era_xtrem_precip_20201002.values)#, norm=norm2)\nax.set_extent([lonm, lonM, latm, latM], crs=projPC)\ngl = ax.gridlines(draw_labels=True, linewidth=0, alpha=0.5)\n\nax.coastlines()          \nax.add_feature(cfeature.LAND)\nax.add_feature(cfeature.COASTLINE)\nax.add_feature(cfeature.LAKES, alpha=0.5)\nax.add_feature(cfeature.RIVERS)\ncbar = plt.colorbar(im, label='precipitation (mm/d)',  extend='max', anchor=(0.2, 0.5), shrink=0.6, aspect=20)  # ajout de la colorbar\nax.set_title('Total precipitation (mm) on the south-east of France on the 02/10/2020 - from ERA5 dataset')\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-4-maps-of-the-daily-precipitation-for-the-three-datasets-on-that-particular-day","position":59},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl3","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-quantity-and-location-of-the-maximum-of-precipitation-refined-time-serie-around-the-event","position":60},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-quantity-and-location-of-the-maximum-of-precipitation-refined-time-serie-around-the-event","position":61},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.1) On the hydrology cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-1-on-the-hydrology-cube","position":62},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.1) On the hydrology cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\n# maximum value and index of latitude and longitude of the maximum\n\nprint('FOR GPM-CPC')\nprint('maximum value: (mm/d)', np.nanmax(hydro_xtrem_precip_20201002))\nprint('index for latitude and longitude of the maximum: ', np.where(hydro_xtrem_precip_20201002 == np.nanmax(hydro_xtrem_precip_20201002)))\nhydro_xtrem_precip_20201002.isel(lat=446, lon=1487) \n\n### time serie around the 2nd of october 2020, at the grid cell of the maximum value\n\nlat_hydro=44.16 ; lon_hydro=7.687\n\nprecip_point_hydro = precip_data_hydro.sel(lat=lat_hydro, lon=lon_hydro, method='nearest')\nprecip_point_hydro1 = precip_point_hydro.sel(time=slice('2020-09-30', '2020-10-06'))\n\nplt.figure(figsize=(8, 4))\nplt.bar(precip_point_hydro1.time.values, precip_point_hydro1.values, width=0.1, color='blue', align='center')\nplt.title('Precipitation from GPM CPC SM2RAIN-ASCAT (hydrology cube)')\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.xticks(rotation=45, ha='right')\nplt.grid(True)\nplt.tight_layout()\nplt.show()\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-1-on-the-hydrology-cube","position":63},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.2) On the GPCP cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-2-on-the-gpcp-cube","position":64},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.2) On the GPCP cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\n# maximum value and index of latitude and longitude of the maximum\n\nprint('FOR GPCP')\nprint('maximum value: (mm/d)', np.nanmax(gpcp_xtrem_precip_20201002))\nprint('index for latitude and longitude of the maximum: ', np.where(gpcp_xtrem_precip_20201002 == np.nanmax(gpcp_xtrem_precip_20201002)))\n\ngpcp_xtrem_precip_20201002.isel(latitude=2, longitude=5) \n\n### time serie around the 2nd of october 2020, at the grid cell of the maximum value\n\nlat_gpcp= 45 ; lon_gpcp= 8\n\nprecip_point_gpcp = precip_data_gpcp.sel(latitude=lat_gpcp, longitude=lon_gpcp, method='nearest')\nprecip_point_gpcp1 = precip_point_gpcp.sel(time=slice('2020-09-30', '2020-10-06'))\n\nplt.figure(figsize=(8, 4))\nplt.bar(precip_point_gpcp1.time.values, precip_point_gpcp1.values, width=0.1, color='blue', align='center')\nplt.title('Precipitation from GPCP')\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.xticks(rotation=45, ha='right')\nplt.grid(True)\nplt.tight_layout()\nplt.show()\n\n","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-2-on-the-gpcp-cube","position":65},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.3) On the ERA5 cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"type":"lvl4","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-3-on-the-era5-cube","position":66},{"hierarchy":{"lvl1":"9. Analysis cells ","lvl4":"9.5.3) On the ERA5 cube","lvl3":"9.5) Quantity and location of the maximum of precipitation (+ refined time-serie around the event)","lvl2":">>> We select the 2nd of october 2020 (detected by GPM-CPC and GPCP)"},"content":"\n\nprint('FOR ERA5')\nprint('maximum value: (mm/d)', np.nanmax(era_xtrem_precip_20201002))\nprint('index for latitude and longitude of the maximum: ', np.where(era_xtrem_precip_20201002 == np.nanmax(era_xtrem_precip_20201002)))\n\nlat_era= 44; lon_era= 7\n\nprecip_point_era = 3600.0*era_cube['tp'].sel(latitude=lat_era, longitude=lon_era, method='nearest')\nprecip_point_era1 = precip_point_era.sel(time=slice('2020-09-30', '2020-10-06'))\n\nplt.figure(figsize=(8, 4))\nplt.bar(precip_point_era1.time.values, precip_point_era1.values, width=0.1, color='blue', align='center')\nplt.title('Precipitation from ERA5')\nplt.xlabel('Day')\nplt.ylabel('Daily rainfall (mm/d)')\nplt.xticks(rotation=45, ha='right')\nplt.grid(True)\nplt.tight_layout()\nplt.show()","type":"content","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel#id-9-5-3-on-the-era5-cube","position":67},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps"},"type":"lvl1","url":"/notebooks/nightlights-notebook/night-lights-blending","position":0},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps"},"content":"","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending","position":1},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps"},"type":"lvl1","url":"/notebooks/nightlights-notebook/night-lights-blending#monitoring-socio-economic-activities-with-nighttime-light-maps","position":2},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps"},"content":"","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#monitoring-socio-economic-activities-with-nighttime-light-maps","position":3},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Case study: Creating nighttime light maps with color blending"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#case-study-creating-nighttime-light-maps-with-color-blending","position":4},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Case study: Creating nighttime light maps with color blending"},"content":"\n\nThis notebook demonstrates how to create nighttime light variation maps over a time interval (from 2019 to 2022) with additive color blending for studying the distribution of artificial lighting in urban and rural regions, offering insights into urbanization, infrastructure development, and socio-economic activity.\nThe Nighttime Light Levels indicator can be explored on the EO Dashboard by selecting the EXPLORE DATASETS mode and choosing \n\nNight lights indicators.\n\nThe study has been carried out by Bumpei Tojo PhD (Associate Professor), School of International and Area Studies, Tokyo University of Foreign Studies, Japan.\n\nThe PLES Engineering team (supporting ESA Green Solutions Division, EOP-SG) developed the blending algorithm with the current Notebook implementation and data ingestion on the dashboard (contacts: Federico Rondoni, \n\nf​.rondoni@stariongroup​.eu, Diego Moglioni, \n\nd​.moglioni@stariongroup​.eu).\n\n\nExample of a nighttime light map covering Northeastern United States during 2019-2022, representing areas where a decrease in nighttime light level occurred (indicating a presumed reduction in social activity) in red, and areas where an increase occurred (indicating a presumed increase in social activity) in blue.\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#case-study-creating-nighttime-light-maps-with-color-blending","position":5},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Input data:"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#input-data","position":6},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Input data:"},"content":"This product was developed by JAXA by aggregating the data from the Visible Infrared Imaging Radiometer Suite (VIIRS, onboard the Suomi NPP satellite) on a semi-annual basis (using median image generation) with 10-degree lat/lon (geographic) grid h-v tile as Geo Tiff files.\n\nThe tiles are 2400 x 2400 pixels, with pixel size of 0.004166 degrees (~464 m at the equator).\n\nMetric: nighttime radiance (measured in watts per square centimeter per steradian, [W/cm²/sr]), which represents the brightness of artificial lighting.\n\nVIIRS 10-degree tile scheme\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#input-data","position":7},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Running environment:"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#running-environment","position":8},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Running environment:"},"content":"This notebook can be run by installing the provided Anaconda Python environment (data/Nightlights/nightlights-env.yml).\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#running-environment","position":9},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Importing Python libraries"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#importing-python-libraries","position":10},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Importing Python libraries"},"content":"\n\n#Import libraries\nimport os\nimport sys\nimport re\nimport numpy as np\nimport rasterio\nimport rioxarray as rxr\nimport subprocess\nfrom subprocess import Popen, PIPE\nimport tempfile\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nfrom PIL import Image\nimport json\nfrom ipyleaflet import Map, ImageOverlay, basemaps\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#importing-python-libraries","position":11},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Defining working folders"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#defining-working-folders","position":12},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Defining working folders"},"content":"\n\ninput_dir = \"input\"\ninput_path = os.path.join(os.getcwd(), \"data\", \"Nightlights\", input_dir)\n\noutput_urban = \"output\"\nurban_path = os.path.join(os.getcwd(), \"data\", \"Nightlights\", output_urban)\n\n# Create output dir\nos.makedirs(urban_path, exist_ok=True)\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#defining-working-folders","position":13},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Visualizing input data"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#visualizing-input-data","position":14},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Visualizing input data"},"content":"\n\npattern = re.compile(r\"h(\\d+)v(\\d+)_(\\d{4})_(\\d)H_median\\.tif\")\n\nfor root, _, files in os.walk(input_path):\n    grouped_files = {}\n    \n    # Grouping files by h and v\n    for file in files:\n        match = pattern.match(file)\n        if match:\n            h, v, year, H = match.groups()\n            key = (h, v)\n            if key not in grouped_files:\n                grouped_files[key] = []\n            grouped_files[key].append((year, H, os.path.join(root, file))) \n    \n    # Process files for plotting\n    for (h, v), file_group in grouped_files.items():\n        file_group\n\ntuplelist2dict = {c:{'year':a,'half':b} for a,b,c in file_group}\nsorted_dict = {}\n\ngrid_tile = None\nfor item in sorted(tuplelist2dict, key = lambda k: (tuplelist2dict[k]['year'], tuplelist2dict[k]['half'])):\n    sorted_dict.update({item:tuplelist2dict[item]})\n    grid_tile = item.split('/')[-1].split('_')[0]\n\n\ndef plot_figures(figures, nrows = 1, ncols=1, factor = 1., clip_range = None, **kwargs):\n    fig, axeslist = plt.subplots(ncols=ncols, nrows=nrows, figsize=(15, 15))\n    for idx,file_name in enumerate(figures):\n        title = file_name.split('/')[-1]\n        title = title.replace(\"_median.tif\", \"\")\n        axeslist.ravel()[idx].imshow(np.clip(mpimg.imread(file_name)*factor, *clip_range), **kwargs) # cmap=plt.gray(), cmap='Greys'\n        axeslist.ravel()[idx].set_title(title)\n        axeslist.ravel()[idx].set_axis_off()\n    fig.suptitle(r'Median nighttime light level [$Wcm^{-2}sr^{-1}$]', fontsize=20)\n    #plt.tight_layout() \n\n    \n\nplot_figures(sorted_dict, 4, 2, clip_range=(0,1), factor=100./255.)\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#visualizing-input-data","position":15},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Applying color blending"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#applying-color-blending","position":16},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Applying color blending"},"content":"\n\nAdditive color blending involves mixing the primary colors of light, red (R), green (G), and blue (B), while adjusting their luminance levels. By manipulating the luminance of these colors, a wide range of hues can be achieved, with the key characteristic being that combining all three colors results in white.\n\nTechnique\n\nmaximum pixel value of images for 2019 (brightest pixel values) is assigned to red (R)\n\nminimum pixel value of images for 2020-2021 (darkest pixel values) is assigned to green (G)\n\nmaximum pixel value of images for 2022 (brightest pixel values) is assigned to blue (B)\n\nOutput\n\nregions where a decrease in nighttime light level occurred are displayed in red\n\nareas that experienced an increase (presumed to indicate an increase in social activity) are shown in blue\n\nregions where there was no significant change throughout the pandemic are displayed in a gradient from gray to white.\n\npattern = re.compile(r\"h(\\d+)v(\\d+)_(\\d{4})_(\\d)H_median\\.tif\")\n\n\ndef read_and_preprocess(file):\n    with rasterio.open(file) as src:\n        img = src.read(1)\n        img = np.nan_to_num(img, nan=0)  # Replace NaNs with zeros\n        return img, src.profile\n\n    \ndef additive_blending(grouped_files):\n    # Process each group of files for blending\n    for (h, v), file_group in grouped_files.items():\n        # Initialize arrays to store the maximum and minimum values for each year\n        max_2019 = None\n        min_2020_2021 = None\n        max_2022 = None\n        \n        for year, H, file in file_group:\n            img, profile = read_and_preprocess(file)\n            \n            if year == '2019':\n                if max_2019 is None:\n                    max_2019 = img\n                else:\n                    max_2019 = np.maximum(max_2019, img)\n            elif year in ['2020', '2021']:\n                if min_2020_2021 is None:\n                    min_2020_2021 = img\n                else:\n                    min_2020_2021 = np.minimum(min_2020_2021, img)\n            elif year == '2022':\n                if max_2022 is None:\n                    max_2022 = img\n                else:\n                    max_2022 = np.maximum(max_2022, img)\n                                  \n    # Create the blended image using the specified blending technique\n    blended_img = np.zeros((max_2019.shape[0], max_2019.shape[1], 3), dtype=np.float32)\n    blended_img[:, :, 0] = max_2019.astype(np.float32)  # Red band: maximum of 2019\n    blended_img[:, :, 1] = min_2020_2021.astype(np.float32)  # Green band: minimum of 2020-2021 compared\n    blended_img[:, :, 2] = max_2022.astype(np.float32)  # Blue band: maximum of 2022\n    \n    return blended_img, profile        \n\n# Grouping files per (h,v) tiles and years span\ngrouped_files = {}\nfor root, _, files in os.walk(input_path):\n    \n    \n    # Group files by h and v\n    for file in files:\n        match = pattern.match(file)\n        if match:\n            h, v, year, H = match.groups()\n            key = (h, v)\n            if key not in grouped_files:\n                grouped_files[key] = []\n            grouped_files[key].append((year, H, os.path.join(root, file)))\n\n\n# blending           \nblended_img, profile = additive_blending(grouped_files)\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#applying-color-blending","position":17},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Employing “urban” stretch processing"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#employing-urban-stretch-processing","position":18},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Employing “urban” stretch processing"},"content":"\n\nThe purpose of the stretch processing is to emphasize the nighttime light level of each band (corresponding to 2019, 2020-21, and 2022), focusing on:\n\n“urban” nighttime light levels: the display range of each band is adjusted to 25-1000 [watts·cm-2·sr-1], emphasizing brighter areas\n\n# Urban stretch processing: Emphasize brighter areas\ndef urban_stretch_processing(band):\n    min_val = 25\n    max_val = 1000\n    band = np.clip(band, min_val, max_val)\n    band = (band - min_val) / (max_val - min_val) * 255\n    return band.astype(np.uint8)\n\n# Apply urban stretch processing to each band\nblended_img[:, :, 0] = urban_stretch_processing(blended_img[:, :, 0])\nblended_img[:, :, 1] = urban_stretch_processing(blended_img[:, :, 1])\nblended_img[:, :, 2] = urban_stretch_processing(blended_img[:, :, 2])\n        \n# Update the profile for a 3-band image and set nodata value to None\nprofile.update(count=3, dtype=rasterio.uint8, nodata=None)\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#employing-urban-stretch-processing","position":19},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Plotting blended image"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#plotting-blended-image","position":20},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Plotting blended image"},"content":"\n\ndef plot_image(image, factor=1.0, clip_range = None, **kwargs):\n    fig, ax = plt.subplots(nrows=1, ncols=1, figsize=(15, 15))\n    if clip_range is not None:\n        ax.imshow(np.clip(image * factor, *clip_range), **kwargs)\n    else:\n        ax.imshow(image * factor, **kwargs)\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n\nplot_image(blended_img, factor=1.5/255., clip_range=(0,1))\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#plotting-blended-image","position":21},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Overlaying with an interactive map"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#overlaying-with-an-interactive-map","position":22},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Overlaying with an interactive map"},"content":"\n\nSaving blended image as Cloud Optimized GeoTIFF\n\n# Exporting output as COG file \nres_name = f\"Nighttimelevel_Urban_{grid_tile}_2019-2022.tif\"\noutput_cog = os.path.join(output_urban, res_name)\n\n\n# Write the blended image directly to a temporary file\nwith tempfile.NamedTemporaryFile(suffix=\".tif\") as temp_file:\n    with rasterio.open(temp_file.name, \"w\", **profile) as dst:\n        dst.write(blended_img[:, :, 0], 1)\n        dst.write(blended_img[:, :, 1], 2)\n        dst.write(blended_img[:, :, 2], 3)\n\n    subprocess.run([\n        \"gdal_translate\", \"-of\", \"COG\",\n        \"-co\", \"COMPRESS=DEFLATE\",\n        \"-co\", \"BLOCKSIZE=512\",\n        \"-co\", \"RESAMPLING=NEAREST\",\n        \"-co\", \"OVERVIEWS=IGNORE_EXISTING\",\n        temp_file.name,\n        output_cog\n    ])\n\nprint(f\"COG file saved as {output_cog}\")\n\nExtracting bounding-box coordinates\n\np1 = Popen([\"gdalinfo\", \"-json\", output_cog, \"-mm\"], stdout=PIPE)\noutput = p1.communicate()[0]\ndec_out = output.decode('utf-8')\nj_str = json.loads(dec_out)\nbbox = j_str['cornerCoordinates']\nll = bbox['lowerLeft']  # SW coo\nur = bbox['upperRight'] # NE coo\ncenter = bbox['center']\n\nAdding alpha channel to the blended image\n\ndef almostEquals(a,b,thres=50):\n    return all(abs(a[i]-b[i])<thres for i in range(len(a)))\n\n\nimage = Image.open(output_cog).convert('RGBA')\npixeldata = list(image.getdata())\n\n\nfor i,pixel in enumerate(pixeldata):\n    if almostEquals(pixel[:3], (0,0,0)):\n        pixeldata[i] = (0,0,0,0)\n\n\nimage.putdata(pixeldata)\npng_path = os.path.join(output_urban, res_name.replace(\".tif\",\".png\"))\nres = image.save(png_path)\n#os.path.abspath(res)\nabs_path = os.path.abspath(png_path)\nwork_dir = os.getcwd()\nid_ = work_dir.split('/')[2]\nbase_url = os.path.join('https://hub.eox.at/user',id_,'files')\n#base_url\nabs_path = '/'.join(abs_path.split('/')[3:])\n#abs_path\n#os.path.join(base_url,abs_path)\n\nOverlay with OpenStreetMap\n\nm = Map(basemap=basemaps.CartoDB.DarkMatter, center=(center[1], center[0]), zoom=6)\nimage = ImageOverlay(\n        url=os.path.join(base_url,abs_path), #url=\"https://hub.eox.at/user/<id>/files/<path_to_png>\n        bounds=((ll[1], ll[0]), (ur[1], ur[0])) # SW and NE corners\n                    )\nm.add_layer(image);\nm\n\nUsing additive color blending images to focus on urban areas in the northeastern United States, particularly the southern part of the Boston-Washington Corridor comprising major cities like New York, Philadelphia, Baltimore, and Washington, D.C., revealed relatively little variation in nighttime lights before and after the COVID-19 pandemic, as indicated by the images appearing white. However, significant reductions in nighttime lights during the COVID-19 pandemic (subsequently recovering to pre-pandemic levels) were evident in other medium to large cities, including Boston and Toronto, among others, as indicated by the images appearing pink to reddish.\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#overlaying-with-an-interactive-map","position":23},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Alternative stretch processing approaches"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#alternative-stretch-processing-approaches","position":24},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Alternative stretch processing approaches"},"content":"\n\n“Rural” nighttime light levels: setting each band’s display range to 0-50 [Watts·cm-2·sr-1] to emphasize darker areas\n\nFor a broader focus (from rural to urban areas): applying a log10 transformation to the values of each band with a display range set to 0-3.6 (equivalent to 0-3981 [Watts·cm-2·sr-1])\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#alternative-stretch-processing-approaches","position":25},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Final remarks"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#final-remarks","position":26},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"Final remarks"},"content":"\n\nThis product has been specifically designed for utilization by researchers in applied scientific fields.\nPotential applications are being explored in environmental and social issue studies, such as disaster recovery, energy, urban land use changes, conflicts, migration, and monitoring of illegal, unreported activities.\n\n","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#final-remarks","position":27},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"To learn more"},"type":"lvl2","url":"/notebooks/nightlights-notebook/night-lights-blending#to-learn-more","position":28},{"hierarchy":{"lvl1":"Monitoring socio-economic activities with nighttime light maps","lvl2":"To learn more"},"content":"\n\nThe presented approach is often referenced in scientific and public health research. For example, Bunpei Tojo (2021) used Nightlights data in the study “Application of Earth observation satellite data to public health: Comparison of night light (VIIRS) and solar radiation (SGLI) and domestic COVID-19 epidemic,” presented at the 12th Federation of Science and Technology conference, to analyze the relationship between nighttime light intensity and public health factors.\n\n\n東城 (2021).","type":"content","url":"/notebooks/nightlights-notebook/night-lights-blending#to-learn-more","position":29}]}