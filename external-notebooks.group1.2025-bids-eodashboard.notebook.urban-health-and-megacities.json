{"version":2,"kind":"Notebook","sha256":"bb27a5e9a2f97c783b2a2fcb8d3aa0fdafbe9080a3884b219f824c58f45b28dd","slug":"external-notebooks.group1.2025-bids-eodashboard.notebook.urban-health-and-megacities","location":"/external_notebooks/group1/2025-BiDS-EODashboard/notebook/Urban_Health_and_Megacities.ipynb","dependencies":[],"frontmatter":{"title":"URBAN HEALTH AND MEGACITIES: THE CASE OF NEW DELHI","content_includes_title":true,"kernelspec":{"name":"conda-env-eodashboardtutorial-eodashboardtutorial-tutorial-dashboards-py","display_name":"eodashboardtutorial-eodashboardtutorial-tutorial-dashboards","language":"python"},"github":"https://github.com/ESA-eodashboards/eodashboard-notebooks","subject":"Notebook examples","numbering":{"title":{"offset":4}},"edit_url":"https://github.com/ESA-eodashboards/eodashboard-notebooks/blob/main/external_notebooks/group1/2025-BiDS-EODashboard/notebook/Urban_Health_and_Megacities.ipynb","thumbnail":"/eodashboard-notebooks/build/Case_studies-a32c7457303b4f9307c61c571040f1da.png","exports":[{"format":"ipynb","filename":"Urban_Health_and_Megacities.ipynb","url":"/eodashboard-notebooks/build/Urban_Health_and_Meg-a86aaaae4bca23fff93469e46c95d119.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"URBAN HEALTH AND MEGACITIES: THE CASE OF NEW DELHI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GYJ6ERAM5y"}],"identifier":"urban-health-and-megacities-the-case-of-new-delhi","label":"URBAN HEALTH AND MEGACITIES: THE CASE OF NEW DELHI","html_id":"urban-health-and-megacities-the-case-of-new-delhi","implicit":true,"key":"PElk3KcrGO"}],"key":"sYyuSfxRxL"},{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/eodashboard-notebooks/build/Case_studies-a32c7457303b4f9307c61c571040f1da.png","alt":"Title","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fcgAfdK68w","urlSource":"Intro/img/Case_studies.png"}],"key":"YQzXTiWkNJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"USE CASE 1: Nighttime Lights","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jWxxUQ3znu"}],"identifier":"use-case-1-nighttime-lights","label":"USE CASE 1: Nighttime Lights","html_id":"use-case-1-nighttime-lights","implicit":true,"key":"QWJxvKVZq4"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Creating nighttime light maps with color blending","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"O3oTr7xJ7T"}],"identifier":"creating-nighttime-light-maps-with-color-blending","label":"Creating nighttime light maps with color blending","html_id":"creating-nighttime-light-maps-with-color-blending","implicit":true,"key":"j7H24ofBu8"}],"key":"dKuY3pvVqD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This use case demonstrates how to create nighttime light variation maps over a time interval (from 2019 to 2022) with additive color blending for studying the distribution of artificial lighting in urban and rural regions, offering insights into urbanization, infrastructure development, and socio-economic activity.\nThe Nighttime Light Levels indicator can be explored on the EO Dashboard by selecting the EXPLORE DATASETS mode and choosing ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T1Wjo7GcQs"},{"type":"link","url":"https://eodashboard.org/explore?indicator=NTLU&x=12142837.23019&y=4137471.98879&z=5.69238","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Night lights indicators","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ma6zj4fq1R"}],"urlSource":"https://eodashboard.org/explore?indicator=NTLU&x=12142837.23019&y=4137471.98879&z=5.69238","key":"LdZkybpCmF"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f2edUxzoOe"}],"key":"fibUicWCqm"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The study has been carried out by ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"amEjeX7CUl"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Bumpei Tojo PhD (Associate Professor), School of International and Area Studies, Tokyo University of Foreign Studies, Japan","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Dx6F28dzby"}],"key":"CXQetiYYb6"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ZWSaghZP53"}],"key":"PCturm48YP"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"HtrMosefAB"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"PLES Engineering team","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"VzbvPvx8CM"}],"key":"a0wJvIF2uV"},{"type":"text","value":" (supporting ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"mowoQY4g5X"},{"type":"emphasis","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"ESA Green Solutions Division","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"uQj65yl5Z1"}],"key":"mSSLerAI89"},{"type":"text","value":", EOP-SG) developed the blending algorithm with the current Notebook implementation and data ingestion on the dashboard (contacts: ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"MARml2dlHm"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Federico Rondoni","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"WIH6ZKIcoe"}],"key":"N3Xk4axvQy"},{"type":"text","value":", ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"yqk8Ceq8qI"},{"type":"link","url":"mailto:f.rondoni@stariongroup.eu","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"f​.rondoni@stariongroup​.eu","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"OpLnmlypDt"}],"urlSource":"mailto:f.rondoni@stariongroup.eu","key":"AbsVLzviBU"},{"type":"text","value":", ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"zXbmilvyHb"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Diego Moglioni","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"f2YiuTn0tM"}],"key":"EGHUBA7KNq"},{"type":"text","value":", ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"arlQArH2NF"},{"type":"link","url":"mailto:d.moglioni@stariongroup.eu","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"d​.moglioni@stariongroup​.eu","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GGNLlrzQgz"}],"urlSource":"mailto:d.moglioni@stariongroup.eu","key":"wH1juZENSK"},{"type":"text","value":").","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZZ4KwOnDaQ"}],"key":"Lvr5xsuJ7L"}],"key":"nCFrCsSEi2"},{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/eodashboard-notebooks/build/night_india-76b3d02814874643c86c2b390f981016.JPG","alt":"title","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Lynf4PX3Bb","urlSource":"Nightlights/img/night_india.JPG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Example of a nighttime light map covering India during 2019-2022, representing areas where a decrease in nighttime light level occurred (indicating a presumed reduction in social activity) in red, and areas where an increase occurred (indicating a presumed increase in social activity) in blue.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jothVBxWEp"}],"key":"qESDSQjJmd"}],"key":"QFO4HVyxXi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Input data:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zuKsoETk2h"}],"identifier":"input-data","label":"Input data:","html_id":"input-data","implicit":true,"key":"vHYPtfkF4D"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This product was developed by JAXA by aggregating the data from the Visible Infrared Imaging Radiometer Suite (VIIRS, onboard the Suomi NPP satellite) on a semi-annual basis (using median image generation) with 10-degree lat/lon (geographic) grid h-v tile as Geo Tiff files.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xJ53XTDMvM"}],"key":"xc6JT9siDJ"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The tiles are 2400 x 2400 pixels, with pixel size of 0.004166 degrees (~464 m at the equator).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iWhITjhWLP"}],"key":"Pt9Txcj5EN"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Metric: nighttime radiance (measured in watts per square centimeter per steradian, [W/cm²/sr]), which represents the brightness of artificial lighting.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oprsGnV38M"}],"key":"pnt365XiCI"}],"key":"HAWvZqzeDJ"}],"key":"ZdUhvW4eeQ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"VIIRS 10-degree tile scheme","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"goIr1O6t2s"}],"key":"yJ8E7EyYAJ"}],"key":"dLq5VDehte"},{"type":"image","url":"/eodashboard-notebooks/build/VIIRS_tiling_scheme-d31abfd2dff4b79e608738f7c81e16a3.jpg","alt":"VIIRS tiling scheme.JPG","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dr8kGxEhiL","urlSource":"Nightlights/img/VIIRS_tiling_scheme.jpg"}],"key":"RVfuzmQ4E8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Running environment:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YLA8HhiKew"}],"identifier":"running-environment","label":"Running environment:","html_id":"running-environment","implicit":true,"key":"NBXutnQ2Y5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook can be run by installing the provided Anaconda Python environment (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nXcE6EywbA"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"notebook-env.yml","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PhksCUk3VV"}],"key":"v7RscsUTau"},{"type":"text","value":").","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"o0PXS1KcQy"}],"key":"rJMzqxKULj"}],"key":"eefZm7VROL"}],"key":"xICU8pFkQZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"GjvOfHdpNH"},{"type":"output","id":"5RWpkOVzN1Y2u9A1N20V_","data":[],"key":"DS0CQiEfwI"}],"key":"i2wdV4vTPe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Importing Python libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ayZQYvBRaY"}],"identifier":"importing-python-libraries","label":"Importing Python libraries","html_id":"importing-python-libraries","implicit":true,"key":"hDuJiWrOVJ"}],"key":"zpKVvcpkz1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#Import libraries\nimport os\nimport sys\nimport re\nimport numpy as np\nimport rasterio\nimport rioxarray as rxr\nimport subprocess\nfrom subprocess import Popen, PIPE\nimport tempfile\nimport matplotlib.pyplot as plt\nimport matplotlib.image as mpimg\nfrom PIL import Image\nimport json\nfrom ipyleaflet import Map, ImageOverlay, basemaps","key":"kDI9yoCI2F"},{"type":"output","id":"gopBDU4qhxf2_bgnb1UtE","data":[],"key":"mE5dW7l48n"}],"key":"UMlrd0fZvZ"},{"type":"block","kind":"notebook-content","data":{"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Defining working folders","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TgdhJVgRkM"}],"identifier":"defining-working-folders","label":"Defining working folders","html_id":"defining-working-folders","implicit":true,"key":"NpgjG9AR3R"}],"visibility":"show","key":"K3ENLtABzi"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"input_dir = \"input\"\ninput_path = os.path.join(os.getcwd(), \"Nightlights\", input_dir)\n\noutput_urban = \"output\"\nurban_path = os.path.join(os.getcwd(), \"Nightlights\", output_urban)\n\n# Create output dir\nos.makedirs(urban_path, exist_ok=True)","visibility":"show","key":"Q3mh1ojmr6"},{"type":"output","id":"JzHYpUqAMD0Bc3sY6Kn5K","data":[],"visibility":"show","key":"HkFoUL7u0S"}],"visibility":"show","key":"TGLORIuf8v"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing input data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Si4ea3alxT"}],"identifier":"visualizing-input-data","label":"Visualizing input data","html_id":"visualizing-input-data","implicit":true,"key":"RjI23UA2mm"}],"key":"dHpQ6iilhw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"pattern = re.compile(r\"h(\\d+)v(\\d+)_(\\d{4})_(\\d)H_median\\.tif\")\n\nfor root, _, files in os.walk(input_path):\n    grouped_files = {}\n    \n    # Grouping files by h and v\n    for file in files:\n        match = pattern.match(file)\n        if match:\n            h, v, year, H = match.groups()\n            key = (h, v)\n            if key not in grouped_files:\n                grouped_files[key] = []\n            grouped_files[key].append((year, H, os.path.join(root, file))) \n    \n    # Process files for plotting\n    for (h, v), file_group in grouped_files.items():\n        file_group\n\ntuplelist2dict = {c:{'year':a,'half':b} for a,b,c in file_group}\nsorted_dict = {}\n\ngrid_tile = None\nfor item in sorted(tuplelist2dict, key = lambda k: (tuplelist2dict[k]['year'], tuplelist2dict[k]['half'])):\n    sorted_dict.update({item:tuplelist2dict[item]})\n    grid_tile = item.split('/')[-1].split('_')[0]\n#print(sorted_dict)","visibility":"show","key":"pHwxLCNNyK"},{"type":"output","id":"GeBKjncS5hGLOGF04vwbZ","data":[],"visibility":"show","key":"LlB5qf7Mxf"}],"visibility":"show","key":"mzOEoRHecO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def plot_figures(figures, nrows = 1, ncols=1, factor = 1., clip_range = None, **kwargs):\n    fig, axeslist = plt.subplots(ncols=ncols, nrows=nrows, figsize=(15, 15))\n    for idx,file_name in enumerate(figures):\n        title = file_name.split('/')[-1]\n        title = title.replace(\"_median.tif\", \"\")\n        axeslist.ravel()[idx].imshow(np.clip(mpimg.imread(file_name)*factor, *clip_range), **kwargs) # cmap=plt.gray(), cmap='Greys'\n        axeslist.ravel()[idx].set_title(title)\n        axeslist.ravel()[idx].set_axis_off()\n    fig.suptitle(r'Median nighttime light level [$Wcm^{-2}sr^{-1}$]', fontsize=20)\n    #plt.tight_layout() \n\n    ","visibility":"show","key":"V4NItPqY9X"},{"type":"output","id":"m23CVmZcQCS4H_8z2-TUw","data":[],"visibility":"show","key":"RO16hp9It4"}],"visibility":"show","key":"YUcXE9vd4w"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"plot_figures(sorted_dict, 4, 2, clip_range=(0,1), factor=100./255.)","visibility":"show","key":"pBtO8djOFx"},{"type":"output","id":"fu8GANom0ntoeQCFqKAKi","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"825b81381eaebd4716b057f77b672bc4","path":"/eodashboard-notebooks/build/825b81381eaebd4716b057f77b672bc4.png"},"text/plain":{"content":"<Figure size 1500x1500 with 8 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"GXMdQ1DUAi"}],"visibility":"show","key":"ziniP4J99I"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Applying color blending","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RqWnD2vzZI"}],"identifier":"applying-color-blending","label":"Applying color blending","html_id":"applying-color-blending","implicit":true,"key":"aBJCShnbZ4"}],"key":"FJbiFs4IrL"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Additive color blending involves mixing the primary colors of light, red (R), green (G), and blue (B), while adjusting their luminance levels. By manipulating the luminance of these colors, a wide range of hues can be achieved, with the key characteristic being that combining all three colors results in white.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"glm5AKxt1c"}],"key":"un9VpSbxEV"}],"key":"deCRhshCdF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Technique","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ebGs4NPO1z"}],"key":"gM1ERkGKyv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"maximum pixel value of images for 2019 (brightest pixel values) is assigned to red (R)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eIxQTqZvFb"}],"key":"MS00sC5k3d"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"minimum pixel value of images for 2020-2021 (darkest pixel values) is assigned to green (G)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"shVMP6s3QU"}],"key":"u35ljwijZ1"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"maximum pixel value of images for 2022 (brightest pixel values) is assigned to blue (B)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vtd0VsJCGz"}],"key":"Eb6hQ9cbRg"}],"key":"APjFlMUQNM"}],"key":"CxR4gl2Ggq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Output","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uYgNrVQcgF"}],"key":"kINLlx1Pdm"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"regions where a decrease in nighttime light level occurred are displayed in red","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dYy3BTtTs2"}],"key":"WM6jepL3hi"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"areas that experienced an increase (presumed to indicate an increase in social activity) are shown in blue","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nvZm9ge4dY"}],"key":"aXh1kJe9e3"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"regions where there was no significant change throughout the pandemic are displayed in a gradient from gray to white.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fxGIYYQA6h"}],"key":"LkQGgyQAlg"}],"key":"K0Q1mVHmxC"}],"key":"pPBLolPexC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pattern = re.compile(r\"h(\\d+)v(\\d+)_(\\d{4})_(\\d)H_median\\.tif\")\n\n\ndef read_and_preprocess(file):\n    with rasterio.open(file) as src:\n        img = src.read(1)\n        img = np.nan_to_num(img, nan=0)  # Replace NaNs with zeros\n        return img, src.profile\n\n    \ndef additive_blending(grouped_files):\n    # Process each group of files for blending\n    for (h, v), file_group in grouped_files.items():\n        # Initialize arrays to store the maximum and minimum values for each year\n        max_2019 = None\n        min_2020_2021 = None\n        max_2022 = None\n        \n        for year, H, file in file_group:\n            img, profile = read_and_preprocess(file)\n            \n            if year == '2019':\n                if max_2019 is None:\n                    max_2019 = img\n                else:\n                    max_2019 = np.maximum(max_2019, img)\n            elif year in ['2020', '2021']:\n                if min_2020_2021 is None:\n                    min_2020_2021 = img\n                else:\n                    min_2020_2021 = np.minimum(min_2020_2021, img)\n            elif year == '2022':\n                if max_2022 is None:\n                    max_2022 = img\n                else:\n                    max_2022 = np.maximum(max_2022, img)\n                                  \n    # Create the blended image using the specified blending technique\n    blended_img = np.zeros((max_2019.shape[0], max_2019.shape[1], 3), dtype=np.float32)\n    blended_img[:, :, 0] = max_2019.astype(np.float32)  # Red band: maximum of 2019\n    blended_img[:, :, 1] = min_2020_2021.astype(np.float32)  # Green band: minimum of 2020-2021 compared\n    blended_img[:, :, 2] = max_2022.astype(np.float32)  # Blue band: maximum of 2022\n    \n    return blended_img, profile        ","key":"eVzNndceOJ"},{"type":"output","id":"z8lCGzTG-IoR_oXgomfsR","data":[],"key":"IyCcX5Omq4"}],"key":"zz7avv4u93"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Grouping files per (h,v) tiles and years span\ngrouped_files = {}\nfor root, _, files in os.walk(input_path):\n    \n    \n    # Group files by h and v\n    for file in files:\n        match = pattern.match(file)\n        if match:\n            h, v, year, H = match.groups()\n            key = (h, v)\n            if key not in grouped_files:\n                grouped_files[key] = []\n            grouped_files[key].append((year, H, os.path.join(root, file)))\n\n\n# blending           \nblended_img, profile = additive_blending(grouped_files)","visibility":"show","key":"nZXX0YXDIn"},{"type":"output","id":"Gz7sdqd_LjraFmBfTQ-N7","data":[],"visibility":"show","key":"aAtq0b4Z7i"}],"visibility":"show","key":"kwuMaHTK3X"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Employing “urban” stretch processing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vo5hJbYCRe"}],"identifier":"employing-urban-stretch-processing","label":"Employing “urban” stretch processing","html_id":"employing-urban-stretch-processing","implicit":true,"key":"bz8gFXS0Co"}],"key":"zsTeD0mJXV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The purpose of the stretch processing is to emphasize the nighttime light level of each band (corresponding to 2019, 2020-21, and 2022), focusing on:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ykVgIPuffn"}],"key":"JJ21c9176e"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"“urban” nighttime light levels: the display range of each band is adjusted to 25-1000 [watts·cm-2·sr-1], emphasizing brighter areas","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JioGofERWi"}],"key":"Ouh0DX5O8d"}],"key":"QZJ3MQoilg"}],"key":"vYeKTkO60y"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Urban stretch processing: Emphasize brighter areas\ndef urban_stretch_processing(band):\n    min_val = 25\n    max_val = 1000\n    band = np.clip(band, min_val, max_val)\n    band = (band - min_val) / (max_val - min_val) * 255\n    return band.astype(np.uint8)\n\n# Apply urban stretch processing to each band\nblended_img[:, :, 0] = urban_stretch_processing(blended_img[:, :, 0])\nblended_img[:, :, 1] = urban_stretch_processing(blended_img[:, :, 1])\nblended_img[:, :, 2] = urban_stretch_processing(blended_img[:, :, 2])\n        \n# Update the profile for a 3-band image and set nodata value to None\nprofile.update(count=3, dtype=rasterio.uint8, nodata=None)","visibility":"show","key":"ywr4A49h1Q"},{"type":"output","id":"rBwHXjDu9evvxOxZe4Ofb","data":[],"visibility":"show","key":"iXWk6tdHry"}],"visibility":"show","key":"cRPyPspZCG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting blended image","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mprgCbJ4aK"}],"identifier":"plotting-blended-image","label":"Plotting blended image","html_id":"plotting-blended-image","implicit":true,"key":"D5JEJwp9xv"}],"key":"ytD2MpTswg"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def plot_image(image, factor=1.0, clip_range = None, **kwargs):\n    fig, ax = plt.subplots(nrows=1, ncols=1, figsize=(15, 15))\n    if clip_range is not None:\n        ax.imshow(np.clip(image * factor, *clip_range), **kwargs)\n    else:\n        ax.imshow(image * factor, **kwargs)\n    ax.set_xticks([])\n    ax.set_yticks([])\n\n\nplot_image(blended_img, factor=1.5/255., clip_range=(0,1))","visibility":"show","key":"cQXHPsWM7V"},{"type":"output","id":"slacZK63XEKhBf2YXYfFk","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f198eccc56d09718ec07ec34ee418bfc","path":"/eodashboard-notebooks/build/f198eccc56d09718ec07ec34ee418bfc.png"},"text/plain":{"content":"<Figure size 1500x1500 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"oiNMFW50ua"}],"visibility":"show","key":"yRLeZeMtPs"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overlaying with an interactive map","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UZ8Dq3dBtn"}],"identifier":"overlaying-with-an-interactive-map","label":"Overlaying with an interactive map","html_id":"overlaying-with-an-interactive-map","implicit":true,"key":"GXJNOAT1Il"}],"key":"tyqey15hgs"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Saving blended image as Cloud Optimized GeoTIFF","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A4YrJ5n6xQ"}],"key":"eGLss4IKPf"}],"key":"AF0P5R1YTp"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Exporting output as COG file \nres_name = f\"Nighttimelevel_Urban_{grid_tile}_2019-2022.tif\"\noutput_cog = os.path.join(urban_path, res_name)\n\n\n# Write the blended image directly to a temporary file\nwith tempfile.NamedTemporaryFile(suffix=\".tif\") as temp_file:\n    with rasterio.open(temp_file.name, \"w\", **profile) as dst:\n        dst.write(blended_img[:, :, 0], 1)\n        dst.write(blended_img[:, :, 1], 2)\n        dst.write(blended_img[:, :, 2], 3)\n\n    subprocess.run([\n        \"gdal_translate\", \"-of\", \"COG\",\n        \"-co\", \"COMPRESS=DEFLATE\",\n        \"-co\", \"BLOCKSIZE=512\",\n        \"-co\", \"RESAMPLING=NEAREST\",\n        \"-co\", \"OVERVIEWS=IGNORE_EXISTING\",\n        temp_file.name,\n        output_cog\n    ])\n\nprint(f\"COG file saved as {output_cog}\")","visibility":"show","key":"V69xvqzNvW"},{"type":"output","id":"ujzZ1pA6dEgarX1FcyBHW","data":[{"name":"stdout","output_type":"stream","text":"Input file size is 2400, 2400\n0...10...20...30...40...50...60...70...80...90...100 - done.\nCOG file saved as /home/undeadfairy/Nightlights/output/Nighttimelevel_Urban_h25v06_2019-2022.tif\n"}],"visibility":"show","key":"n0eNr8ANk4"}],"visibility":"show","key":"U6BflMLEbi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Extracting bounding-box coordinates","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N8AsuGD7A7"}],"key":"yOq4OP4f3f"}],"key":"futBsZIC5K"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"p1 = Popen([\"gdalinfo\", \"-json\", output_cog, \"-mm\"], stdout=PIPE)\noutput = p1.communicate()[0]\ndec_out = output.decode('utf-8')\nj_str = json.loads(dec_out)\nbbox = j_str['cornerCoordinates']\nll = bbox['lowerLeft']  # SW coo\nur = bbox['upperRight'] # NE coo\ncenter = bbox['center']","visibility":"show","key":"OnuNv9HPdp"},{"type":"output","id":"ghozII_M4kQQoT67qqMWL","data":[],"visibility":"show","key":"IsXzqVCHnd"}],"visibility":"show","key":"t9vFh76CP9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Adding alpha channel to the blended image","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HXd5UJ3Hse"}],"key":"CuhirXilYp"}],"key":"JYvMzB62ej"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def almostEquals(a,b,thres=50):\n    return all(abs(a[i]-b[i])<thres for i in range(len(a)))\n\n\nimage = Image.open(output_cog).convert('RGBA')\npixeldata = list(image.getdata())\n\n\nfor i,pixel in enumerate(pixeldata):\n    if almostEquals(pixel[:3], (0,0,0)):\n        pixeldata[i] = (0,0,0,0)\n\n\nimage.putdata(pixeldata)\npng_path = os.path.join(urban_path, res_name.replace(\".tif\",\".png\"))\nres = image.save(png_path)\n#os.path.abspath(res)\nabs_path = os.path.abspath(png_path)\nwork_dir = os.getcwd()\nid_ = work_dir.split('/')[2]\nbase_url = os.path.join('https://hub.eox.at/user',id_,'files')\n#base_url\nabs_path = '/'.join(abs_path.split('/')[3:])\nprint(abs_path)\nprint(base_url)\n#abs_path\nprint(os.path.join(base_url,abs_path))\n","visibility":"show","key":"bm8s4iisvf"},{"type":"output","id":"hbPf5MWrxiR-ivgeS9324","data":[{"name":"stdout","output_type":"stream","text":"Nightlights/output/Nighttimelevel_Urban_h25v06_2019-2022.png\nhttps://hub.eox.at/user/undeadfairy/files\nhttps://hub.eox.at/user/undeadfairy/files/Nightlights/output/Nighttimelevel_Urban_h25v06_2019-2022.png\n"}],"visibility":"show","key":"SLQSyn4Huj"}],"visibility":"show","key":"dF85pygi7r"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Overlay with OpenStreetMap","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mszeQyBnv3"}],"key":"KqhRnGU1iG"}],"key":"MRYVRpbDX5"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"m = Map(basemap=basemaps.CartoDB.DarkMatter, center=(center[1], center[0]), zoom=6)\nosm_url = os.path.join(base_url,abs_path)\nimage = ImageOverlay(\n        url=osm_url, #url=\"https://hub.eox.at/user/<id>/files/<path_to_png>\n        bounds=((ll[1], ll[0]), (ur[1], ur[0])) # SW and NE corners\n                    )\nm.add_layer(image);\nm","visibility":"show","key":"G4gxtIK53V"},{"type":"output","id":"FbOqDiOu7he_QI2t1wMU7","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"d9717396cb7a4442835ceac30cf15915\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(center=[25.0, 75.0], controls=(ZoomControl(options=['position', 'zoom_in_text', 'zoom_in_title', 'zoom_out…","content_type":"text/plain"}}}],"visibility":"show","key":"i5HMQolgP0"}],"visibility":"show","key":"V0NkRDFzEy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using additive color blending images to focus on urban areas in India, in particular the North-West part comprising New Delhi, Jaipur, Agra, Gwalior, ...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SSRKSs8nW2"}],"key":"SXuuxSYX9i"}],"key":"mszFDSy5pT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Alternative stretch processing approaches","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EKZyz3qb7V"}],"identifier":"alternative-stretch-processing-approaches","label":"Alternative stretch processing approaches","html_id":"alternative-stretch-processing-approaches","implicit":true,"key":"V9BjbsLTH9"}],"key":"UTyd8ig5MA"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"“Rural” nighttime light levels: setting each band’s display range to 0-50 [Watts·cm-2·sr-1] to emphasize darker areas","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PfZwdRIWBO"}],"key":"RrtZ4LgZV3"},{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"For a broader focus (from rural to urban areas): applying a log10 transformation to the values of each band with a display range set to 0-3.6 (equivalent to 0-3981 [Watts·cm-2·sr-1])","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"onD2WtM2E4"}],"key":"LAPZU1iimt"}],"key":"iZ55xiw7nu"}],"key":"ohi3n5KOZ7"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Final remarks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qQ4QoXluma"}],"identifier":"final-remarks","label":"Final remarks","html_id":"final-remarks","implicit":true,"key":"zV1FwcUvYe"}],"key":"pCJ0xcT9oR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This product has been specifically designed for utilization by researchers in applied scientific fields.\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FR4S0usKHF"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Potential applications","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zGOqVPs3Ow"}],"key":"L0NQdQLLZs"},{"type":"text","value":" are being explored in environmental and social issue studies, such as:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NqpP2mSMTf"}],"key":"akAnNuPZcC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"disaster recovery","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"D9LfBpRdgB"}],"key":"bLjsHdgLQS"}],"key":"dDH0VAdlbt"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"energy","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"aYpB6qA0uQ"}],"key":"dWwIbEa8pb"}],"key":"GJ8DrXQ4ni"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"urban land use changes","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kCY8oRkgC1"}],"key":"bp7S5Se3ki"}],"key":"EA4wAJN3Xh"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"conflicts","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gUBeoBKkqW"}],"key":"GekZkyvV0Y"}],"key":"kejTs6eT1n"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"migration","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"L2abY3tAAB"}],"key":"mM9Y1tOGfj"}],"key":"o7k6tXi6mo"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"monitoring of illegal, unreported activities","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"gGhWkDS9CZ"}],"key":"xP75Sndiz1"}],"key":"fTjt7nyEXn"}],"key":"quiB1sZmZ3"}],"key":"AU177l2b5k"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To learn more","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ok955riF8C"}],"identifier":"to-learn-more","label":"To learn more","html_id":"to-learn-more","implicit":true,"key":"BFkyOYlHH2"}],"key":"XjbVHGh9iK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The presented approach is often referenced in scientific and public health research. For example, Bunpei Tojo (2021) used Nightlights data in the study “Application of Earth observation satellite data to public health: Comparison of night light (VIIRS) and solar radiation (SGLI) and domestic COVID-19 epidemic,” presented at the 12th Federation of Science and Technology conference, to analyze the relationship between nighttime light intensity and public health factors.\n","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F4hyK4Dpmj"},{"type":"cite","url":"https://doi.org/10.11487/oukan.2021.0_B-4-4","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"東城 (2021)","key":"v9pVxc921K"}],"kind":"narrative","label":"2021","identifier":"https://doi.org/10.11487/oukan.2021.0_B-4-4","enumerator":"1","key":"G9KJT6Qp8c"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rXGcLcFPem"}],"key":"kkrcb2ano9"}],"key":"gVQiVMdsbW"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"USE CASE 2: Air Pollution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qbO1S2CC7X"}],"identifier":"use-case-2-air-pollution","label":"USE CASE 2: Air Pollution","html_id":"use-case-2-air-pollution","implicit":true,"key":"zhxgwOPFTP"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Monitoring NO2 concentrations over Northern India","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SILwxd5wi3"}],"identifier":"monitoring-no2-concentrations-over-northern-india","label":"Monitoring NO2 concentrations over Northern India","html_id":"monitoring-no2-concentrations-over-northern-india","implicit":true,"key":"lPkcViewTJ"}],"key":"nnuOoRQu9n"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Air quality is poor across India, but especially poor in Northern India due to a mix of human activity and seasonal weather conditions:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"x1kgxkjPjs"}],"key":"rsoCBw2uOG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Vehicle emissions","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WLUe2GDEE2"}],"key":"iBJ2Rj6CvP"},{"type":"text","value":": The city’s high population density results in heavy traffic and significant pollution from older and poorly maintained vehicles. Increased investment in mass transportation and stricter fuel efficiency enforcement could help mitigate these issues in future.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SIcW23Fd0r"}],"key":"z2ViCD4RyP"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Industrial and construction dust","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"n6gwbC0ugz"}],"key":"t7eHK3G7yh"},{"type":"text","value":": Industrial operations and ongoing construction projects release fine particulate matter into the air.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wWxthhhlHo"}],"key":"xSyuMlpvBf"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Home heating","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QBJNsRSVN4"}],"key":"v6ORUc7DhC"},{"type":"text","value":": Coal, firewood, and diesel generator use can contribute to poor air quality.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vmBphHg1GT"}],"key":"RIuU6UhNWZ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Weather patterns","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"b3Z9Fp2jMA"}],"key":"YIiSleH9Or"},{"type":"text","value":": Chillier temperatures, low wind speeds, and heavy air trap pollutants close to the ground during colder months, worsening smog.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"liftnFJ1bv"}],"key":"PCcucSO7ls"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Crop stubble burning","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"BDecIcwhMV"}],"key":"pTkpkFd09C"},{"type":"text","value":": Farmers in neighboring states including Bihar, Haryana, and Uttar Pradesh burn agricultural waste, contributing to particulate pollution","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AFRU33cn0y"}],"key":"zThxra1iRV"}],"key":"oSXpKL4eR9"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Combined, these factors create a toxic atmosphere. Air quality is particularly dangerous during the winter months, when weather conditions exacerbate pollution.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ti7FuXSHnY"}],"key":"y3INxoVD4H"}],"key":"V2j9BEgQ3c"},{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/eodashboard-notebooks/build/Northern_India-air_p-0278af76d92d5129e2756a67f8ab3ddd.JPG","alt":"title","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vZ67hsz2JK","urlSource":"Air_pollution/img/Northern_India-air_pollution.JPG"}],"key":"XTzi3Mpw12"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In particular, Delhi and large parts of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nBIwMaZqht"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"North India","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QUz3WqJ0qZ"}],"key":"JoKgTUPjxg"},{"type":"text","value":" experienced a significant ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YYFn18jwD2"},{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"air quality crisis towards the end of 2024","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e9fXyG3Tey"}],"key":"OVb3lTHm5p"},{"type":"text","value":", with air quality reaching the “Severe” and “Hazardous” categories, leading to the implementation of pollution control measures like Graded Response Action Plan 3 (GRAP 3). The air quality deterioration was caused by factors like high humidity, low wind speeds, and continued agricultural burning, which trapped fine particulate matter (PM2.5) in the atmosphere. This resulted in a public health emergency, with extreme pollution posing serious health risks, especially to children and the elderly, and leading to health advisories, school closures, and even flight diversions.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NRmoi3pRBR"}],"key":"n57zR5uo5l"}],"key":"SA9rbWSeIG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizing the AoI (Gurugram, South-West of New Delhi)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YSrCvoOXnS"}],"identifier":"visualizing-the-aoi-gurugram-south-west-of-new-delhi","label":"Visualizing the AoI (Gurugram, South-West of New Delhi)","html_id":"visualizing-the-aoi-gurugram-south-west-of-new-delhi","implicit":true,"key":"AMzusjvDym"}],"key":"k1VzsLWFzT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session\nimport subprocess\nimport json\nimport requests\nimport pandas as pd\nimport os \nimport IPython.display\nfrom datetime import datetime\nimport matplotlib.pyplot as plt\n\n# Sentinel Hub\nfrom sentinelhub import (SHConfig, DataCollection, Geometry, BBox, CRS, SentinelHubCatalog,\n                         SentinelHubRequest, filter_times, bbox_to_dimensions, MimeType, \n                         SentinelHubBYOC, ByocCollection, ByocTile, ByocCollectionAdditionalData,\n                         DownloadFailedException, CRS, SentinelHubStatistical)","key":"UL8yRRfoh0"},{"type":"output","id":"CsmktE5aiwIfx_wJnLGcq","data":[],"key":"NMSEGLn8cv"}],"key":"nRGr9KZjxD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Gurugram coordinates\ntop_left_x =  76.9602268594042\ntop_left_y = 28.5355222251629\nbottom_right_x = 77.11128887112295 \nbottom_right_y = 28.394875392026698\n\nbbox = [   \n  top_left_x,\n  bottom_right_y,\n  bottom_right_x,\n  top_left_y\n        ]\n\n# Bbox EPSG\nbbox_epsg = 4326","key":"EVHZhJK6GA"},{"type":"output","id":"NGG_ZbvO4RJ78lYYS-kmF","data":[],"key":"hPHuqHOQ7H"}],"key":"Lis2PdY8Vf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Plotting the bounding box on a map\n\nIPython.display.GeoJSON(BBox(bbox,crs=bbox_epsg).get_geojson())","key":"ve0YutBqco"},{"type":"output","id":"85eYclyUEccOxH0jyCQLl","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[76.9602268594042,28.394875392026698],[76.9602268594042,28.5355222251629],[77.11128887112295,28.5355222251629],[77.11128887112295,28.394875392026698],[76.9602268594042,28.394875392026698]]],\"crs\":{\"properties\":{\"name\":\"urn:ogc:def:crs:EPSG::4326\"},\"type\":\"name\"},\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"key":"j5bOyEUoHu"}],"key":"v0ZDBQSHaD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Use SH statistical API request to access NO2 data for the selected AoI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vhITXSuaYr"}],"identifier":"use-sh-statistical-api-request-to-access-no2-data-for-the-selected-aoi","label":"Use SH statistical API request to access NO2 data for the selected AoI","html_id":"use-sh-statistical-api-request-to-access-no2-data-for-the-selected-aoi","implicit":true,"key":"t5gZXInn7v"}],"key":"xfQ3S01QdW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The Statistical API (or shortly “Stats API”) enables you to get statistics calculated based on satellite imagery without having to download images.\nIn your Statistical API request, you can specify:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KzrUOpNuvU"}],"key":"kTOzN2kmMY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"area of interest (AoI)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WZ7FNs5u1s"}],"key":"ITZSnP9GvU"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"time period","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"f68IRi0Mmq"}],"key":"RMF0roJSHA"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"evalscript","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"e0whXNYlGa"}],"key":"yV4MqvflRv"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"data collection","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Yjq48iM0lX"}],"key":"s7C3Ubgeky"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"statistics to be calculated","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"j6jDIXI83m"}],"key":"hO4MYreHwS"}],"key":"j1MewpArvi"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The requested statistics are returned in the API response. Further details are to be found on the corresponding ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"pbsUljhzsG"},{"type":"link","url":"https://docs.sentinel-hub.com/api/latest/api/statistical/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"SH documentation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JblyjfVhC2"}],"urlSource":"https://docs.sentinel-hub.com/api/latest/api/statistical/","key":"RMSgISQCZQ"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"kbzC4ViTNL"}],"key":"c83wJpJv4T"}],"key":"p0EE9PiaAV"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bbox = [   \n  top_left_x,\n  top_left_y,\n  bottom_right_x,\n  bottom_right_y,\n        ]\n\ndata_collection = \"byoc-972e67a7-2ca8-4bf6-964a-11fe772e3ac2\"\ndate_from = \"2024-11-01T00:00:00.000Z\"\ndate_to = \"2025-02-28T00:00:00.000Z\"","key":"dBVceIWeiF"},{"type":"output","id":"Xmo-9QF3-JmXsUH_qukIE","data":[],"key":"ywuwqqZBbz"}],"key":"LxJ6D4ZozK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_req = {\n  \"input\": {\n    \"bounds\": {\n      \"bbox\": bbox\n    },\n    \"data\": [\n      {\n        \"dataFilter\": {},\n        \"type\": data_collection\n      }\n    ]\n  },\n  \"aggregation\": {\n    \"evalscript\": \"//VERSION=3\\nfunction setup() {\\n    return {\\n      input: [{\\n        bands: [\\n          \\\"tropno2\\\",\\n          \\\"dataMask\\\"\\n        ]\\n      }],\\n      output: [\\n        {\\n          id: \\\"data\\\",\\n          bands: 1,\\n          sampleType: \\\"FLOAT32\\\"\\n        },\\n        {\\n          id: \\\"dataMask\\\",\\n          bands: 1\\n        }\\n      ]\\n    }\\n  }\\n  function evaluatePixel(samples) {\\n    let validValue = 1\\n    // data sanitation\\n    if (samples.tropno2 >= 1e20 ){\\n        validValue = 0\\n    }\\n    let index = samples.tropno2;\\n    return {\\n      data:  [index],\\n      dataMask: [samples.dataMask * validValue]\\n    }\\n  }\\n\",\n    \"timeRange\": {\n      \"from\": date_from,\n      \"to\": date_to\n    },\n    \"aggregationInterval\": {\n      \"of\": \"P1D\"\n    },\n    \"width\": 100,\n    \"height\": 100\n  },\n  \"calculations\": {\n    \"default\": {}\n  }\n}\n","key":"wKmeRzDqdD"},{"type":"output","id":"gWvHFW_LulPT1gg9uGpap","data":[],"key":"mriitOeGzC"}],"key":"F0lr1hekuq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Creating a session\n\n# OAuth Client configuration\nclient_id = os.environ.get(\"SH_CLIENT_ID\")\nclient_secret = os.environ.get(\"SH_CLIENT_SECRET\") \n\nclient = BackendApplicationClient(client_id=client_id)\noauth = OAuth2Session(client=client)\n\n# Get token for the session\ntoken = oauth.fetch_token(token_url='https://services.sentinel-hub.com/oauth/token',\n                          client_secret=client_secret)","key":"GFj2IgLyig"},{"type":"output","id":"-Gk9evE6ezNePh9drGeau","data":[],"key":"VrAClzXHFT"}],"key":"UK1PebXO6S"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"resp = oauth.post(\"https://services.sentinel-hub.com/api/v1/statistics\",\n                  headers={\"Accept\":\"application/json\",\"Content-Type\":\"application/json\"},\n                  json=data_req)\n#print(resp.status_code, resp.text)\n","key":"gNuoJd3fJm"},{"type":"output","id":"JGEHnEQHuftV4QVvm2z6D","data":[],"key":"C3UHNqDoDj"}],"key":"chXSwn20p7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Extracting stats from timeseries within the specified time interval\ndata_r = resp.json() # parsing response to json\ntime_axis = [datetime.strptime(entry[\"interval\"][\"from\"], \"%Y-%m-%dT%H:%M:%SZ\").strftime(\"%Y/%m/%d\") for entry in data_r[\"data\"]]\nmeans = [float(entry['outputs']['data']['bands']['B0']['stats']['mean']) for entry in data_r[\"data\"]]\nstd_devs = [float(entry['outputs']['data']['bands']['B0']['stats']['stDev']) for entry in data_r[\"data\"]]\nstd_upper = [m+s for (m,s) in zip(means, std_devs)]\nstd_lower = [m-s for (m,s) in zip(means, std_devs)]","key":"TNj81bcPek"},{"type":"output","id":"RlbKQGmp50SLnKksBgh8O","data":[],"key":"P0oOB7Wynp"}],"key":"Agk70iQ2ep"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting the statistics for the NO2 timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZEMajT9T0E"}],"identifier":"plotting-the-statistics-for-the-no2-timeseries","label":"Plotting the statistics for the NO2 timeseries","html_id":"plotting-the-statistics-for-the-no2-timeseries","implicit":true,"key":"sza7UNmvKU"}],"key":"p3gt5jgVUF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20,10))\n# plot mean values \nplt.plot(time_axis, means, linestyle='solid', linewidth=2, color=\"black\", label=\"Mean Tropospheric NO2 values [umol/ m^2]\")\n\n# plot standard deviation error bars\nplt.errorbar(time_axis, means, yerr=std_devs, linestyle=\"-\")\n\nplt.title('Tropospheric NO2 Values over the AOI')\nplt.legend()\nfig.autofmt_xdate()\n\n# Saving plot\noutput_no2 = \"output\"\noutput_no2_path = os.path.join(os.getcwd(), \"Air_pollution\", output_no2)\nos.makedirs(output_no2_path, exist_ok=True)\nplt.savefig(os.path.join(output_no2_path, 'NO2_Gurugram.png'))\n\nplt.show()","key":"ZhQttZwyOA"},{"type":"output","id":"oNeL-ywoK2MGhyauMpB1p","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"67372d6fd9791368d098641b91b6fff1","path":"/eodashboard-notebooks/build/67372d6fd9791368d098641b91b6fff1.png"},"text/plain":{"content":"<Figure size 2000x1000 with 1 Axes>","content_type":"text/plain"}}}],"key":"xxGV8VrlYe"}],"key":"i1uj0InRIu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The plot shows a spike in NO2 concentration over Gurugram in December 2024, when the significant air quality crisis in Northern India has been reported.\nIn particular, it can be noticed that the standard deviation starts increasing over this month with respect to the preceding and subsequent  time interval.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uTEGqDg4bq"}],"key":"BnQ2b5Wnjy"}],"key":"Tuw63ncBj3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"USE CASE 3: HEATWAVES","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dT0o5UV8vj"}],"identifier":"use-case-3-heatwaves","label":"USE CASE 3: HEATWAVES","html_id":"use-case-3-heatwaves","implicit":true,"key":"Fm2HZuH3Rb"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Analyzing Land Surface Temperature with GCOM-C ‘Shikisai’ Satellite Data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eVlStFIra6"}],"identifier":"analyzing-land-surface-temperature-with-gcom-c-shikisai-satellite-data","label":"Analyzing Land Surface Temperature with GCOM-C ‘Shikisai’ Satellite Data","html_id":"analyzing-land-surface-temperature-with-gcom-c-shikisai-satellite-data","implicit":true,"key":"JjrUCiKUa5"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In this use case, we will explore ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pnLdSv4lPP"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"GCOM (Global Change Observation Mission)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XISw5EV45J"}],"key":"HDXJMtqlyF"},{"type":"text","value":" satellite data to analyze ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yzXf3bwkXB"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Land Surface Temperature (LST)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"tGCXG88ITo"}],"key":"Cz6S2zomLJ"},{"type":"text","value":". Specifically, we’ll look at data from the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oRqk0yM4BK"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"GCOM-C","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oaQpwgTyi7"}],"key":"ON0VtyFmz3"},{"type":"text","value":" satellite, which is part of the Japan Aerospace Exploration Agency’s (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"amh6bIekoX"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"JAXA","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ajERDhLmgf"}],"key":"ehUx80uVvF"},{"type":"text","value":") efforts to monitor global climate change. GCOM-C provides valuable information on various environmental factors, including temperature, vegetation, and water bodies, through its thermal infrared sensors.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hoJ6LMSmJs"}],"key":"qaVOsIDOsJ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Our focus will be on studying the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rc6cu4yR7E"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"heatwave","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jzbaUIqarP"}],"key":"jRTVLsRRJI"},{"type":"text","value":" that occurred in ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JLedkW9DDA"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"New Delhi, India, in 2024","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Dn0Kl5TMqe"}],"key":"zWMYKDfSO6"},{"type":"text","value":". In particular, the city experienced a significant temperature surge during the peak summer months. The temperature exceeded ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"kZDu6FDvEm"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"45°C (113°F)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CH6HJrgMcF"}],"key":"I0ogLfo0y2"},{"type":"text","value":", causing severe disruptions to daily life, and raising concerns about the increasing frequency and intensity of heatwaves due to climate change.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DOjQ8Bwlow"}],"key":"UzBS1HCdjP"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"By analyzing GCOM-C’s satellite data, we can better understand the spatial distribution of land surface temperature during that period, as well as any emerging patterns that might indicate more frequent or severe heat events in the future.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FwLd8uuRkh"}],"key":"LtrE3XFWoY"}],"key":"kxQgOBFa6Y"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.1 Import libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zIt1khHimp"}],"identifier":"id-3-1-import-libraries","label":"3.1 Import libraries","html_id":"id-3-1-import-libraries","implicit":true,"key":"xKqdNpQHNC"}],"key":"cPdV3g0efZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import geopandas as gpd\nimport rasterio\nfrom rasterio.mask import mask\nimport matplotlib.pyplot as plt\nfrom osgeo import gdal\nimport requests\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom osgeo import gdal\nfrom matplotlib.colors import LinearSegmentedColormap","key":"wx7uwkx4BM"},{"type":"output","id":"jg_unGZCViI676hxFjs7E","data":[],"key":"HG7989jwIW"}],"key":"Tciwwb7Zwk"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.2 About the data: storage and access","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SuFoP5Oz36"}],"identifier":"id-3-2-about-the-data-storage-and-access","label":"3.2 About the data: storage and access","html_id":"id-3-2-about-the-data-storage-and-access","implicit":true,"key":"F8dLyh0Uij"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"FIND DATA LOCATION:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"z7pbHK8z6A"}],"key":"Cy5jms5kgU"},{"type":"text","value":" To find where a data is stored, one can search throught the EODash ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uxClWbJrxn"},{"type":"link","url":"https://github.com/ESA-eodashboards/eodashboard-catalog/tree/80bde3aac691e00edb963b785385056709dd18b4/collections","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/ESA​-eodashboards​/eodashboard​-catalog​/tree​/80bde3aac691e00edb963b785385056709dd18b4​/collections","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HsN6N2FGMD"}],"urlSource":"https://github.com/ESA-eodashboards/eodashboard-catalog/tree/80bde3aac691e00edb963b785385056709dd18b4/collections","error":true,"key":"LyWCgNPAWl"}],"key":"ifwP6eyL6W"}],"key":"nPeyirlZ0Q"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"DATA STORED AT WASABI:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ohsIAhXHyf"}],"key":"ytZiLZgvXy"},{"type":"text","value":"  Our data is located at the following url ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mA0kSN14GQ"},{"type":"link","url":"https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.G-Portal_GCOM-C.SGLI_standard.L3-LST.daytime.v3_global_monthly/2024-07/1/E000.00-E090.00/E000.00-N00.00-E090.00-N90.00-LST.tiff","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"https://​s3​.ap​-northeast​-1​.wasabisys​.com​/je​-pds​/cog​/v1​/JAXA​.G​-Portal​_GCOM​-C​.SGLI​_standard​.L3​-LST​.daytime​.v3​_global​_monthly​/2024​-07​/1​/E000​.00​-E090​.00​/E000​.00​-N00​.00​-E090​.00​-N90​.00​-LST​.tiff","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yRxD1l9nb0"}],"urlSource":"https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.G-Portal_GCOM-C.SGLI_standard.L3-LST.daytime.v3_global_monthly/2024-07/1/E000.00-E090.00/E000.00-N00.00-E090.00-N90.00-LST.tiff","key":"Klo0HcZMdB"},{"type":"text","value":"\". This URL is hosted on ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"A1BRJCfjBg"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Wasabi, a cloud storage service","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JzuOMtpJJ0"}],"key":"U8vPqXaTeh"},{"type":"text","value":", which is known for providing affordable, high-performance cloud storage for large datasets, often used in scientific research or data-heavy projects. Wasabi is not affiliated to JAXA, provides does not charge for API requests. Wasabi’s object storage service is built to be ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"yMk2Qmqfx6"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"100% bit-compatible with AWS S3","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XFbnXjA0DY"}],"key":"QdmR6ZVHXZ"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dzuAhNaw6q"}],"key":"xkguhYlwHQ"}],"key":"bN3j81m1B7"}],"key":"wzJVyKL0Xv"},{"type":"div","style":{"textAlign":"center"},"children":[{"type":"image","url":"/eodashboard-notebooks/build/da434440f2505e8ced510d7fdc12dc2d.png","width":100,"key":"Pe9xCyr243","urlSource":"https://a-us.storyblok.com/f/1019449/828x476/a741cde6a0/stacked-logo-full-color-rgb.png"}],"key":"MmQVq8XHgM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"ABOUT DATASET:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"afNriBsg7l"}],"key":"HeDpJtY4LV"},{"type":"text","value":" The LST (Land Surface Temperature) data file corresponds to the daytime measurements taken by the SGLI sensor. It’s a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"iMrOYcFaXw"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"monthly global dataset for July 2024","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vukucAnbLq"}],"key":"KRvF6VX1aF"},{"type":"text","value":", indicating this is a time-series observation over a large area. To interpret the naming convention of the data: it contains the name of the variable, the month/year it is averaging and the represent the spatial coordinates of the bounding box it covers (0° to 90° East and 0° to 90° North).","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zew3GGhZw4"}],"key":"f6uevTP0BQ"}],"key":"YoFQQC4alW"},{"type":"div","style":{"textAlign":"center"},"children":[{"type":"image","url":"/eodashboard-notebooks/build/6fde3837c2a0948e357664ec959d718c.jpeg","width":100,"key":"zqUP1zfeoU","urlSource":"https://space.skyrocket.de/img_sat/gcom-c__1.jpg"},{"type":"div","style":{"fontSize":"small"},"children":[{"type":"text","value":"GCOM-C 'Shikisai'. Credit: JAXA","key":"R4EHM8x079"}],"key":"oan25Rn1Al"}],"key":"vSOk09QtUc"}],"key":"IIseiqmiU1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.3 A first look at the dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ImxOt8ZeAG"}],"identifier":"id-3-3-a-first-look-at-the-dataset","label":"3.3 A first look at the dataset","html_id":"id-3-3-a-first-look-at-the-dataset","implicit":true,"key":"CJuaV3gXl5"}],"key":"QiMox8EUX1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Location of URL stored on Wasabi \nurl = \"https://s3.ap-northeast-1.wasabisys.com/je-pds/cog/v1/JAXA.G-Portal_GCOM-C.SGLI_standard.L3-LST.daytime.v3_global_monthly/2024-07/1/E000.00-E090.00/E000.00-N00.00-E090.00-N90.00-LST.tiff\"\n# Downloads the file from the URL\nresponse = requests.get(url)\n# Saves file locally \nwith open(\"Heatwaves/LST.tiff\", \"wb\") as f:\n    f.write(response.content)\n\n# Opening the file with GDAL (library for geospatial raster data)\nds = gdal.Open(\"Heatwaves/LST.tiff\")\n# Gests the first (and in this case) only band refering to LST.\nband = ds.GetRasterBand(1)\n#Reads the raster into a NumPy array (a sort of matrix)\narr = band.ReadAsArray().astype(float)\n\n# Plotting\nimport matplotlib.pyplot as plt\nplt.imshow(arr, cmap=\"viridis\")\nplt.colorbar()\nplt.title(\"LST\")\nplt.show()\n\nprint(' - - - ')\nprint('More information about the dataset:')\nprint(' - - - ')\nprint(ds.GetProjection(), ds.GetGeoTransform())\n","key":"U8UI7ZkQNX"},{"type":"output","id":"0geNX6sUV5o7UE3tZGMjF","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d02536bc5ff9e1c0b153e66b17be6474","path":"/eodashboard-notebooks/build/d02536bc5ff9e1c0b153e66b17be6474.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},{"name":"stdout","output_type":"stream","text":" - - - \nMore information about the dataset:\n - - - \nGEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]] (0.0, 0.025, 0.0, 90.0, 0.0, -0.025)\n"}],"key":"m9Doz1CaQb"}],"key":"z888j2SHSm"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.4 Cropping to Area of Interest (Northern India) and converting to Celcisus Degrees","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yTBUUPZVHi"}],"identifier":"id-3-4-cropping-to-area-of-interest-northern-india-and-converting-to-celcisus-degrees","label":"3.4 Cropping to Area of Interest (Northern India) and converting to Celcisus Degrees","html_id":"id-3-4-cropping-to-area-of-interest-northern-india-and-converting-to-celcisus-degrees","implicit":true,"key":"RqPIzvZjdf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The JAXA GCOM-C SGLI L3 LST had a 0.02 scalling factor and was in Kelvin.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yK4LW0wXeh"}],"key":"Pgb1UwHl4B"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"So, we will convert it to degree celcius and ‘crop’ the whole image to Northern India","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cDaww4oNtc"}],"key":"Lfl8lgbJ1G"}],"key":"wtSk79OKMa"}],"key":"szDxYj0OkH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Now we mask invalid or unrealistic values (sometimes satellite have artifacts or other issues that render the value of a pixel wrong)\narr[(arr <= 0) | (arr > 35000)] = np.nan\n\n# Re-scale and convert from Kelvin to Celsius\narr_c = arr * 0.02 - 273.15  \n\n# GeoTransform is a GDAL function that helps map between the raster coordinates and georeference coordinates\n# In other words it is converting geographic coordinates (lat, lon) into pixel coordinates of our matrix (X, y)\ngt = ds.GetGeoTransform()\ndef latlon_to_pixel(lat, lon, gt):\n    px = int((lon - gt[0]) / gt[1])\n    py = int((lat - gt[3]) / gt[5])\n    return px, py\n\n# Now we use this function to get the pixel coordinates of an area around Northern India \nlon_min, lon_max = 70, 90\nlat_min, lat_max = 20, 37\npx_min, py_max = latlon_to_pixel(lat_min, lon_min, gt)\npx_max, py_min = latlon_to_pixel(lat_max, lon_max, gt)\n# 'Bounding box of northern India'\narr_crop_india = arr_c[py_min:py_max, px_min:px_max]\n\n# We do the same for New Dehli\nlon_min, lon_max = 76.8, 77.5\nlat_min, lat_max = 28.4, 28.9\npx_min2, py_max2 = latlon_to_pixel(lat_min, lon_min, gt)\npx_max2, py_min2 = latlon_to_pixel(lat_max, lon_max, gt)\narr_crop_delhi = arr_c[py_min2:py_max2, px_min2:px_max2]\n\n# Selecting the color scheme \ncmap = \"plasma\"  # 🔴Change to other color schemes: 'inferno', 'cividis', 'jet'\n\n# Settlings to ensure we have 2 plots, side by side\nfig, axes = plt.subplots(1, 2, figsize=(14, 6))\nvmin, vmax = 27, 50  #🔴can change here the max and min values for improved interpration\n\n# \nim1 = axes[0].imshow(arr_crop_india, cmap=cmap, vmin=vmin, vmax=vmax)\naxes[0].set_title(\"LST (°C) - Northern India\")\ncbar1 = fig.colorbar(im1, ax=axes[0], orientation=\"horizontal\", fraction=0.046, pad=0.08)\ncbar1.set_label(\"LST (°C)\")\n\n# Mark New Delhi on Northern India map\ndelhi_lat, delhi_lon = 28.61, 77.21\npx_delhi, py_delhi = latlon_to_pixel(delhi_lat, delhi_lon, gt)\npx_delhi_rel = px_delhi - px_min\npy_delhi_rel = py_delhi - py_min\naxes[0].scatter(px_delhi_rel, py_delhi_rel, color=\"red\", s=40, marker=\"o\")\naxes[0].text(px_delhi_rel + 5, py_delhi_rel - 5, \"New Delhi\", color=\"white\",\n             fontsize=10, weight=\"bold\", backgroundcolor=\"black\")\n\n# Plot now \nim2 = axes[1].imshow(arr_crop_delhi, cmap=cmap, vmin=vmin, vmax=vmax)\naxes[1].set_title(\"LST (°C) - New Delhi (Cropped and zoomed it)\")\ncbar2 = fig.colorbar(im2, ax=axes[1], orientation=\"horizontal\", fraction=0.046, pad=0.08)\ncbar2.set_label(\"LST (°C)\")\n\nplt.tight_layout()\nplt.show()\n","key":"O1myMzZDZv"},{"type":"output","id":"gPxp50hWJNuRncV66Pdq_","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8c4ee3ee3fdb8cd666a6987e0b7b9df7","path":"/eodashboard-notebooks/build/8c4ee3ee3fdb8cd666a6987e0b7b9df7.png"},"text/plain":{"content":"<Figure size 1400x600 with 4 Axes>","content_type":"text/plain"}}}],"key":"oA7vvJmgVB"}],"key":"QpkvWStedU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3.5 Identifying locations where Heatwave has occured in June 2024","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dTyYftRNdU"}],"identifier":"id-3-5-identifying-locations-where-heatwave-has-occured-in-june-2024","label":"3.5 Identifying locations where Heatwave has occured in June 2024","html_id":"id-3-5-identifying-locations-where-heatwave-has-occured-in-june-2024","implicit":true,"key":"zkU2RPYSBH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Applying a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"jlX3SmnadD"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"threshold","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yx4X4rogBB"}],"key":"CyIN5ISsda"},{"type":"text","value":" (temperature limit from which it’s considered to be a ‘heatwave’)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iDVWVMafaD"}],"key":"patTeP8lux"}],"key":"o9F2HJaKdO"}],"key":"VXyAqNxewG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.patches as patches\nimport matplotlib.colors as mcolors\n\n# Start with the plasma colormap\nbase_cmap = plt.cm.plasma\nnewcolors = base_cmap(np.linspace(0, 1, 256))\n\n# Make the last part of the colormap black (for >45 °C)\nnewcolors[-1, :] = [0, 0, 0, 1]  \ncmap = mcolors.ListedColormap(newcolors)\n\n# Setting the figure plot specifications \nfig, ax = plt.subplots(figsize=(12, 9)) \nvmin, vmax = 27, 40  # we extend vmax to allow space for black (>45 °C)\nim = ax.imshow(arr_crop_india, cmap=cmap, vmin=vmin, vmax=vmax)\n\n# Add colorbar\ncbar = fig.colorbar(im, ax=ax, orientation=\"horizontal\", fraction=0.046, pad=0.08)\ncbar.set_label(\"LST (°C)\")\n\n# Label explaining the threshold\ncbar.ax.text(0.5, -0.5, \">45°C = black\", color=\"black\",\n             fontsize=12, ha='center', va='center', transform=cbar.ax.transAxes)\n\nax.set_title(\"LST (°C) July Average Land Surface Temperates in Northern India\", fontsize=16)\n\n# Adding the coordinates of New Delhi again\ndelhi_lat, delhi_lon = 28.61, 77.21\npx_delhi, py_delhi = latlon_to_pixel(delhi_lat, delhi_lon, gt)\npx_delhi_rel = px_delhi - px_min\npy_delhi_rel = py_delhi - py_min\n\n# Adding a red X at New Delhi\nax.scatter(px_delhi_rel, py_delhi_rel, color=\"red\", s=100, marker=\"X\")\n\n# Adding a big red circle around New Delhi\ncircle = patches.Circle((px_delhi_rel, py_delhi_rel), radius=40,\n                        edgecolor='red', facecolor='none', linewidth=2.5)\nax.add_patch(circle)\n\n# Label for New Delhi\nax.text(px_delhi_rel + 50, py_delhi_rel - 15, \"New Delhi\",\n        color=\"white\", fontsize=10, weight=\"bold\", backgroundcolor=\"black\")\n\nplt.tight_layout()\nplt.show()\n","key":"kxII2LLEK7"},{"type":"output","id":"7HQ2Fp-KanOHibgno8l8b","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"c06bceb418b77415256e730c0bb63492","path":"/eodashboard-notebooks/build/c06bceb418b77415256e730c0bb63492.png"},"text/plain":{"content":"<Figure size 1200x900 with 2 Axes>","content_type":"text/plain"}}}],"key":"hhFtLjqovb"}],"key":"mQYU0ZUWJv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"USE CASE 4: URBAN HEALTH","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IzPd9iBgHB"}],"identifier":"use-case-4-urban-health","label":"USE CASE 4: URBAN HEALTH","html_id":"use-case-4-urban-health","implicit":true,"key":"eeWxieH7Bi"}],"key":"Gnr7FyJobG"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.1. Import libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CuAILCih9v"}],"identifier":"id-4-1-import-libraries","label":"4.1. Import libraries","html_id":"id-4-1-import-libraries","implicit":true,"key":"ns81ZP3zlX"}],"key":"ZmZh758N52"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"!pip install fastkml shapely\n!pip install pykml","key":"d6USBSxrcK"},{"type":"output","id":"wLV-C8RZZ2C_XWnIecEYu","data":[{"name":"stdout","output_type":"stream","text":"Defaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: fastkml in ./.local/lib/python3.10/site-packages (1.1.0)\nRequirement already satisfied: shapely in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (2.0.1)\nRequirement already satisfied: arrow in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from fastkml) (1.3.0)\nRequirement already satisfied: pygeoif>=1.5 in ./.local/lib/python3.10/site-packages (from fastkml) (1.5.1)\nRequirement already satisfied: typing-extensions>4 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from fastkml) (4.15.0)\nRequirement already satisfied: numpy>=1.14 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from shapely) (1.26.4)\nRequirement already satisfied: python-dateutil>=2.7.0 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from arrow->fastkml) (2.9.0.post0)\nRequirement already satisfied: types-python-dateutil>=2.8.10 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from arrow->fastkml) (2.9.0.20250822)\nRequirement already satisfied: six>=1.5 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from python-dateutil>=2.7.0->arrow->fastkml) (1.17.0)\nDefaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: pykml in ./.local/lib/python3.10/site-packages (0.2.0)\nRequirement already satisfied: lxml>=3.3.6 in /home/conda/eodashboardtutorial/6072b167-1758711182-56-tutorial-dashboards/lib/python3.10/site-packages (from pykml) (4.9.2)\n"}],"key":"XpVMSsbFbZ"}],"key":"G8dpTWMjso"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import requests\nfrom IPython.display import Image\nimport mercantile\n\nfrom io import BytesIO\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nimport requests\nfrom PIL import Image\nfrom io import BytesIO\n\nimport mercantile\nimport numpy as np\nfrom shapely.geometry import Polygon, Point\nfrom pykml import parser","key":"wUGujsosXi"},{"type":"output","id":"-7lhjyntFZukHGgXd5Lua","data":[],"key":"FJz5Y3ARb2"}],"key":"UXDgR2UChh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.2. About the data: storage and access","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UZEtvjVgpL"}],"identifier":"id-4-2-about-the-data-storage-and-access","label":"4.2. About the data: storage and access","html_id":"id-4-2-about-the-data-storage-and-access","implicit":true,"key":"hUDUH2ET7L"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"DATA LOCATION:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"XnoT4xXbe8"}],"key":"p3ay05niHp"},{"type":"text","value":" Since this is on ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mpLcKenNqi"},{"type":"link","url":"https://www.earthdata.nasa.gov/dashboard","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"NASA VEDA data","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PzyueUF3v5"}],"key":"Zyh40Emwhg"}],"urlSource":"https://www.earthdata.nasa.gov/dashboard","key":"Uq3lC6Escb"},{"type":"text","value":" - which is a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DGcoKkBx7N"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"open-source cyberinfrascture","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ory7Gs1qr9"}],"key":"EKbUHpDW5U"},{"type":"text","value":" for data processing, visualization, exploration, and geographic information system (GIS) capabilties allows researchs to explore and analyze Earth science data in the cloud. This dataset, is physically stored in the veda-data-store S3 bucket.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uzqiGTtMGY"}],"key":"xGbfgMBMu4"}],"key":"CpWFdhmHJT"},{"type":"div","style":{"textAlign":"center"},"children":[{"type":"image","url":"/eodashboard-notebooks/build/5c45b2674c5732cfdc4e405ce7cf5bf6.svg","width":100,"key":"EXfQLaORKC","urlSource":"https://visex.netlify.app/graphics/nasa-veda-logo-pos.svg"}],"key":"BIYCfIHuLR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"ABOUT DATA METADATA & ACCESS:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PcjMsHCYoK"}],"key":"bItRnXOxrb"},{"type":"text","value":" It is STAC (SpatioTemporal Asset Catalog) wich is a specification aimed to standardize the ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"KbzBlKG8Wm"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"way geospatial asset metadata is strucutred and queried","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"feWbWIbbao"}],"key":"lLcUWn2bEl"},{"type":"text","value":", estalbishing a standadd scheme and queryable. It is a metadata/catalog layer describing the dataset, making it easier to search and access. The access itself can be done through multiple ways:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"InfuoQu5ys"}],"key":"Q59SbfSXWJ"}],"key":"xRvIBJRxWp"},{"type":"div","style":{"textAlign":"center"},"children":[{"type":"image","url":"/eodashboard-notebooks/build/548ee91c481431b010d9b9a2c82f6b3c.png","width":100,"key":"eVvheSzCk0","urlSource":"https://stacspec.org/public/images-original/STAC-01.png"}],"key":"BJ1N1hxoCW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Browsed via STAC Browser (web-based browsing interface) - (aceess at ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"wSJDz7N6a4"},{"type":"link","url":"https://radiantearth.github.io/stac-browser/#/?.language=en","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"https://​radiantearth​.github​.io​/stac​-browser​/​#​/​?​.language​=en","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"jX0c2wlJzK"}],"urlSource":"https://radiantearth.github.io/stac-browser/#/?.language=en","key":"pmXC3w7mL1"},{"type":"text","value":")","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"z3pCZrFrNj"}],"key":"zHLGuQtjfN"}],"key":"JWw6zsHf2T"}],"key":"sQkITvHkia"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"list","ordered":true,"start":2,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Uset STAC API (programmatic access) - STAC API allows to programmatically searcg/filter, and access STAC ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"DN8XoCqCvG"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"using code","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"kRfBLESp38"}],"key":"BJ7CSPK1nc"},{"type":"text","value":", rather than clicking through a web interface.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"ehlJ6yflGS"}],"key":"qaqtAiwBAu"}],"key":"sTFu41o4IU"}],"key":"MX7qXeUK5g"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"list","ordered":true,"start":3,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Diect S3 access (for AWS-hostet data) - this means you can access the ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"drHyLoz90E"},{"type":"strong","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"actuall files directly stored in S3 buckets withouth going through STAC browser or API interfaces","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"aCGsTmZj2E"}],"key":"Py5ZbPJxjf"}],"key":"KtobwpDFEF"}],"key":"UxkXtoPUCr"}],"key":"l9GTkNMg5D"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"list","ordered":true,"start":4,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Downloading it locally (if there is no need of authenticatio via S3)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"CGN6YVOKwo"}],"key":"aYtc4ihKEV"}],"key":"NL2xljfFf7"}],"key":"g2oPYmrSBB"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"5)...or","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"nGYt4LJbmW"}],"key":"uBLkJFQDam"}],"key":"rZO8AkRJzD"}],"key":"AuR1bjJc0O"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.2. Query the collection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JMPhQFseIT"}],"identifier":"id-4-2-query-the-collection","label":"4.2. Query the collection","html_id":"id-4-2-query-the-collection","implicit":true,"key":"M37gm6TkJz"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Before Processing, we can do some ‘reconnaissance’: understanding what data is available before you start working with it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YfaKm2JqVL"}],"key":"JES1E78C7J"}],"key":"OmR9Eo5aCH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from PIL import Image\n# Get all items in the GRDI STAC Collection\nitems_url = \"https://openveda.cloud/api/stac/collections/grdi-v1-raster/items\"\nresponse = requests.get(items_url)\nitems = response.json()\n\nprint(f\"Found {len(items['features'])} item(s)\")\n\n# Preview the first item\nfirst_item = items[\"features\"][0]\nprint(\"Item ID:\", first_item[\"id\"])\nprint(\"Available assets:\")\nfor asset_name, asset in first_item[\"assets\"].items():\n    print(f\"  - {asset_name}: {asset['href']}\")\n\nfrom PIL import Image\nimport requests\nfrom io import BytesIO\n\nthumbnail_url = \"https://thumbnails.openveda.cloud/grdi--dataset-cover.jpg\"\nresponse = requests.get(thumbnail_url)\nimg = Image.open(BytesIO(response.content))\nimg.show()  # Opens in image viewer","key":"iwVHdbUpcO"},{"type":"output","id":"pTJSToT3RMdd1QZJf5dek","data":[{"name":"stdout","output_type":"stream","text":"Found 1 item(s)\nItem ID: povmap-grdi-v1_2010-01-01_2021-12-31\nAvailable assets:\n  - cog_default: s3://veda-data-store/grdi-v1-raster/povmap-grdi-v1_2010-01-01_2021-12-31.tif\n  - rendered_preview: https://openveda.cloud/api/raster/collections/grdi-v1-raster/items/povmap-grdi-v1_2010-01-01_2021-12-31/preview.png?assets=cog_default&rescale=0%2C100&colormap_name=viridis\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"6296541e7ee451e5d1773f7fcda36d05","path":"/eodashboard-notebooks/build/6296541e7ee451e5d1773f7fcda36d05.png"},"text/plain":{"content":"<PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=2000x1363>","content_type":"text/plain"}}}],"key":"Y5CJsHf2TZ"}],"key":"V14jMRasJ1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.3. Query the collection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tDUHmxFolf"}],"identifier":"id-4-3-query-the-collection","label":"4.3. Query the collection","html_id":"id-4-3-query-the-collection","implicit":true,"key":"ve7q59Jovw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Some datasets may need registration or have usage agreements, so it might not be a straightforward process to access S3 AWS buckets - which can lead to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pzyFxisRil"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"error 403","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qNngjMF1k9"}],"key":"cJsz1SaryZ"},{"type":"text","value":".","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H0ijGP18xc"}],"key":"uWivNk3cDx"}],"key":"hkxejcNBLb"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"In this case if we do not have permission we can convert the COG available on the link we descovered earlier into web map tiles, so it means VEDA API ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RfUTQz0hrs"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"handles S3 authentication","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"T0Q18YR6dV"}],"key":"l2H8hJnBD1"},{"type":"text","value":".","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MnHWfQgaKe"}],"key":"Ia7zKeAZq9"}],"key":"e73FHDoo1d"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"The tile URL requests a small square of the GRDI map from Veda’s server, using zoom (z) and grid (x, y) coordinates in Web Mercator. Veda reads only the needed pixels from the large Cloud Optimized GeoTIFF (COG), applies the colormap, and sends it as an image—COG makes this efficient by allowing partial reads without loading the entire dataset.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ldbEUVISUe"}],"key":"lj9Ap4zBHD"}],"key":"OCFovOpA76"}],"key":"eRWxJJkXik"}],"key":"nHb0J0VpnF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import requests\nfrom PIL import Image\nfrom io import BytesIO\nimport matplotlib.pyplot as plt\nimport mercantile\n\n# Coordinates over India\nlon, lat = 78.96, 20.59\nzoom = 3   ## 🔴Change here zoom\ntile = mercantile.tile(lon, lat, zoom)\n\n# Generate tile URL\nbase_url = \"https://openveda.cloud/api/raster/cog/tiles/WebMercatorQuad\"\ncog_path = \"s3://veda-data-store/grdi-v1-raster/povmap-grdi-v1_2010-01-01_2021-12-31.tif\"  # 🟢COG of GRDI\n\ncog_path = \"s3://veda-data-store-staging/grdi-vnl-slope-raster/povmap-grdi-v1_VNL-slope_2012-01-01_2020-12-31.tif\"  # 🟢COG of VNL slope\n\ntile_url = (\n    f\"{base_url}/{tile.z}/{tile.x}/{tile.y}\"\n    f\"?url={cog_path}&resampling_method=nearest&bidx=1\"\n    f\"&colormap_name=viridis&rescale=0,100\"\n)\n\n# Request and plot the tile\nresponse = requests.get(tile_url)\nimg = Image.open(BytesIO(response.content))\n\nplt.imshow(img)\nplt.axis(\"off\")\nplt.title(f\"GRDI - Zoomed to India (Zoom level: {zoom})\")\nplt.show()\n","key":"wVA5MuMmF3"},{"type":"output","id":"Tjyp9FM1DAdrnuvINs__b","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"4a84db7f9447d99e04752c68ae9d925a","path":"/eodashboard-notebooks/build/4a84db7f9447d99e04752c68ae9d925a.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"key":"OpV9kTPmvC"}],"key":"ETxYRbgirL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.4. Comparing values between two cities: New Delhi vs Gurugram","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QrB25du9X3"}],"identifier":"id-4-4-comparing-values-between-two-cities-new-delhi-vs-gurugram","label":"4.4. Comparing values between two cities: New Delhi vs Gurugram","html_id":"id-4-4-comparing-values-between-two-cities-new-delhi-vs-gurugram","implicit":true,"key":"WfHxUU6XXs"}],"key":"fdjKmG6KEq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4.4.1 Load the KML","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"anicUWa8FV"}],"identifier":"id-4-4-1-load-the-kml","label":"4.4.1 Load the KML","html_id":"id-4-4-1-load-the-kml","implicit":true,"key":"tiszWGVOfz"}],"key":"zj4NVmVT6I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nfrom shapely.geometry import Polygon\nfrom pykml import parser\n\n# --- Helper to read polygon from KML ---\ndef load_polygon(path):\n    with open(path) as f:\n        root = parser.parse(f).getroot()\n    coords_text = root.Document.Placemark.Polygon.outerBoundaryIs.LinearRing.coordinates.text\n    polygon_coords = [tuple(map(float, c.split(\",\")[:2])) for c in coords_text.strip().split()]\n    return Polygon(polygon_coords)\n\n# Load polygons\npolygon_nd = load_polygon(\"Cities/NewDehli_2.kml\")\npolygon_gg = load_polygon(\"Cities/Gurugram.kml\")\n\n# --- Plot both polygons ---\nfig, ax = plt.subplots(figsize=(8, 8))\n\n# New Delhi in red\nx_nd, y_nd = polygon_nd.exterior.xy\nax.plot(x_nd, y_nd, color=\"skyblue\", linewidth=2, label=\"New Delhi boundary\")\nax.fill(x_nd, y_nd, color=\"skyblue\", alpha=0.2)\n\n# Gurugram in green\nx_gg, y_gg = polygon_gg.exterior.xy\nax.plot(x_gg, y_gg, color=\"orange\", linewidth=2, label=\"Gurugram boundary\")\nax.fill(x_gg, y_gg, color=\"orange\", alpha=0.2)\n\nax.set_xlabel(\"Longitude\")\nax.set_ylabel(\"Latitude\")\nax.set_title(\"KML Polygons - New Delhi & Gurugram\")\nax.legend()\n\nplt.show()\n","key":"mNtlOG7VZL"},{"type":"output","id":"ajUyatTZX_xdNk3iPX1fz","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b9cf7694b2a4481ad0aa0dd7fabb9285","path":"/eodashboard-notebooks/build/b9cf7694b2a4481ad0aa0dd7fabb9285.png"},"text/plain":{"content":"<Figure size 800x800 with 1 Axes>","content_type":"text/plain"}}}],"key":"SiP2qmIS8p"}],"key":"dfxiQzfQtu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import IPython.display\nfrom shapely.geometry import Polygon\nfrom pykml import parser\nfrom sentinelhub import Geometry, CRS\n\n# Loading the polygon from KML\ndef load_polygon_from_kml(kml_path):\n    with open(kml_path) as f:\n        root = parser.parse(f).getroot()\n    coords_text = root.Document.Placemark.Polygon.outerBoundaryIs.LinearRing.coordinates.text\n    polygon_coords = [tuple(map(float, c.split(\",\")[:2])) for c in coords_text.strip().split()]\n    return Polygon(polygon_coords)\n\n# Load polygons\npolygon_gg = load_polygon_from_kml(\"Cities/Gurugram.kml\")\npolygon_nd = load_polygon_from_kml(\"Cities/NewDehli_2.kml\")\n\n# Convert to Sentinel Hub Geometry\ngeometry_gg = Geometry(polygon_gg, crs=CRS.WGS84)\ngeometry_nd = Geometry(polygon_nd, crs=CRS.WGS84)\n\n# Display both as GeoJSON\nIPython.display.GeoJSON({\n    \"type\": \"FeatureCollection\",\n    \"features\": [\n        {\"type\": \"Feature\", \"geometry\": geometry_gg.get_geojson(), \"properties\": {\"name\": \"Gurugram\"}},\n        {\"type\": \"Feature\", \"geometry\": geometry_nd.get_geojson(), \"properties\": {\"name\": \"New Delhi\"}}\n    ]\n})\n","key":"LUrCrycHEu"},{"type":"output","id":"8AuGbfBWQ7CBNwmc-x5nv","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"features\":[{\"geometry\":{\"coordinates\":[[[76.92104194336623,28.46895416879204],[76.90419066332704,28.44723442533183],[76.89966844400841,28.44017003073048],[76.89999484023316,28.41439702194507],[76.91746266101553,28.39693083773744],[76.91300085324843,28.36709601410939],[76.93072764553813,28.35510721325448],[76.94358074325434,28.35605302086163],[76.96219356818659,28.32868749525284],[76.99603400094871,28.34094104639951],[77.0029293239089,28.38477827357614],[77.03061988003722,28.40171205229376],[77.06432616501166,28.39374637972753],[77.1100590854022,28.40326151072429],[77.11966936217398,28.42233708461656],[77.13112165717757,28.43833761812272],[77.12407981351575,28.4502724629229],[77.11311401957998,28.47434369236982],[77.12254841654426,28.49412041695967],[77.10375482290029,28.50312430997523],[77.09271264491943,28.51428666479668],[77.0722429547925,28.5218552725012],[77.06732110460119,28.51105737347774],[77.0472505525502,28.51682031353789],[77.04725287857431,28.52294101737376],[77.0083150707579,28.54563851262447],[77.00013071163998,28.5308612881211],[77.01570634407446,28.52761874601626],[77.00996493761997,28.51790452729487],[76.99767904761575,28.5196984048267],[76.98783275915494,28.51321931623888],[76.97882776842332,28.5243733110867],[76.95133586321083,28.50456018614536],[76.92343792937302,28.49066206894654],[76.92104194336623,28.46895416879204]]],\"crs\":{\"properties\":{\"name\":\"urn:ogc:def:crs:EPSG::4326\"},\"type\":\"name\"},\"type\":\"Polygon\"},\"properties\":{\"name\":\"Gurugram\"},\"type\":\"Feature\"},{\"geometry\":{\"coordinates\":[[[77.17665351883295,28.40113955609438],[77.22971578797626,28.41830438577754],[77.25983840515659,28.44173420066867],[77.23085535403075,28.45861172517078],[77.28266527975191,28.49267641240498],[77.32490033569249,28.48642767622731],[77.35258949268491,28.50660590525096],[77.30547776568866,28.53721840996181],[77.30052874782285,28.58592801075305],[77.34031346655208,28.61142416254651],[77.31852526135228,28.63468366519955],[77.34139787763952,28.66967073399425],[77.33590799415862,28.69521201076229],[77.33504994275198,28.7120303559752],[77.28692622044734,28.70770789805663],[77.27353654037898,28.74052074100165],[77.25539047203772,28.74154689442576],[77.22750827763338,28.75950204271809],[77.2310344025987,28.79235217890129],[77.2031619840092,28.80077351119819],[77.22487249416324,28.82624359210761],[77.2089746416205,28.85802836682388],[77.17021047415585,28.85583183843851],[77.16062928575813,28.83565704655502],[77.14002998229729,28.83560948454578],[77.13136626547725,28.86529456730527],[77.07912123530721,28.88002141831441],[77.06220374775194,28.87042233176457],[77.03939521064731,28.83745467888498],[76.99083852585329,28.841541131314],[76.94123539998786,28.80425389620624],[76.8913579367866,28.80407412215598],[76.86610220409891,28.75833631606236],[76.92333347436902,28.72610803980989],[76.91639791936558,28.70523201776579],[76.93189294417512,28.67334560571172],[76.9017169752783,28.65344677048775],[76.94222683547048,28.63771101011329],[76.935018141179,28.62494713777486],[76.891268962733,28.62897620485638],[76.89022704407101,28.58000924282611],[76.87911894236767,28.55789885007587],[76.8456552047984,28.54593694307601],[76.8688094470968,28.53439891525375],[76.8909079061369,28.49632496837567],[76.92237730666523,28.50818156976184],[76.95269530458332,28.50835147584602],[76.98019171353535,28.52624281549836],[76.98980293775826,28.51326846870477],[77.00052603990964,28.52113718859574],[77.01082974064818,28.51581207832031],[77.01505056871656,28.52663522877133],[77.00025108969604,28.53197326799641],[77.00647845728078,28.54592499551361],[77.01667967141043,28.54684714706334],[77.04466328537389,28.52343342027408],[77.05911731342435,28.51623175939925],[77.06284281630597,28.50357715211162],[77.07550261641148,28.52518054079617],[77.09684610436067,28.51394071582989],[77.11969091842519,28.49108658267981],[77.11720049527544,28.47275394551406],[77.12507725258011,28.45493416318916],[77.13913636895973,28.43527632672271],[77.17665351883295,28.40113955609438]]],\"crs\":{\"properties\":{\"name\":\"urn:ogc:def:crs:EPSG::4326\"},\"type\":\"name\"},\"type\":\"Polygon\"},\"properties\":{\"name\":\"New Delhi\"},\"type\":\"Feature\"}],\"type\":\"FeatureCollection\"}","content_type":"application/geo+json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"key":"rWABs3TCnq"}],"key":"EuHa60GPnl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import requests\nfrom io import BytesIO\nfrom PIL import Image\nimport numpy as np\nimport mercantile\nfrom shapely.geometry import Point, Polygon, mapping\nimport folium\nfrom folium.raster_layers import ImageOverlay\nfrom pykml import parser\n\n# Loading polygons\ndef load_polygon_from_kml(kml_path):\n    with open(kml_path) as f:\n        root = parser.parse(f).getroot()\n    coords_text = root.Document.Placemark.Polygon.outerBoundaryIs.LinearRing.coordinates.text\n    polygon_coords = [tuple(map(float, c.split(\",\")[:2])) for c in coords_text.strip().split()]\n    return Polygon(polygon_coords)\n\n# Fetch the COG into tile\ndef get_tile_image(lon, lat, zoom, cog_path, base_url):\n    tile = mercantile.tile(lon, lat, zoom)\n    url = (\n        f\"{base_url}/{tile.z}/{tile.x}/{tile.y}\"\n        f\"?url={cog_path}&resampling_method=nearest&bidx=1\"\n        f\"&colormap_name=viridis&rescale=0,100\"\n    )\n    response = requests.get(url)\n    img = Image.open(BytesIO(response.content)).convert(\"RGBA\")\n    return np.array(img), tile\n\n# Cropping tile to polyong of each city\ndef crop_to_polygon(img_array, tile, polygon):\n    height, width = img_array.shape[:2]\n    lon_ul, lat_ul = mercantile.ul(tile.x, tile.y, tile.z).lng, mercantile.ul(tile.x, tile.y, tile.z).lat\n    lon_lr, lat_lr = mercantile.ul(tile.x+1, tile.y+1, tile.z).lng, mercantile.ul(tile.x+1, tile.y+1, tile.z).lat\n    res_lon = (lon_lr - lon_ul) / width\n    res_lat = (lat_lr - lat_ul) / height\n\n    mask = np.zeros((height, width), dtype=bool)\n    for i in range(height):\n        for j in range(width):\n            lon_p = lon_ul + j * res_lon\n            lat_p = lat_ul + i * res_lat\n            if polygon.contains(Point(lon_p, lat_p)):\n                mask[i, j] = True\n    img_array[~mask] = [0, 0, 0, 0]\n    return img_array\n\n\nzoom = 8\nbase_url = \"https://openveda.cloud/api/raster/cog/tiles/WebMercatorQuad\"\ncog_path = \"s3://veda-data-store/grdi-v1-raster/povmap-grdi-v1_2010-01-01_2021-12-31.tif\"\n\n#Loading polygons \npolygon_nd = load_polygon_from_kml(\"Cities/NewDehli_2.kml\")\npolygon_gg = load_polygon_from_kml(\"Cities/Gurugram.kml\")\n\n# Fetch and crop tiles ---\nlon_nd, lat_nd = 77.209581, 28.646138\nimg_nd, tile_nd = get_tile_image(lon_nd, lat_nd, zoom, cog_path, base_url)\nimg_nd = crop_to_polygon(img_nd, tile_nd, polygon_nd)\n\nlon_gg, lat_gg = 77.054362, 28.453160\nimg_gg, tile_gg = get_tile_image(lon_gg, lat_gg, zoom, cog_path, base_url)\nimg_gg = crop_to_polygon(img_gg, tile_gg, polygon_gg)\n\n# Creating interactive map \ncenter_lat, center_lon = 28.55, 77.13\nm = folium.Map(location=[center_lat, center_lon], zoom_start=11)\n\n# Add New Delhi overlay\nul_lat, ul_lon = mercantile.ul(tile_nd.x, tile_nd.y, tile_nd.z).lat, mercantile.ul(tile_nd.x, tile_nd.y, tile_nd.z).lng\nlr_lat, lr_lon = mercantile.ul(tile_nd.x+1, tile_nd.y+1, tile_nd.z).lat, mercantile.ul(tile_nd.x+1, tile_nd.y+1, tile_nd.z).lng\nImageOverlay(image=img_nd, bounds=[[lr_lat, ul_lon], [ul_lat, lr_lon]], opacity=0.6).add_to(m)\n\n# Add Gurugram overlay\nul_lat, ul_lon = mercantile.ul(tile_gg.x, tile_gg.y, tile_gg.z).lat, mercantile.ul(tile_gg.x, tile_gg.y, tile_gg.z).lng\nlr_lat, lr_lon = mercantile.ul(tile_gg.x+1, tile_gg.y+1, tile_gg.z).lat, mercantile.ul(tile_gg.x+1, tile_gg.y+1, tile_gg.z).lng\nImageOverlay(image=img_gg, bounds=[[lr_lat, ul_lon], [ul_lat, lr_lon]], opacity=0.6).add_to(m)\n\n# --- Add borders on top of raster overlays ---\n# New Delhi border (skyblue)\nfolium.Polygon(\n    locations=[(lat, lon) for lon, lat in polygon_nd.exterior.coords],\n    color='skyblue',\n    weight=3,\n    fill=False\n).add_to(m)\n\n# Gurugram border (orange)\nfolium.Polygon(\n    locations=[(lat, lon) for lon, lat in polygon_gg.exterior.coords],\n    color='orange',\n    weight=3,\n    fill=False\n).add_to(m)\n\n# Display map\nm\n\n","key":"UDFepAZAs9"},{"type":"output","id":"cPoGo-jQmoTcyAS_xK0V5","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/html":{"content":"<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_3b1d1e8901160681da8022a6618646ff {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n    \n            \n                &lt;style&gt;\n                    .leaflet-image-layer {\n                        /* old android/safari*/\n                        image-rendering: -webkit-optimize-contrast;\n                        image-rendering: crisp-edges; /* safari */\n                        image-rendering: pixelated; /* chrome */\n                        image-rendering: -moz-crisp-edges; /* firefox */\n                        image-rendering: -o-crisp-edges; /* opera */\n                        -ms-interpolation-mode: nearest-neighbor; /* ie */\n                    }\n                &lt;/style&gt;\n            \n        \n    \n            \n                &lt;style&gt;\n                    .leaflet-image-layer {\n                        /* old android/safari*/\n                        image-rendering: -webkit-optimize-contrast;\n                        image-rendering: crisp-edges; /* safari */\n                        image-rendering: pixelated; /* chrome */\n                        image-rendering: -moz-crisp-edges; /* firefox */\n                        image-rendering: -o-crisp-edges; /* opera */\n                        -ms-interpolation-mode: nearest-neighbor; /* ie */\n                    }\n                &lt;/style&gt;\n            \n        \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_3b1d1e8901160681da8022a6618646ff&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_3b1d1e8901160681da8022a6618646ff = L.map(\n                &quot;map_3b1d1e8901160681da8022a6618646ff&quot;,\n                {\n                    center: [28.55, 77.13],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 11,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n}\n\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_b92ebb5c9e9b93a004a204ec6f3ef4b7 = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 19,\n  &quot;maxNativeZoom&quot;: 19,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_b92ebb5c9e9b93a004a204ec6f3ef4b7.addTo(map_3b1d1e8901160681da8022a6618646ff);\n        \n    \n            var image_overlay_00f8fc45e80a7e4cd3656d0595ddbb31 = L.imageOverlay(\n                &quot;data:image/png;base64,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&quot;,\n                [[28.304380682962773, 75.9375], [29.535229562948455, 77.34375]],\n                {\n  &quot;opacity&quot;: 0.6,\n}\n            );\n        \n    \n            image_overlay_00f8fc45e80a7e4cd3656d0595ddbb31.addTo(map_3b1d1e8901160681da8022a6618646ff);\n        \n    \n            var image_overlay_42d575ba7892a374b994da87e6271e1b = L.imageOverlay(\n                &quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAE2UlEQVR42u3diWscVRwH8PqPJE3aNE2bntrWNk1qD9F64VHFG1S8xQsRFdv0yNHN7oyCIKIIRVER8foLn/m9OOlkyYYas2mS/XzgS65ZAvN4v33z5r3ZbdsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGfjDzaSswA9auyxuXT2xDVFAHrN6PtlqgpAFWcFesTw52U6dd/1dPLhuZy7n2oqAtCLTjzRTJHxhxo5Z8cUAtgy9r1XptOnZ9JKnb+9ACxXBE7dO6swwGYy9uhcmrj/eh7u5048//XE483FTJxvLGT+mCpxTHV8XfX3e84pBLApOn+9AFS51QJwZmI6nRmfyomf6wUgXuMMwwbV9/311P9VM+fg68Vi5z35yNySzv5fEusGIlURMBKADebcHRdy1qsAxNyBsw632ejfF9Pe+ez+YzJncK5II5+WOUdeaC124uiwqy0AnWI0ALfxHX/PX5dSZPj3y2notys5R59rpdEPy5zhS2U68FaRs1JHHv2gzIk1AZFbLQBHnm/lxOIiLQIKALAetn/RStt/ms7p/2EmHXq1yKlfs8fP1b3+1Q7z6+sF2of/d75U5GgNUACA9TJQtNK+d8uckU/KPMvfPtO/a7JMQ9eKnG5MAO7+rMzRGrCe7/5fttLAz9Op78bsQr5tLL4bH3yjSLHhJ1Lduvs/iTmBTqOIXZfLHC0CCgDQbdWw+8CbRTr6bCtn70flkmv2uBMQWYuhft4s9EAjp/77mF8YbCwk7jZoGeiyoatlUgCgR/V911ic7a8PzesF4PiTzXTXi0XOWk/8ReobjaqJxyhMwxcVAeiaWPKrAECP2vHr1TTwy1Q69kwrJ0/K/bulN1b67ZxZyI7ZIt/+i3SjACyXKECHXitytBR0Y/h/YzYdv3DzXT+u/asFP/XFOrHXf7BZ5MRy4dgRWO0KrL97r2V2ThX5/2olUACAtRaz8J2W5R5+uVgsBtUdgsjhV27OA8Qz/+qvrX/fXkjaj72VTUFaCHq0AGgd6LKVnugTM//L7QWI5/53ek11fMfOvswzAxUAuE3W4lp9uSKxZP5glTsHtQ5sgiLQjQKgVWAdVct/6x21U6eNS4BqGW98HuBKnbjTcwB0fNiARWCtCkCn/1EvAM44bKRLgfONdOzpVu7Ukfi+00aeamNQ++YgZxF6tAA4g7BJLXcvv9Mk3v63Fx4XFokHhMQGImcQtkABaE+1+Cc25sTS3EjsGqxm/vu/bnp8NygAwOa9/l/h/n21Gag6JuYGqg/72HWltF0XtkoRUADA5UDu9DHE3/9OmVO/C7Dn4zJfEkRia3BsEXbWYAtSAKDHte/+iweBxCcIRfp/nNH5YSuLzwuMa/2Y7Y/Egzrjk4Mjfd/MKQCw1XUqAM4M9ICRPyd1egAAAACg9/wDz7zp1bkJFSAAAAAASUVORK5CYII=&quot;,\n                [[28.304380682962773, 75.9375], [29.535229562948455, 77.34375]],\n                {\n  &quot;opacity&quot;: 0.6,\n}\n            );\n        \n    \n            image_overlay_42d575ba7892a374b994da87e6271e1b.addTo(map_3b1d1e8901160681da8022a6618646ff);\n        \n    \n            var polygon_3f0b04d67d093b46bcf735925a3b3917 = L.polygon(\n                [[28.40113955609438, 77.17665351883295], [28.41830438577754, 77.22971578797626], [28.44173420066867, 77.25983840515659], [28.45861172517078, 77.23085535403075], [28.49267641240498, 77.28266527975191], [28.48642767622731, 77.32490033569249], [28.50660590525096, 77.35258949268491], [28.53721840996181, 77.30547776568866], [28.58592801075305, 77.30052874782285], [28.61142416254651, 77.34031346655208], [28.63468366519955, 77.31852526135228], [28.66967073399425, 77.34139787763952], [28.69521201076229, 77.33590799415862], [28.7120303559752, 77.33504994275198], [28.70770789805663, 77.28692622044734], [28.74052074100165, 77.27353654037898], [28.74154689442576, 77.25539047203772], [28.75950204271809, 77.22750827763338], [28.79235217890129, 77.2310344025987], [28.80077351119819, 77.2031619840092], [28.82624359210761, 77.22487249416324], [28.85802836682388, 77.2089746416205], [28.85583183843851, 77.17021047415585], [28.83565704655502, 77.16062928575813], [28.83560948454578, 77.14002998229729], [28.86529456730527, 77.13136626547725], [28.88002141831441, 77.07912123530721], [28.87042233176457, 77.06220374775194], [28.83745467888498, 77.03939521064731], [28.841541131314, 76.99083852585329], [28.80425389620624, 76.94123539998786], [28.80407412215598, 76.8913579367866], [28.75833631606236, 76.86610220409891], [28.72610803980989, 76.92333347436902], [28.70523201776579, 76.91639791936558], [28.67334560571172, 76.93189294417512], [28.65344677048775, 76.9017169752783], [28.63771101011329, 76.94222683547048], [28.62494713777486, 76.935018141179], [28.62897620485638, 76.891268962733], [28.58000924282611, 76.89022704407101], [28.55789885007587, 76.87911894236767], [28.54593694307601, 76.8456552047984], [28.53439891525375, 76.8688094470968], [28.49632496837567, 76.8909079061369], [28.50818156976184, 76.92237730666523], [28.50835147584602, 76.95269530458332], [28.52624281549836, 76.98019171353535], [28.51326846870477, 76.98980293775826], [28.52113718859574, 77.00052603990964], [28.51581207832031, 77.01082974064818], [28.52663522877133, 77.01505056871656], [28.53197326799641, 77.00025108969604], [28.54592499551361, 77.00647845728078], [28.54684714706334, 77.01667967141043], [28.52343342027408, 77.04466328537389], [28.51623175939925, 77.05911731342435], [28.50357715211162, 77.06284281630597], [28.52518054079617, 77.07550261641148], [28.51394071582989, 77.09684610436067], [28.49108658267981, 77.11969091842519], [28.47275394551406, 77.11720049527544], [28.45493416318916, 77.12507725258011], [28.43527632672271, 77.13913636895973], [28.40113955609438, 77.17665351883295]],\n                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;skyblue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: false, &quot;fillColor&quot;: &quot;skyblue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;noClip&quot;: false, &quot;opacity&quot;: 1.0, &quot;smoothFactor&quot;: 1.0, &quot;stroke&quot;: true, &quot;weight&quot;: 3}\n            ).addTo(map_3b1d1e8901160681da8022a6618646ff);\n        \n    \n            var polygon_d6a250fe3ab78781c7678fcc55002bc6 = L.polygon(\n                [[28.46895416879204, 76.92104194336623], [28.44723442533183, 76.90419066332704], [28.44017003073048, 76.89966844400841], [28.41439702194507, 76.89999484023316], [28.39693083773744, 76.91746266101553], [28.36709601410939, 76.91300085324843], [28.35510721325448, 76.93072764553813], [28.35605302086163, 76.94358074325434], [28.32868749525284, 76.96219356818659], [28.34094104639951, 76.99603400094871], [28.38477827357614, 77.0029293239089], [28.40171205229376, 77.03061988003722], [28.39374637972753, 77.06432616501166], [28.40326151072429, 77.1100590854022], [28.42233708461656, 77.11966936217398], [28.43833761812272, 77.13112165717757], [28.4502724629229, 77.12407981351575], [28.47434369236982, 77.11311401957998], [28.49412041695967, 77.12254841654426], [28.50312430997523, 77.10375482290029], [28.51428666479668, 77.09271264491943], [28.5218552725012, 77.0722429547925], [28.51105737347774, 77.06732110460119], [28.51682031353789, 77.0472505525502], [28.52294101737376, 77.04725287857431], [28.54563851262447, 77.0083150707579], [28.5308612881211, 77.00013071163998], [28.52761874601626, 77.01570634407446], [28.51790452729487, 77.00996493761997], [28.5196984048267, 76.99767904761575], [28.51321931623888, 76.98783275915494], [28.5243733110867, 76.97882776842332], [28.50456018614536, 76.95133586321083], [28.49066206894654, 76.92343792937302], [28.46895416879204, 76.92104194336623]],\n                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;orange&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: false, &quot;fillColor&quot;: &quot;orange&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;noClip&quot;: false, &quot;opacity&quot;: 1.0, &quot;smoothFactor&quot;: 1.0, &quot;stroke&quot;: true, &quot;weight&quot;: 3}\n            ).addTo(map_3b1d1e8901160681da8022a6618646ff);\n        \n&lt;/script&gt;\n&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>","content_type":"text/html"},"text/plain":{"content":"<folium.folium.Map at 0x7fd7d127e3e0>","content_type":"text/plain"}}}],"key":"lOQM7rTyQG"}],"key":"NpHSPrXma0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\n# Loading polyong from KML\ndef load_polygon(kml_path):\n    with open(kml_path) as f:\n        root = parser.parse(f).getroot()\n    coords_text = root.Document.Placemark.Polygon.outerBoundaryIs.LinearRing.coordinates.text\n    polygon_coords = [tuple(map(float, c.split(\",\")[:2])) for c in coords_text.strip().split()]\n    return Polygon(polygon_coords)\n\n# --- Helper: fetch one tile ---\nbase_url = \"https://openveda.cloud/api/raster/cog/tiles/WebMercatorQuad\"\ncog_path = \"s3://veda-data-store/grdi-v1-raster/povmap-grdi-v1_2010-01-01_2021-12-31.tif\"\n\ndef fetch_tile(tile):\n    url = (\n        f\"{base_url}/{tile.z}/{tile.x}/{tile.y}\"\n        f\"?url={cog_path}&resampling_method=nearest&bidx=1\"\n        f\"&colormap_name=viridis&rescale=0,100\"\n    )\n    response = requests.get(url)\n    return Image.open(BytesIO(response.content))\n\n# --- Function: compute masked average for a polygon ---\ndef compute_average_grdi(polygon, zoom=12):\n    min_lon, min_lat, max_lon, max_lat = polygon.bounds\n    tiles_to_fetch = list(mercantile.tiles(min_lon, min_lat, max_lon, max_lat, zoom))\n    all_values = []\n\n    for tile in tiles_to_fetch:\n        img = fetch_tile(tile)\n        img_array = np.array(img.convert(\"L\"))\n        \n        mask = np.zeros(img_array.shape, dtype=bool)\n        width, height = img.size\n\n        # Upper-left corner of the tile\n        lon_ul, lat_ul = mercantile.ul(tile.x, tile.y, tile.z).lng, mercantile.ul(tile.x, tile.y, tile.z).lat\n        # Lower-right corner\n        lon_lr, lat_lr = mercantile.ul(tile.x+1, tile.y+1, tile.z).lng, mercantile.ul(tile.x+1, tile.y+1, tile.z).lat\n        # Resolution\n        res_lon = (lon_lr - lon_ul) / width\n        res_lat = (lat_lr - lat_ul) / height\n\n        for i in range(height):\n            for j in range(width):\n                lon = lon_ul + j * res_lon\n                lat = lat_ul + i * res_lat\n                if polygon.contains(Point(lon, lat)):\n                    mask[i, j] = True\n\n        values = img_array[mask]\n        all_values.extend(values)\n\n    return np.mean(all_values) if all_values else np.nan\n\n# --- Run for New Delhi and Gurugram ---\npolygon_nd = load_polygon(\"Cities/NewDehli_2.kml\")\npolygon_gg = load_polygon(\"Cities/Gurugram.kml\")\n\navg_nd = compute_average_grdi(polygon_nd, zoom=12)\navg_gg = compute_average_grdi(polygon_gg, zoom=12)\n\nprint(\"Average GRDI for New Delhi:\", avg_nd)\nprint(\"Average GRDI for Gurugram:\", avg_gg)\n\n\n# --- Plot bar chart of masked GRDI averages ---\nimport matplotlib.pyplot as plt\n\naverages = {\n    \"New Delhi\": avg_nd,\n    \"Gurugram\": avg_gg\n}\n\nplt.figure(figsize=(6, 4))\nplt.bar(averages.keys(), averages.values(), color=['skyblue', 'orange'])\nplt.ylabel(\"Average GRDI Value\")\nplt.title(\"Average GRDI (Masked by KML Polygons)\")\nfor i, v in enumerate(averages.values()):\n    plt.text(i, v + 0.5, f\"{v:.1f}\", ha='center', fontsize=10, fontweight='bold')\nplt.ylim(0, max(averages.values()) * 1.2)\nplt.show()\n\n\n","key":"ylZ0i3WfGB"},{"type":"output","id":"x3qnjTlEkT4wl_aRRlpTy","data":[{"name":"stdout","output_type":"stream","text":"Average GRDI for New Delhi: 82.39458559144447\nAverage GRDI for Gurugram: 82.42232829070716\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a24e47b68793630c0799518b58908c83","path":"/eodashboard-notebooks/build/a24e47b68793630c0799518b58908c83.png"},"text/plain":{"content":"<Figure size 600x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"a4MOEqHSep"}],"key":"EusUGIpadj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"hfwYlmNlb1"},{"type":"output","id":"1gZEsCScDW6ZZ3f25ymJX","data":[],"key":"mx7qcrGK0C"}],"key":"V1oR1Arc0z"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n\n# Loading polyong from KML\ndef load_polygon(kml_path):\n    with open(kml_path) as f:\n        root = parser.parse(f).getroot()\n    coords_text = root.Document.Placemark.Polygon.outerBoundaryIs.LinearRing.coordinates.text\n    polygon_coords = [tuple(map(float, c.split(\",\")[:2])) for c in coords_text.strip().split()]\n    return Polygon(polygon_coords)\n\n# --- Helper: fetch one tile ---\nbase_url = \"https://openveda.cloud/api/raster/cog/tiles/WebMercatorQuad\"\n#cog_path = \"s3://veda-data-store/grdi-v1-raster/povmap-grdi-v1_2010-01-01_2021-12-31.tif\"\ncog_path = \"s3://veda-data-store-staging/grdi-vnl-slope-raster/povmap-grdi-v1_VNL-slope_2012-01-01_2020-12-31.tif\"\n\ndef fetch_tile(tile):\n    url = (\n        f\"{base_url}/{tile.z}/{tile.x}/{tile.y}\"\n        f\"?url={cog_path}&resampling_method=nearest&bidx=1\"\n        f\"&colormap_name=viridis&rescale=0,100\"\n    )\n    response = requests.get(url)\n    return Image.open(BytesIO(response.content))\n\n# --- Function: compute masked average for a polygon ---\ndef compute_average_grdi(polygon, zoom=12):\n    min_lon, min_lat, max_lon, max_lat = polygon.bounds\n    tiles_to_fetch = list(mercantile.tiles(min_lon, min_lat, max_lon, max_lat, zoom))\n    all_values = []\n\n    for tile in tiles_to_fetch:\n        img = fetch_tile(tile)\n        img_array = np.array(img.convert(\"L\"))\n        \n        mask = np.zeros(img_array.shape, dtype=bool)\n        width, height = img.size\n\n        # Upper-left corner of the tile\n        lon_ul, lat_ul = mercantile.ul(tile.x, tile.y, tile.z).lng, mercantile.ul(tile.x, tile.y, tile.z).lat\n        # Lower-right corner\n        lon_lr, lat_lr = mercantile.ul(tile.x+1, tile.y+1, tile.z).lng, mercantile.ul(tile.x+1, tile.y+1, tile.z).lat\n        # Resolution\n        res_lon = (lon_lr - lon_ul) / width\n        res_lat = (lat_lr - lat_ul) / height\n\n        for i in range(height):\n            for j in range(width):\n                lon = lon_ul + j * res_lon\n                lat = lat_ul + i * res_lat\n                if polygon.contains(Point(lon, lat)):\n                    mask[i, j] = True\n\n        values = img_array[mask]\n        all_values.extend(values)\n\n    return np.mean(all_values) if all_values else np.nan\n\n# --- Run for New Delhi and Gurugram ---\npolygon_nd = load_polygon(\"Cities/NewDehli_2.kml\")\npolygon_gg = load_polygon(\"Cities/Gurugram.kml\")\n\navg_nd = compute_average_grdi(polygon_nd, zoom=12)\navg_gg = compute_average_grdi(polygon_gg, zoom=12)\n\nprint(\"Average GRDI for New Delhi:\", avg_nd)\nprint(\"Average GRDI for Gurugram:\", avg_gg)\n\n\n# --- Plot bar chart of masked GRDI averages ---\nimport matplotlib.pyplot as plt\n\naverages = {\n    \"New Delhi\": avg_nd,\n    \"Gurugram\": avg_gg\n}\n\nplt.figure(figsize=(6, 4))\nplt.bar(averages.keys(), averages.values(), color=['skyblue', 'orange'])\nplt.ylabel(\"Average GRDI Value\")\nplt.title(\"Average GRDI (Masked by KML Polygons)\")\nfor i, v in enumerate(averages.values()):\n    plt.text(i, v + 0.5, f\"{v:.1f}\", ha='center', fontsize=10, fontweight='bold')\nplt.ylim(0, max(averages.values()) * 1.2)\nplt.show()\n\n\n","key":"U1YlZaH0NL"},{"type":"output","id":"pqDMBI35eGSAVR5qgwODr","data":[{"name":"stdout","output_type":"stream","text":"Average GRDI for New Delhi: 132.1962468386444\nAverage GRDI for Gurugram: 76.94425441170156\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"8e38c37e7ced205357e91a3c21d12078","path":"/eodashboard-notebooks/build/8e38c37e7ced205357e91a3c21d12078.png"},"text/plain":{"content":"<Figure size 600x400 with 1 Axes>","content_type":"text/plain"}}}],"key":"gfYoBvsCSG"}],"key":"tBdjlJEach"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"","key":"hXvfVlxhnI"},{"type":"output","id":"1t-z3w1XoV3hzpk3Y_aTb","data":[],"key":"UVbbMBtPNJ"}],"key":"BEWtGrE8jl"}],"key":"xT2Th8fMkM"},"references":{"cite":{"order":["2021"],"data":{"2021":{"label":"2021","enumerator":"1","doi":"10.11487/oukan.2021.0_B-4-4","html":"東城文柄. (2021). 地球観測衛星データの公衆衛生学への応用. In <i>横幹連合コンファレンス予稿集</i> (No. 0; Vol. 2021). 特定非営利活動法人　横断型基幹科学技術研究団体連合. <a target=\"_blank\" rel=\"noreferrer\" href=\"https://doi.org/10.11487/oukan.2021.0_B-4-4\">10.11487/oukan.2021.0_B-4-4</a>","url":"https://doi.org/10.11487/oukan.2021.0_B-4-4"}}}},"footer":{"navigation":{"prev":{"title":"2025-BiDS-EODashboard","url":"/external-notebooks/group1/2025-bids-eodashboard/readme","group":"2025 Bi DS EO Dashboard"},"next":{"title":"Evaluation of Fire Impact on Populated Areas on a European Site","url":"/notebooks/fire-impact-analysis","group":"Notebooks"}}},"domain":"http://localhost:3000"}