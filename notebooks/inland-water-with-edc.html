<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Exploring Inland Water Bodies with Sentinel-2 data in EDC - EO Dashboard Notebooks</title><meta property="og:title" content="Exploring Inland Water Bodies with Sentinel-2 data in EDC - EO Dashboard Notebooks"/><meta name="generator" content="mystmd"/><meta name="description" content="Collection of examples relevant to the EO Dashboard project"/><meta property="og:description" content="Collection of examples relevant to the EO Dashboard project"/><meta name="keywords" content=""/><link rel="stylesheet" href="/eodashboard-notebooks/build/_assets/app-SP33RAUV.css"/><link rel="stylesheet" href="/eodashboard-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/eodashboard-notebooks/favicon.ico"/><link rel="stylesheet" href="/eodashboard-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/eodashboard-notebooks/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R74op:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-none pr-2 smallcaps">Notebook examples</div><div class="flex-grow"></div><a href="https://github.com/ESA-eodashboards/eodashboard-notebooks" title="GitHub Repository: ESA-eodashboards/eodashboard-notebooks" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><a href="https://github.com/ESA-eodashboards/eodashboard-notebooks/blob/main/notebooks/Inland_water_with_EDC.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8top:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Exploring Inland Water Bodies with Sentinel-2 data in EDC</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="vzFFAsujsK" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from edc import check_compatibility
check_compatibility(&quot;user-2023.03-02&quot;, dependencies=[&quot;SH&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NtZ1aKXpBzkY4jqPV-7LA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="nPYCpJU7iH" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/><p>author: Anca Anghelea, based on a <a target="_blank" rel="noreferrer" href="https://eurodatacube.com/notebooks/curated/Exploring_time_and_space_with_EDC.ipynb" class="">notebook by: <em>William Ray</em></a></p><p>Several lakes and other inland water bodies are featured on EO Dashboard. The datasets supporting the various geo-stories are accessible by means similar to what you will learn in this notebook.</p><p><a target="_blank" rel="noreferrer" href="https://eodashboard.org/oceans" class="">Explore EO Dashboard Stories on Oceans and Inland Water</a>.</p><h2 id="in-this-notebook" class="relative group"><span class="heading-text">In this notebook</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#in-this-notebook" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In this demonstration Jupyter Notebook, we will be visualising and analysing inland water bodies using Sentinel data, demonstrating the use of EDC.</p><p>We are going to use the EDC and its associated libaries and APIs to do this. In this notebook we will learn how to:</p><ul><li>Build a cube</li><li>Visualise a variable in your data cube</li><li>Create a new variable</li><li>Create a new variable using a threshold</li><li>Visualise a spatial subset of a variable over time</li><li>Create a new variable based upon space and time.</li></ul></div><div id="f5fwLqibBe" class="relative group/block"><h2 id="configuration" class="relative group"><span class="heading-text">Configuration</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#configuration" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Before acccessing the data, we will start by importing the necessary Python libraries (already configured in your EDC workspace), and generate credentials automatically to access the services.</p></div><div id="bNGLjVC4ZT" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># EDC libraries
from edc import setup_environment_variables
from xcube_sh.config import CubeConfig
from xcube_sh.cube import open_cube
from xcube_sh.sentinelhub import SentinelHub
from xcube.core.gen2.local.combiner import CubesCombiner
from xcube.core.geom import mask_dataset_by_geometry

# Sentinel Hub
from sentinelhub import BBox, SentinelHubRequest, bbox_to_dimensions, DataCollection, MimeType, SHConfig, geometry

# Utilities
import IPython.display
from os import environ
import matplotlib.pyplot as plt
import datetime as dt
import geopandas
import rioxarray

# Numerical computation
import xarray as xr
import numpy as np

# Fetch credentials as environement variables
setup_environment_variables()

# Pass Sentinel Hub credentials to dictionnary
sh_credentials = dict(client_id=environ[&quot;SH_CLIENT_ID&quot;],
                      client_secret=environ[&quot;SH_CLIENT_SECRET&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xTxqfQhdoFHQnA6FQ9vz7" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="dvm9yqmkyJ" class="relative group/block"><p><em><strong>Define an AOI</strong></em></p><p>Next, we will define our area of interest using a bounding box. This must be provided in WGS84 coordinates to build the cube.</p><p>We have chosen an AOI covering the natural park “Valli di Comacchio” in Italy.</p></div><div id="Pwlmrqk9UV" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define the coordinates of the bounding box
lake_bbox = [12.09, 44.54, 12.27, 44.70]

# Bbox EPSG
bbox_epsg = 4326
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qExHVhYS61U12FCfwURAS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iEanO96q2u" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot the bounding box on a map
IPython.display.GeoJSON(BBox(lake_bbox,crs=bbox_epsg).get_geojson())</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="S-fo5k2MxHSubzXmD3fai" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="YjGaZ6txiv" class="relative group/block"><h3 id="how-to-build-a-data-cube" class="relative group"><span class="heading-text">How to build a data cube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#how-to-build-a-data-cube" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Firstly, we will go through how to build a data cube.</p><p>We are going to visualise the floods using Sentinel-2 imagery. Sentinel-2 is part of the Copernicus programme and collects multispectral data globally with a revisit time of 5 days. The satellite’s multispectral imager provides collects data in 13 spectral bands spanning from the visible and near infrared to the shortwave infrared. The visible and near infrared data we will use in this example is collected at 10m resolution.</p><p><em><strong>Check Sentinel-2 L2A available bands</strong></em></p><p>Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset to help us build the cube!</p></div><div id="gtA3A1JYaF" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Create a Sentinel Hub class, using our Sentinel Hub credentials
SH = SentinelHub(**sh_credentials)

# List bands for S2-L2A
SH.band_names(&#x27;S2L2A&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Rherdcr2TNiKsRkthNPff" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="font-mono text-sm whitespace-pre-wrap"><code><span>[&#x27;B01&#x27;,
 &#x27;B02&#x27;,
 &#x27;B03&#x27;,
 &#x27;B04&#x27;,
 &#x27;B05&#x27;,
 &#x27;B06&#x27;,
 &#x27;B07&#x27;,
 &#x27;B08&#x27;,
 &#x27;B8A&#x27;,
 &#x27;B09&#x27;,
 &#x27;B11&#x27;,
 &#x27;B12&#x27;,
 &#x27;SCL&#x27;,
 &#x27;SNW&#x27;,
 &#x27;CLD&#x27;,
 &#x27;viewZenithMean&#x27;,
 &#x27;viewAzimuthMean&#x27;,
 &#x27;sunZenithAngles&#x27;,
 &#x27;sunAzimuthAngles&#x27;,
 &#x27;AOT&#x27;,
 &#x27;CLM&#x27;,
 &#x27;CLP&#x27;]</span></code></div></div></div><div id="V9n5K2Y62j" class="relative group/block"><p><em><strong>Build an xcube</strong></em></p><p>In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:</p><ul><li><p><em>dataset_name</em>: the Sentinel Hub identification of the dataset. Here we will call <code>S2L2A</code> for Sentinel-2 L2A. All available datasets can be listed with <code>SH.dataset_names</code></p></li><li><p><em>band_names</em>: the band names to be used in the xcube array (see previous code cell). Here, we will call the B02, B03, B04, B08, CLM (Blue, Green, Red, NIR, Cloud Mask) bands.</p></li><li><p><em>bbox</em>: the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesn’t need to be set.</p></li><li><p><em>spatial_res</em>: the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 10 meters, we set the resolution to 0.000089 degrees.</p></li><li><p><em>time_range</em>: a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-2 L2A data is available from October 2016 onwards. In this example, we will fetch data for June 2023 - mid July 2023.</p></li><li><p><em>time_tolerance</em>: The tolerance used to identify whether a dataset should still be included within a time period. Here, <code>30m</code> corresponds to 30 minutes, thus avoiding duplicate datasets.</p></li></ul></div><div id="Kq6ZiSKRax" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Setup xcube
s2_cube_config = CubeConfig(dataset_name=&#x27;S2L2A&#x27;,
                         band_names=[&#x27;B02&#x27;, &#x27;B03&#x27;, &#x27;B04&#x27;, &#x27;B08&#x27;, &#x27;CLM&#x27;],
                         bbox=lake_bbox,
                         spatial_res=0.000089,
                         time_range=[&#x27;2023-06-01&#x27;, &#x27;2023-07-16&#x27;],
                         time_tolerance=&#x27;30m&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mIP8lhdhskdrPCpop5WWA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="idBcGThcp5" class="relative group/block"><p><em><strong>Open the xcube</strong></em></p><p>In the following cell we open the cube and display its contents. The automatically generated credentials obtained earlier in this Jupyter Notebook are specified as a parameter when opening the cube. It’s important to note that at this stage, we’re not processing anything, just generating a cube on the fly with data ready to be called when needed for analysis.</p><p>Once you open the cube, you can visualise the contents. You can view the number of timestamps and a list of them all too in the Coordinates tab. You can also visualise the seperate variables, with information on the size of the variables and their data type too.</p></div><div id="NFmpbSCf1P" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Open cube (on the fly)
s2_cube = open_cube(s2_cube_config, **sh_credentials)

# Display contents
s2_cube</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xVYl7NkmQdCPkqGAVAkbP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="HttUI35R4U" class="relative group/block"><h3 id="how-to-visualise-your-datacube" class="relative group"><span class="heading-text">How to visualise your datacube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#how-to-visualise-your-datacube" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Now we have built our cube, let’s visualise the data! We are going to visualise a True Color image and an NDWI image in the same plot. In the below cell you can see we are selecting each band for 10:00:00 16th June 2023, and selecting the nearest acquisition to this date and time. We then stack the three bands and plot this using Matplotlib. We will call the three bands in the visible spectrum. In addition we will multiply the reflectance values by 5 to brighten the image.</p><p>Another way to visualise the extent of surface water is to use the Normalised Difference Water Index (NDWI). This is an index that can be used to extract surface water using multispectral imagery such as Sentinel-2. We can calculate the index with the Green and NIR bands as stated below, and add it into the data cube as a new variable.</p><p>NDWI = Green - NIR / Green + NIR</p><p>For this we are going to create a new variable in the next cell. To create the new variable we are using two existing variables defined as s2_cube.B03 and s2_cube.B08. We then insert these variables into an index formula to create NDWI. Once ndwi has been calculated it’s attributed a long_name and units before being defined as ndwi so that we can call it as a definition later in the notebook.</p></div><div id="LV5rRFBt8w" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define NDWI in visualisation
ndwi = ((s2_cube.B03-s2_cube.B08)/(s2_cube.B03+s2_cube.B08))

ndwi.attrs[&#x27;long_name&#x27;]=&#x27;NDWI&#x27;
ndwi.attrs[&#x27;units&#x27;]=&#x27;unitless&#x27;

s2_cube[&#x27;NDWI&#x27;]= ndwi  </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Tniuo5atEBPNYopvBlicc" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fmfzZXzTZe" class="relative group/block"><p>Next we want to plot both the True Color image and the NDWI in the same plot. We will use Matplotlib to achieve this.</p></div><div id="QjNYsNwsRz" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Select the bands and stack them.
Red = s2_cube.B04.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;)
Green = s2_cube.B03.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;)
Blue = s2_cube.B02.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;)

rgb = np.dstack((Red,Green,Blue)) #Stack the three arrays

ndwi = s2_cube.NDWI.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;)

# Plot 
f = plt.figure(figsize=[10, 15])
f.add_subplot(1, 2, 1)
plt.title(f&quot;True Color: {str(s2_cube.time.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;).data).split(&#x27;T&#x27;)[0]}&quot;)
plt.imshow(5 * rgb)  # We multiply the rgb by 5 to make the image brighter
f.add_subplot(1, 2, 2)
plt.title(f&quot;NDWI: {str(s2_cube.time.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;).data).split(&#x27;T&#x27;)[0]}&quot;)
plt.imshow(ndwi, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rD0GyiCFIVXah3eNkMh6Y" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</span></code></pre></div><img src="/eodashboard-notebooks/build/d3fe936ff0d0842811956588c8000d8c.png" alt="&lt;Figure size 1000x1500 with 2 Axes&gt;"/></div></div><div id="XerNp5uEuH" class="relative group/block"><p>This looks good, and the extent of the flood waters is visualised really nicely here. The 10m resolution also enables us to see individual fields around the lake with the linear boundaries of the fields highlighted nicely in the high resolution image provided by the 10m Sentinel 2 bands.</p><p>Let’s try and visualise some more dates in the time period that we are examining;</p></div><div id="mzvKV9iNla" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Select timestamps
ndwi1 = s2_cube.NDWI.sel(time=&#x27;2023-06-17 10:00:00&#x27;, method=&#x27;nearest&#x27;)
ndwi2 = s2_cube.NDWI.sel(time=&#x27;2023-06-24 10:00:00&#x27;, method=&#x27;nearest&#x27;)
ndwi3 = s2_cube.NDWI.sel(time=&#x27;2023-06-29 10:00:00&#x27;, method=&#x27;nearest&#x27;)
ndwi4 = s2_cube.NDWI.sel(time=&#x27;2023-07-04 10:00:00&#x27;, method=&#x27;nearest&#x27;)
ndwi5 = s2_cube.NDWI.sel(time=&#x27;2023-07-07 10:00:00&#x27;, method=&#x27;nearest&#x27;)
ndwi6 = s2_cube.NDWI.sel(time=&#x27;2023-07-09 10:00:00&#x27;, method=&#x27;nearest&#x27;)


# Plot 
f = plt.figure(figsize=[15,11])
ax1 = f.add_subplot(2,3, 1)
ax2 = f.add_subplot(2,3, 2)
ax3 = f.add_subplot(2,3, 3)
ax4 = f.add_subplot(2,3, 4)
ax5 = f.add_subplot(2,3, 5)
ax6 = f.add_subplot(2,3, 6)

axlist=[ax1,ax2,ax3,ax4,ax5,ax6]

t = ndwi1.plot.imshow(ax=ax1, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)
ndwi2.plot.imshow(ax=ax2, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)
ndwi3.plot.imshow(ax=ax3, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)
ndwi4.plot.imshow(ax=ax4, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)
ndwi5.plot.imshow(ax=ax5, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)
ndwi6.plot.imshow(ax=ax6, vmin=-1, vmax=1, cmap=&#x27;GnBu&#x27;, add_colorbar=False)

cbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])
f.colorbar(t, cax=cbar_ax, label=&quot;NDWI&quot;)

#we will save the output image so we need to ensure that it is fully rendered 
plt.tight_layout() 

# Save the figure to a PNG file
plt.savefig(&#x27;NDWI.png&#x27;)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FecxGXwUK0YXu0NtUbACD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>/tmp/ipykernel_490/1879529373.py:32: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout()
</span></code></pre></div><img src="/eodashboard-notebooks/build/0dd7120e34ba2c354c60a1df441b3692.png" alt="&lt;Figure size 1500x1100 with 7 Axes&gt;"/></div></div><div id="voHp9ETWpO" class="relative group/block"><p>We could use the NDWI to estimate the surface water extent. The more images we have available, the more reliable the estimate can be. Examining the satellite images above we observe that not all of the images would be useful, as some of the lake area is covered with clouds. To overcome this limitation and have a denser time series we could rely on synthetic aperture radar observations, for example from the Copernicus Sentinel-1 platform.</p></div><div id="lABWeadrqT" class="relative group/block"><h3 id="sentinel-1-description" class="relative group"><span class="heading-text">Sentinel-1 description</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sentinel-1-description" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Like Sentinel-2, Sentinel-1 is also part of the Copernicus programme and collects data globally with a revisit time of 5 days. In contrast to Sentinel-2, Sentinel-1 SAR is an active sensor using SAR signals recording the backscatter. Due to the wavelengths used, SAR is not hindered by clouds and can be operated day and night.</p></div><div id="g7p5dcwq4t" class="relative group/block"><h3 id="check-sentinel-1-grd-available-bands" class="relative group"><span class="heading-text">Check Sentinel-1 GRD available bands</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#check-sentinel-1-grd-available-bands" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset.</p></div><div id="M1RVYkhAKB" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># List bands for S1-GRD
SH.band_names(&#x27;S1GRD&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="dp7f8L4t3i53gvStukI7E" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div class="font-mono text-sm whitespace-pre-wrap"><code><span>[&#x27;VV&#x27;, &#x27;HH&#x27;, &#x27;VH&#x27;, &#x27;localIncidenceAngle&#x27;, &#x27;scatteringArea&#x27;, &#x27;shadowMask&#x27;, &#x27;HV&#x27;]</span></code></div></div></div><div id="cqzczuxXEH" class="relative group/block"><h3 id="build-an-xcube" class="relative group"><span class="heading-text">Build an xcube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#build-an-xcube" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:</p><ul><li><p><em>dataset_name</em>: the Sentinel Hub identification of the dataset. Here we will call <code>S1GRD</code> for Sentinel-1 GRD. All available datasets can be listed with <code>SH.dataset_names</code></p></li><li><p><em>band_names</em>: the band names to be used in the xcube array (see previous code cell). Here, we will call just the VV polarisation band.</p></li><li><p><em>bbox</em>: the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesn’t need to be set.</p></li><li><p><em>spatial_res</em>: the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 10 meters, we set the resolution to 0.000089 degrees.</p></li><li><p><em>time_range</em>: a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-1 GRD data is available from February 2015 onwards. In this example, we will fetch data for June 2023 - mid July 2023.</p></li><li><p><em>time_tolerance</em>: The tolerance used to identify whether a dataset should still be included within a time period. Here, <code>30m</code> corresponds to 30 minutes, thus avoiding duplicate datasets.</p></li></ul></div><div id="knorIujghL" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Setup xcube
s1_cube_config = CubeConfig(dataset_name=&#x27;S1GRD&#x27;,
                         band_names=[&#x27;VV&#x27;],
                         bbox=lake_bbox,
                         spatial_res=0.000089,
                         time_range=[&#x27;2023-06-01&#x27;, &#x27;2023-07-16&#x27;],
                         time_tolerance=&#x27;30m&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="rKzceP70uwxjioNh_gQiL" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="jAj5NcnW2n" class="relative group/block"><h3 id="open-the-xcube" class="relative group"><span class="heading-text">Open the xcube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#open-the-xcube" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>In the following cell we open the cube and display its contents. The automatically generated credentials obtained earlier in this Jupyter Notebook are specified as a parameter when opening the cube.</p></div><div id="C2S4oHBgYp" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Open cube (on the fly)
s1_cube = open_cube(s1_cube_config, **sh_credentials)

# Display contents
s1_cube</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="n_Ap9g81gZ0dJAHgVhxEi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="WmGD9hu9wv" class="relative group/block"><h3 id="visualising-the-water-areas-using-sar" class="relative group"><span class="heading-text">Visualising the water areas using SAR</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualising-the-water-areas-using-sar" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We are going to use the VV band to visualise the flooding. From our earlier visualisation, we know that the area had some cloud coverage around the date 2023-07-04. We will search for Sentinel-1 acquisitions around that date in order to obtain a denser time series.</p><p>Radar data has very large dynamic range a very imbalanced histogram (&gt;95% of all values are smaller than 1, but the remaining 5 % can be impractically large). Thus, to obtain a visualisation with a better contrast in which the water bodies would be darker and the land pixels would be brighter, it is recommended to convert the data to log-scale.
To convert the pixel values from Digital Number to decibels we can mutiply the log10 of each DN pixel by 10. Secondly, as there will be pixels with a value of -inf after this operation, we need to account for this with the second function which will automatically assign 0 to these pixels.</p></div><div id="RO5zqIJmC0" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Convert VV Digital numbers to Decibels
vv_dn = s1_cube.VV
vv_db = 10 * (np.log10(vv_dn))

vv_db = vv_db.where(np.isfinite(vv_db), 0)

vv_db.attrs[&#x27;long_name&#x27;]=&#x27;VV_dB&#x27;
vv_db.attrs[&#x27;units&#x27;]=&#x27;decibels&#x27;

s1_cube[&#x27;VV_dB&#x27;]= vv_db</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VxFRWCuTOLx1f8Nqqiyg4" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OvllK2TJGN" class="relative group/block"><p>Like previously, we are going to visualise the <code>VV_dB</code> variable we have just generated for our AOI.</p></div><div id="vlWdRMAlRj" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># select and define the timestamp you want to visualise 
VV_dB_timestamp = s1_cube.VV_dB.sel(time=&#x27;2023-07-09 10:00:00&#x27;, method=&#x27;nearest&#x27;)

# plot the timestamp
VV_dB_timestamp.plot.imshow(vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, figsize=(10, 10))

# save and display the plot
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uARM8_BCLmnOyA5D_gzm8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10
  return func(*(_execute_task(a, cache) for a in args))
</span></code></pre></div><img src="/eodashboard-notebooks/build/f4cdc99be519c6d889f687b1af7ad347.png" alt="&lt;Figure size 1000x1000 with 2 Axes&gt;"/></div></div><div id="et5OMgXNiN" class="relative group/block"><p>This looks very similar to the NDWI we derived earlier showing the water extent fairly clearly (the blue areas). Let’s visualise it over several timestamps to confirm that this is a good variable to use to generate a lake mask.</p></div><div id="CuNdQD5yxl" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">#### Timestamp selection
vv1 = s1_cube.VV_dB.sel(time=&#x27;2023-06-03 10:00:00&#x27;, method=&#x27;nearest&#x27;)
vv2 = s1_cube.VV_dB.sel(time=&#x27;2023-06-04 10:00:00&#x27;, method=&#x27;nearest&#x27;)
vv3 = s1_cube.VV_dB.sel(time=&#x27;2023-06-15 10:00:00&#x27;, method=&#x27;nearest&#x27;)
vv4 = s1_cube.VV_dB.sel(time=&#x27;2023-06-27 10:00:00&#x27;, method=&#x27;nearest&#x27;)
vv5 = s1_cube.VV_dB.sel(time=&#x27;2023-07-09 10:00:00&#x27;, method=&#x27;nearest&#x27;)
vv6 = s1_cube.VV_dB.sel(time=&#x27;2023-07-10 10:00:00&#x27;, method=&#x27;nearest&#x27;)

# Plot 
f = plt.figure(figsize=[16,11])
ax1 = f.add_subplot(2,3, 1)
ax2 = f.add_subplot(2,3, 2)
ax3 = f.add_subplot(2,3, 3)
ax4 = f.add_subplot(2,3, 4)
ax5 = f.add_subplot(2,3, 5)
ax6 = f.add_subplot(2,3, 6)

axlist=[ax1,ax2,ax3,ax4,ax5,ax6]

t = vv1.plot.imshow(ax=ax1, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)
vv2.plot.imshow(ax=ax2, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)
vv3.plot.imshow(ax=ax3, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)
vv4.plot.imshow(ax=ax4, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)
vv5.plot.imshow(ax=ax5, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)
vv6.plot.imshow(ax=ax6, vmin=-40, vmax=0, cmap=&#x27;winter&#x27;, add_colorbar=False)

cbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])
f.colorbar(t, cax=cbar_ax, label=&quot;VV dB&quot;)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="EGkrALTDMfmQksjNHe0RW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/eodashboard-notebooks/build/62875b2a4a6b3f4ca44b6bc5ce31a391.png" alt="&lt;Figure size 1600x1100 with 7 Axes&gt;"/></div></div><div id="EFhuqZljv8" class="relative group/block"><p>Depending on the local conditions (e.g. terrain orientation, slope) and weather conditions, optical or radar imagery may be more useful. In this case both types of observations seem to provide a good view of the water surface area extent.</p><p>Next we will generate a flood mask using a threshold.</p><ul><li>for SAR images, generally, as a good rule of thumb, in the VV band, values below -20 dB are usually surface water. We will try this value first, but we will also look to visualise how the flood mask changes if we adjust the threshold value.</li><li>observing the NDWI range of values, we can chose values above 0.25 to correspond to the water class.</li></ul><p>First, let’s generate the new variable using the <code>.where</code> function in xarray.</p><p>At first glance, the below cell may not make much sense. It may read that the step 1 function as assigning a value of 1 to pixels in VV_dB that are equal or more than -20. However, what is actually happening is that the <code>.where</code> function preserves all the pixel values in the variable that are below -20 and assigns everything else a value of 1. More can be found in the xarray documentation <a target="_blank" rel="noreferrer" href="http://xarray.pydata.org/en/stable/generated/xarray.DataArray.where.html" class="">http://<wbr/>xarray<wbr/>.pydata<wbr/>.org<wbr/>/en<wbr/>/stable<wbr/>/generated<wbr/>/xarray<wbr/>.DataArray<wbr/>.where<wbr/>.html</a></p></div><div id="HdG0cUVAgs" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># mask the Sentinel-1 data

# Assign all pixels equal or smaller than -20 a value of 1 and preserve the values of all other pixels 
step1 = s1_cube.VV_dB.where(s1_cube.VV_dB &gt; -20, 1)

# Assign all other pixels a value of 0. 
water = step1.where(step1 == 1, 0)

water.attrs[&#x27;long_name&#x27;] =&#x27;water&#x27;
water.attrs[&#x27;units&#x27;] =&#x27;nounits&#x27;

s1_cube[&#x27;water&#x27;] = water</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Pds9_QSIvQX1L1U5CGjJu" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iKNaDJxv0C" class="relative group/block"><p>Next let’s see what happens to the mask extent if we change the threshold to -15 dB and -25dB:</p></div><div id="Mamf7PvKGR" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Sentinel-1
water_threshold1_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB &gt; -15, 1)
water_threshold2_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB &gt; -20, 1)
water_threshold3_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB &gt; -25, 1)

water_threshold1_step2 = water_threshold1_step1.where(water_threshold1_step1 == 1, 0)
water_threshold2_step2 = water_threshold2_step1.where(water_threshold2_step1 == 1, 0)
water_threshold3_step2 = water_threshold3_step1.where(water_threshold3_step1 == 1, 0)

water_threshold1 = water_threshold1_step2.sel(time=&#x27;2023-06-15 10:00:00&#x27;, method=&#x27;nearest&#x27;)
water_threshold2 = water_threshold2_step2.sel(time=&#x27;2023-06-15 10:00:00&#x27;, method=&#x27;nearest&#x27;)
water_threshold3 = water_threshold3_step2.sel(time=&#x27;2023-06-15 10:00:00&#x27;, method=&#x27;nearest&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="brf0nWoo1dmZRfL7cbQ6C" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="AT2WtvHKB7" class="relative group/block"><p>Next we will plot the new thresholds we want to test:</p></div><div id="fxIABUe4Aa" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot 
f = plt.figure(figsize=[20,12])
ax1 = f.add_subplot(2,3, 1)
ax2 = f.add_subplot(2,3, 2)
ax3 = f.add_subplot(2,3, 3)

water_threshold1.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)
water_threshold2.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)
water_threshold3.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="xyCwf3TQp-hYzHJdbci1e" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10
  return func(*(_execute_task(a, cache) for a in args))
</span></code></pre></div><img src="/eodashboard-notebooks/build/eab410d2bfcf4a0487be86e4bb7d64d8.png" alt="&lt;Figure size 2000x1200 with 3 Axes&gt;"/></div></div><div id="ErjUFrPn8v" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># mask the Sentinel-2 data

# Assign all pixels equal or larger than 0.25 a value of 1 and preserve the values of pixels 
step11 = ndwi1.where(ndwi1 &lt; 0.25, 1)

# Assign all other pixels a value of 0. 
water1 = step1.where(step1 == 1, 0)

water1.attrs[&#x27;long_name&#x27;] =&#x27;water&#x27;
water1.attrs[&#x27;units&#x27;] =&#x27;nounits&#x27;

s2_cube[&#x27;water&#x27;] = water1</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="bDU0L4ksyozOAAYwagrnP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="YqKi9BNZjH" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Sentinel-2
water_threshold1_step11 = ndwi1.where(ndwi1 &lt; 0.15, 1)
water_threshold2_step11 = ndwi1.where(ndwi1 &lt; 0.25, 1)
water_threshold3_step11 = ndwi1.where(ndwi1 &lt; 0.30, 1)

water_threshold1_step21 = water_threshold1_step11.where(water_threshold1_step11 == 1, 0)
water_threshold2_step21 = water_threshold2_step11.where(water_threshold2_step11 == 1, 0)
water_threshold3_step21 = water_threshold3_step11.where(water_threshold3_step11 == 1, 0)

water_threshold11 = water_threshold1_step21
water_threshold21 = water_threshold2_step21
water_threshold31 = water_threshold3_step21</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gtncCKmphka0uB1dO7VQQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="emYTfCF7Bz" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot 
f = plt.figure(figsize=[20,12])
ax1 = f.add_subplot(2,3, 1)
ax2 = f.add_subplot(2,3, 2)
ax3 = f.add_subplot(2,3, 3)

water_threshold11.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)
water_threshold21.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)
water_threshold31.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap=&#x27;Blues&#x27;, add_colorbar=False)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="7IL80duQd8vdf3gI6N4Zg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/eodashboard-notebooks/build/b1e1cbcb33de4a107bd3fe9027ef03c9.png" alt="&lt;Figure size 2000x1200 with 3 Axes&gt;"/></div></div><div id="mXQQjfnCCG" class="relative group/block"><p>Observe the differences in the water mask due to the threshold.</p></div><div id="JYekDOugk3" class="relative group/block"><h3 id="estimating-the-surface-water-area-extent" class="relative group"><span class="heading-text">Estimating the surface water area extent</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#estimating-the-surface-water-area-extent" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Let’s estimate the area covered by water during the time period we are examining.</p><p>We can also estimate which is the area that is most covered by water by dividing the sum of the water pixels by the number of timesteps in the data cube (the count).</p></div><div id="qEWKuTXHQj" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># previously we only kept 1 time step when we selected ndwi1
# now we want to keep the full datacube in order to average in time

# Assign all pixels equal or larger than 0.25 a value of 1 and preserve the values of all other pixels 
step1 = s2_cube.NDWI.where(s2_cube.NDWI &lt; 0.25, 1)

# Assign all other pixels a value of 0. 
water = step1.where(step1 == 1, 0)

water.attrs[&#x27;long_name&#x27;] =&#x27;water&#x27;
water.attrs[&#x27;units&#x27;] =&#x27;nounits&#x27;

s2_cube[&#x27;water&#x27;] = water


water_sum = s2_cube.NDWI.sum(dim=&quot;time&quot;)
water_count = s2_cube.NDWI.count(dim=&quot;time&quot;)
water_average = water_sum / water_count


water_average.attrs[&#x27;long_name&#x27;]=&#x27;water area&#x27;
water_average.attrs[&#x27;units&#x27;]=&#x27;nounits&#x27;

ndwi[&#x27;water_average&#x27;]= water_average</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iI2PmvcWtrly0HIfT36ek" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="HwP2c4J2wJ" class="relative group/block"><p>Now let’s plot the water_average into a plot:</p></div><div id="qX227ib1DD" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">water_average.plot.imshow(cmap=&#x27;GnBu&#x27;, vmin=0, vmax=0.5, figsize=(10, 10))

plt.tight_layout()

#expport to png
plt.savefig(&#x27;figure.png&#x27;)

plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="RLQfIA0AG25WJmY46oDRd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/eodashboard-notebooks/build/db96fdbcbad016dc19d903cecc1b3010.png" alt="&lt;Figure size 1000x1000 with 2 Axes&gt;"/></div></div><div id="q10MhbhST5" class="relative group/block"><p>This looks great, we have identified the lake area very clearly here and can also observe how the lake may change in size over time.</p></div><div id="CIsQhAmpIu" class="relative group/block"><h2 id="access-environmental-variables-and-other-datasets" class="relative group"><span class="heading-text">Access environmental variables and other datasets</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#access-environmental-variables-and-other-datasets" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This <a target="_blank" rel="noreferrer" href="https://nbviewer.hub.eox.at/notebooks/eurodatacube/notebooks/curated/EDC_xcube_generator_service.ipynb" class="">Notebook</a> demonstrates how to:</p><p>request data from selected Copernicus Services,
request data from Copernicus Climate Data Store,
request data from ESA Climate Change Initiative.</p></div><div></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/eodashboard-notebooks/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-TMJFFFM7.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/root-LMCDRB6W.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/_shared/chunk-GOFUXLLW.js"/><link rel="modulepreload" href="/eodashboard-notebooks/build/routes/$-SJYMRUNJ.js"/><script>window.__remixContext = {"url":"/notebooks/inland-water-with-edc","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true,"style":"/eodashboard-notebooks/build/custom-ff973bd80df331a09b5db47ef8d41b4f.css"},"nav":[],"actions":[],"projects":[{"subject":"Notebook examples","title":"EO Dashboard Notebooks","description":"Collection of examples relevant to the EO Dashboard project","github":"https://github.com/ESA-eodashboards/eodashboard-notebooks","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"slug":"notebooks.fire-impact-analysis","title":"Evaluation of Fire Impact on Populated Areas on a European Site","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/22a5ee1ff975cb9c3eb3b1e899bb858e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.inland-water-with-edc","title":"Exploring Inland Water Bodies with Sentinel-2 data in EDC","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.openchallengenotebook-c1-jessel-hezzi-roussel","title":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/49e045ccedfe842015ba44cc25ccb377.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.veda-api-bids-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/5d71b8fb32fb3d611031d0ea697e5422.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Nightlights Notebook","level":2},{"slug":"notebooks.nightlights-notebook.night-lights-blending","title":"Monitoring socio-economic activities with nighttime light maps","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/nighttime_northeaste-aa3818443fbc1f19a6259ceb482d2f4b.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/eodashboard-notebooks"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true,"style":"/eodashboard-notebooks/build/custom-ff973bd80df331a09b5db47ef8d41b4f.css"},"nav":[],"actions":[],"projects":[{"subject":"Notebook examples","title":"EO Dashboard Notebooks","description":"Collection of examples relevant to the EO Dashboard project","github":"https://github.com/ESA-eodashboards/eodashboard-notebooks","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"slug":"notebooks.fire-impact-analysis","title":"Evaluation of Fire Impact on Populated Areas on a European Site","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/22a5ee1ff975cb9c3eb3b1e899bb858e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.inland-water-with-edc","title":"Exploring Inland Water Bodies with Sentinel-2 data in EDC","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.openchallengenotebook-c1-jessel-hezzi-roussel","title":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/49e045ccedfe842015ba44cc25ccb377.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.veda-api-bids-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/5d71b8fb32fb3d611031d0ea697e5422.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Nightlights Notebook","level":2},{"slug":"notebooks.nightlights-notebook.night-lights-blending","title":"Monitoring socio-economic activities with nighttime light maps","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/nighttime_northeaste-aa3818443fbc1f19a6259ceb482d2f4b.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}]},"page":{"version":1,"kind":"Notebook","sha256":"56c9dd01f11a5e7aedfe0d757745db36e025944eac99a127a978088d805f1206","slug":"notebooks.inland-water-with-edc","location":"/notebooks/Inland_water_with_EDC.ipynb","dependencies":[],"frontmatter":{"title":"Exploring Inland Water Bodies with Sentinel-2 data in EDC","content_includes_title":false,"kernelspec":{"name":"conda-env-users-edc-2023.03-02-py","display_name":"users-edc-2023.03-02","language":"python"},"github":"https://github.com/ESA-eodashboards/eodashboard-notebooks","subject":"Notebook examples","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/ESA-eodashboards/eodashboard-notebooks/blob/main/notebooks/Inland_water_with_EDC.ipynb","exports":[{"format":"ipynb","filename":"Inland_water_with_EDC.ipynb","url":"/eodashboard-notebooks/build/Inland_water_with_ED-f6f3128aeead33dc8a30914d09367ee4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.152147,"end_time":"2023-03-22T13:56:08.394372","exception":false,"start_time":"2023-03-22T13:56:08.242225","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-2023.03-02\", dependencies=[\"SH\"])","visibility":"show","key":"eceCyUoJK6"},{"type":"output","id":"NtZ1aKXpBzkY4jqPV-7LA","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cscript type=\"text/javascript\"\u003e\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    \u003c/script\u003e","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-2023.03-02).","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"\u003cIPython.core.display.Markdown object\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"njswqG7F5n"}],"visibility":"show","key":"vzFFAsujsK"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.015196,"end_time":"2023-03-22T13:56:08.425156","exception":false,"start_time":"2023-03-22T13:56:08.409960","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xjPRYw95T8"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"author: Anca Anghelea, based on a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LTOcsjBij5"},{"type":"link","url":"https://eurodatacube.com/notebooks/curated/Exploring_time_and_space_with_EDC.ipynb","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"notebook by: ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"xWiKINUtQn"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"William Ray","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZXjBnZXVOc"}],"key":"I3ABZaCCNY"}],"urlSource":"https://eurodatacube.com/notebooks/curated/Exploring_time_and_space_with_EDC.ipynb","key":"Z13Xof6mCr"}],"key":"EFE4nOHEZI"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Several lakes and other inland water bodies are featured on EO Dashboard. The datasets supporting the various geo-stories are accessible by means similar to what you will learn in this notebook.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"L2Dccn2Wfo"}],"key":"CAHGR7aT5U"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"link","url":"https://eodashboard.org/oceans","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Explore EO Dashboard Stories on Oceans and Inland Water","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"B33NfiOYPC"}],"urlSource":"https://eodashboard.org/oceans","key":"UA87un6Vh6"},{"type":"text","value":".","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"IpuUs77Q80"}],"key":"DFt0g6M15Z"},{"type":"heading","depth":2,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"In this notebook","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"TlAWyeJCRJ"}],"identifier":"in-this-notebook","label":"In this notebook","html_id":"in-this-notebook","implicit":true,"key":"KJN0Td7zAg"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"In this demonstration Jupyter Notebook, we will be visualising and analysing inland water bodies using Sentinel data, demonstrating the use of EDC.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"xD7eoWlNlR"}],"key":"NT79hdMkri"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"We are going to use the EDC and its associated libaries and APIs to do this. In this notebook we will learn how to:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"yQO9vyyPQf"}],"key":"VPAv803kea"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Build a cube","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"IACwglauUX"}],"key":"IfpLIOjkWe"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Visualise a variable in your data cube","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"CarZ4A5zby"}],"key":"dzbt2fBMPt"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Create a new variable","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"dRCPSW0IXF"}],"key":"dX3QBheXan"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Create a new variable using a threshold","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"vqDBWVBgMM"}],"key":"VgkwR8j7I8"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Visualise a spatial subset of a variable over time","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"RPGMTJWvAK"}],"key":"o9eXr7jrTs"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Create a new variable based upon space and time.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"JNqtnexO5V"}],"key":"ZU80oCTzyE"}],"key":"T6qbWsPH0o"}],"visibility":"show","key":"nPYCpJU7iH"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.014038,"end_time":"2023-03-22T13:56:08.453124","exception":false,"start_time":"2023-03-22T13:56:08.439086","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Configuration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lqc1pw8tZJ"}],"identifier":"configuration","label":"Configuration","html_id":"configuration","implicit":true,"key":"cJHhscUuZQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before acccessing the data, we will start by importing the necessary Python libraries (already configured in your EDC workspace), and generate credentials automatically to access the services.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zdZaXFkq7a"}],"key":"LNrRGn8jBI"}],"visibility":"show","key":"f5fwLqibBe"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":3.986682,"end_time":"2023-03-22T13:56:12.453656","exception":false,"start_time":"2023-03-22T13:56:08.466974","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# EDC libraries\nfrom edc import setup_environment_variables\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.sentinelhub import SentinelHub\nfrom xcube.core.gen2.local.combiner import CubesCombiner\nfrom xcube.core.geom import mask_dataset_by_geometry\n\n# Sentinel Hub\nfrom sentinelhub import BBox, SentinelHubRequest, bbox_to_dimensions, DataCollection, MimeType, SHConfig, geometry\n\n# Utilities\nimport IPython.display\nfrom os import environ\nimport matplotlib.pyplot as plt\nimport datetime as dt\nimport geopandas\nimport rioxarray\n\n# Numerical computation\nimport xarray as xr\nimport numpy as np\n\n# Fetch credentials as environement variables\nsetup_environment_variables()\n\n# Pass Sentinel Hub credentials to dictionnary\nsh_credentials = dict(client_id=environ[\"SH_CLIENT_ID\"],\n                      client_secret=environ[\"SH_CLIENT_SECRET\"])","visibility":"show","key":"ir3QWvLZVF"},{"type":"output","id":"xTxqfQhdoFHQnA6FQ9vz7","data":[{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"API credentials have automatically been injected for your active subscriptions.  \nThe following environment variables are now available:\n\n","content_type":"text/markdown"},"text/plain":{"content":"\u003cIPython.core.display.Markdown object\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"FjOdHt2VOS"}],"visibility":"show","key":"bNGLjVC4ZT"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.029571,"end_time":"2023-03-22T13:56:12.507641","exception":false,"start_time":"2023-03-22T13:56:12.478070","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define an AOI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sBbCPMuHwb"}],"key":"KZubfZTx5m"}],"key":"AW1RYR0VKW"}],"key":"xsTuzpttxm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Next, we will define our area of interest using a bounding box. This must be provided in WGS84 coordinates to build the cube.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gdrMDVaJL3"}],"key":"BTOOYzLXH0"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We have chosen an AOI covering the natural park “Valli di Comacchio” in Italy.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"i6uEujzf52"}],"key":"FCTWyrfgCH"}],"visibility":"show","key":"dvm9yqmkyJ"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.045846,"end_time":"2023-03-22T13:56:12.575410","exception":false,"start_time":"2023-03-22T13:56:12.529564","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the coordinates of the bounding box\nlake_bbox = [12.09, 44.54, 12.27, 44.70]\n\n# Bbox EPSG\nbbox_epsg = 4326\n","visibility":"show","key":"vMhDdXL2qh"},{"type":"output","id":"qExHVhYS61U12FCfwURAS","data":[],"visibility":"show","key":"iUuG8Qg3rd"}],"visibility":"show","key":"Pwlmrqk9UV"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.066308,"end_time":"2023-03-22T13:56:12.679415","exception":false,"start_time":"2023-03-22T13:56:12.613107","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the bounding box on a map\nIPython.display.GeoJSON(BBox(lake_bbox,crs=bbox_epsg).get_geojson())","visibility":"show","key":"YJGdYbw9Tg"},{"type":"output","id":"S-fo5k2MxHSubzXmD3fai","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[12.09,44.54],[12.09,44.7],[12.27,44.7],[12.27,44.54],[12.09,44.54]]],\"crs\":{\"properties\":{\"name\":\"urn:ogc:def:crs:EPSG::4326\"},\"type\":\"name\"},\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"\u003cIPython.display.GeoJSON object\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"mKgXlx2wOn"}],"visibility":"show","key":"iEanO96q2u"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.017479,"end_time":"2023-03-22T13:56:12.720964","exception":false,"start_time":"2023-03-22T13:56:12.703485","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How to build a data cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vhbu2IgAB1"}],"identifier":"how-to-build-a-data-cube","label":"How to build a data cube","html_id":"how-to-build-a-data-cube","implicit":true,"key":"sFYdmrUSys"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Firstly, we will go through how to build a data cube.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"A0WVheG2mF"}],"key":"OrKGL1FcPp"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We are going to visualise the floods using Sentinel-2 imagery. Sentinel-2 is part of the Copernicus programme and collects multispectral data globally with a revisit time of 5 days. The satellite’s multispectral imager provides collects data in 13 spectral bands spanning from the visible and near infrared to the shortwave infrared. The visible and near infrared data we will use in this example is collected at 10m resolution.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KXguLy9GBo"}],"key":"RIWsoKPnxz"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Check Sentinel-2 L2A available bands","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mGwR28cyWM"}],"key":"YwOgUar7Df"}],"key":"RqPHAC8JYI"}],"key":"V1KsjSatGH"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset to help us build the cube!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"uszB5a3Lu1"}],"key":"Jnc4sCHBc7"}],"visibility":"show","key":"YjGaZ6txiv"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.185602,"end_time":"2023-03-22T13:56:12.938730","exception":false,"start_time":"2023-03-22T13:56:12.753128","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create a Sentinel Hub class, using our Sentinel Hub credentials\nSH = SentinelHub(**sh_credentials)\n\n# List bands for S2-L2A\nSH.band_names('S2L2A')","visibility":"show","key":"Vpt1t5Uc7N"},{"type":"output","id":"Rherdcr2TNiKsRkthNPff","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['B01',\n 'B02',\n 'B03',\n 'B04',\n 'B05',\n 'B06',\n 'B07',\n 'B08',\n 'B8A',\n 'B09',\n 'B11',\n 'B12',\n 'SCL',\n 'SNW',\n 'CLD',\n 'viewZenithMean',\n 'viewAzimuthMean',\n 'sunZenithAngles',\n 'sunAzimuthAngles',\n 'AOT',\n 'CLM',\n 'CLP']","content_type":"text/plain"}}}],"visibility":"show","key":"kbH0tPrW2z"}],"visibility":"show","key":"gtA3A1JYaF"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.014551,"end_time":"2023-03-22T13:56:12.970059","exception":false,"start_time":"2023-03-22T13:56:12.955508","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build an xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AJBp91Ko0W"}],"key":"Lfuq4PHWF2"}],"key":"uDXE3JMKdx"}],"key":"o3JDUWq0ex"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zHTM5BZsSk"}],"key":"aLOobPEkYS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"dataset_name","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zDusvr3Lnu"}],"key":"wK31e1XIEx"},{"type":"text","value":": the Sentinel Hub identification of the dataset. Here we will call ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"x83NM3uGoL"},{"type":"inlineCode","value":"S2L2A","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UxedZjN4QV"},{"type":"text","value":" for Sentinel-2 L2A. All available datasets can be listed with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zOMnXOfg3q"},{"type":"inlineCode","value":"SH.dataset_names","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rfG2SP6aAG"}],"key":"s3XAAA9hwo"}],"key":"IotaRYoved"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"band_names","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FVz2VGrvUi"}],"key":"ZB7C8LbNuQ"},{"type":"text","value":": the band names to be used in the xcube array (see previous code cell). Here, we will call the B02, B03, B04, B08, CLM (Blue, Green, Red, NIR, Cloud Mask) bands.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KKMobfNOFO"}],"key":"vjXNNxZQp1"}],"key":"V7pnGzqUpw"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"bbox","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PMuE6wOVxw"}],"key":"I3nC1HBrxm"},{"type":"text","value":": the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesn’t need to be set.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"q2yNY8iVtq"}],"key":"RIxxLUiNBh"}],"key":"nDvmvOEEwE"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"spatial_res","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Odh69SQlTG"}],"key":"yYz3BSX9c9"},{"type":"text","value":": the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 10 meters, we set the resolution to 0.000089 degrees.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ZWiyNP2qLa"}],"key":"akfBhUO8wh"}],"key":"xQgIGoa5sP"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"time_range","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"pEY4zE1TE4"}],"key":"X90RKy2a0A"},{"type":"text","value":": a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-2 L2A data is available from October 2016 onwards. In this example, we will fetch data for June 2023 - mid July 2023.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"efzjQgbQc5"}],"key":"xgaPnludLr"}],"key":"rWjVs9MUss"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"time_tolerance","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fbvdSb3TJA"}],"key":"DQ8XYwm2ZB"},{"type":"text","value":": The tolerance used to identify whether a dataset should still be included within a time period. Here, ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vv2Fihaqle"},{"type":"inlineCode","value":"30m","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"GdJFlgbQxR"},{"type":"text","value":" corresponds to 30 minutes, thus avoiding duplicate datasets.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ZaFHbNdec3"}],"key":"f5Veb9y11y"}],"key":"RyqnB9GYr1"}],"key":"iPiWn8wGO2"}],"visibility":"show","key":"V9n5K2Y62j"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.05642,"end_time":"2023-03-22T13:56:13.043290","exception":false,"start_time":"2023-03-22T13:56:12.986870","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Setup xcube\ns2_cube_config = CubeConfig(dataset_name='S2L2A',\n                         band_names=['B02', 'B03', 'B04', 'B08', 'CLM'],\n                         bbox=lake_bbox,\n                         spatial_res=0.000089,\n                         time_range=['2023-06-01', '2023-07-16'],\n                         time_tolerance='30m')","visibility":"show","key":"LWzlqwt2K4"},{"type":"output","id":"mIP8lhdhskdrPCpop5WWA","data":[],"visibility":"show","key":"meKLnblGLs"}],"visibility":"show","key":"Kq6ZiSKRax"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.019507,"end_time":"2023-03-22T13:56:13.085157","exception":false,"start_time":"2023-03-22T13:56:13.065650","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"strong","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open the xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LrLKTeLeb2"}],"key":"ipF47XCFzQ"}],"key":"PPn9fITeVv"}],"key":"bkXV6bMQxc"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we open the cube and display its contents. The automatically generated credentials obtained earlier in this Jupyter Notebook are specified as a parameter when opening the cube. It’s important to note that at this stage, we’re not processing anything, just generating a cube on the fly with data ready to be called when needed for analysis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vrrQEapjtJ"}],"key":"cYWRW9lrdr"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Once you open the cube, you can visualise the contents. You can view the number of timestamps and a list of them all too in the Coordinates tab. You can also visualise the seperate variables, with information on the size of the variables and their data type too.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uSvewWdSMX"}],"key":"m9JDyefrOo"}],"visibility":"show","key":"idBcGThcp5"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.342001,"end_time":"2023-03-22T13:56:13.447544","exception":false,"start_time":"2023-03-22T13:56:13.105543","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open cube (on the fly)\ns2_cube = open_cube(s2_cube_config, **sh_credentials)\n\n# Display contents\ns2_cube","visibility":"show","key":"RY1DEZwHZ1"},{"type":"output","id":"xVYl7NkmQdCPkqGAVAkbP","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/xcube_sh/sentinelhub.py:243: UserWarning: The argument 'infer_datetime_format' is deprecated and will be removed in a future version. A strict version of it is now the default, see https://pandas.pydata.org/pdeps/0004-consistent-to-datetime-parsing.html. You can safely remove this argument.\n  dt = pd.to_datetime(dt,\n/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/xcube_sh/sentinelhub.py:243: UserWarning: The argument 'infer_datetime_format' is deprecated and will be removed in a future version. A strict version of it is now the default, see https://pandas.pydata.org/pdeps/0004-consistent-to-datetime-parsing.html. You can safely remove this argument.\n  dt = pd.to_datetime(dt,\n"},{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"12b8bd2fae3a1febcf57a9731234b9ff","path":"/eodashboard-notebooks/build/12b8bd2fae3a1febcf57a9731234b9ff.html"},"text/plain":{"content":"\u003cxarray.Dataset\u003e\nDimensions:    (time: 18, lat: 1886, lon: 2122, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 44.71 44.71 44.71 44.71 ... 44.54 44.54 44.54 44.54\n  * lon        (lon) float64 12.09 12.09 12.09 12.09 ... 12.28 12.28 12.28 12.28\n  * time       (time) datetime64[ns] 2023-06-02T10:18:28 ... 2023-07-14T10:08:32\n    time_bnds  (time, bnds) datetime64[ns] dask.array\u003cchunksize=(18, 2), meta=np.ndarray\u003e\nDimensions without coordinates: bnds\nData variables:\n    B02        (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\n    B03        (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\n    B04        (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\n    B08        (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\n    CLM        (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S2L2A Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-07-16T01:24:44.851881\n    time_coverage_start:     2023-06-02T10:18:28+00:00\n    time_coverage_end:       2023-07-14T10:08:32+00:00\n    time_coverage_duration:  P41DT23H50M4S\n    geospatial_lon_min:      12.09\n    geospatial_lat_min:      44.54\n    geospatial_lon_max:      12.278858\n    geospatial_lat_max:      44.707854\n    processing_level:        L2A","content_type":"text/plain"}}}],"visibility":"show","key":"AP6cnc3Z64"}],"visibility":"show","key":"NFmpbSCf1P"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.022112,"end_time":"2023-03-22T13:56:13.490032","exception":false,"start_time":"2023-03-22T13:56:13.467920","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How to visualise your datacube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CGVSQJU1zv"}],"identifier":"how-to-visualise-your-datacube","label":"How to visualise your datacube","html_id":"how-to-visualise-your-datacube","implicit":true,"key":"SoIYCbkYmt"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now we have built our cube, let’s visualise the data! We are going to visualise a True Color image and an NDWI image in the same plot. In the below cell you can see we are selecting each band for 10:00:00 16th June 2023, and selecting the nearest acquisition to this date and time. We then stack the three bands and plot this using Matplotlib. We will call the three bands in the visible spectrum. In addition we will multiply the reflectance values by 5 to brighten the image.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KwYtU2MknM"}],"key":"gSpjwldWW2"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Another way to visualise the extent of surface water is to use the Normalised Difference Water Index (NDWI). This is an index that can be used to extract surface water using multispectral imagery such as Sentinel-2. We can calculate the index with the Green and NIR bands as stated below, and add it into the data cube as a new variable.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r84L0hxrb8"}],"key":"kfxcvkvVId"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NDWI = Green - NIR / Green + NIR","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"FlK6kAFR4o"}],"key":"y8OFVrwpNS"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"For this we are going to create a new variable in the next cell. To create the new variable we are using two existing variables defined as s2_cube.B03 and s2_cube.B08. We then insert these variables into an index formula to create NDWI. Once ndwi has been calculated it’s attributed a long_name and units before being defined as ndwi so that we can call it as a definition later in the notebook.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Mvd9WTejRe"}],"key":"xtggtSfF9u"}],"visibility":"show","key":"HttUI35R4U"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.084804,"end_time":"2023-03-22T13:56:13.599932","exception":false,"start_time":"2023-03-22T13:56:13.515128","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define NDWI in visualisation\nndwi = ((s2_cube.B03-s2_cube.B08)/(s2_cube.B03+s2_cube.B08))\n\nndwi.attrs['long_name']='NDWI'\nndwi.attrs['units']='unitless'\n\ns2_cube['NDWI']= ndwi  ","visibility":"show","key":"FGRyVfes5W"},{"type":"output","id":"Tniuo5atEBPNYopvBlicc","data":[],"visibility":"show","key":"Y1FDgxwhye"}],"visibility":"show","key":"LV5rRFBt8w"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.018047,"end_time":"2023-03-22T13:56:13.637906","exception":false,"start_time":"2023-03-22T13:56:13.619859","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we want to plot both the True Color image and the NDWI in the same plot. We will use Matplotlib to achieve this.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QjpModS3hV"}],"key":"qcOhp4qWsm"}],"visibility":"show","key":"fmfzZXzTZe"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":5.878177,"end_time":"2023-03-22T13:56:19.535578","exception":false,"start_time":"2023-03-22T13:56:13.657401","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select the bands and stack them.\nRed = s2_cube.B04.sel(time='2023-06-17 10:00:00', method='nearest')\nGreen = s2_cube.B03.sel(time='2023-06-17 10:00:00', method='nearest')\nBlue = s2_cube.B02.sel(time='2023-06-17 10:00:00', method='nearest')\n\nrgb = np.dstack((Red,Green,Blue)) #Stack the three arrays\n\nndwi = s2_cube.NDWI.sel(time='2023-06-17 10:00:00', method='nearest')\n\n# Plot \nf = plt.figure(figsize=[10, 15])\nf.add_subplot(1, 2, 1)\nplt.title(f\"True Color: {str(s2_cube.time.sel(time='2023-06-17 10:00:00', method='nearest').data).split('T')[0]}\")\nplt.imshow(5 * rgb)  # We multiply the rgb by 5 to make the image brighter\nf.add_subplot(1, 2, 2)\nplt.title(f\"NDWI: {str(s2_cube.time.sel(time='2023-06-17 10:00:00', method='nearest').data).split('T')[0]}\")\nplt.imshow(ndwi, vmin=-1, vmax=1, cmap='GnBu')\nplt.show()","visibility":"show","key":"XjE0hYhemw"},{"type":"output","id":"rD0GyiCFIVXah3eNkMh6Y","data":[{"name":"stderr","output_type":"stream","text":"Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d3fe936ff0d0842811956588c8000d8c","path":"/eodashboard-notebooks/build/d3fe936ff0d0842811956588c8000d8c.png"},"text/plain":{"content":"\u003cFigure size 1000x1500 with 2 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"jdAixibQRQ"}],"visibility":"show","key":"QjNYsNwsRz"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.060035,"end_time":"2023-03-22T13:56:19.643957","exception":false,"start_time":"2023-03-22T13:56:19.583922","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This looks good, and the extent of the flood waters is visualised really nicely here. The 10m resolution also enables us to see individual fields around the lake with the linear boundaries of the fields highlighted nicely in the high resolution image provided by the 10m Sentinel 2 bands.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VoEJx13qpk"}],"key":"ErAElTQ2vX"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Let’s try and visualise some more dates in the time period that we are examining;","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"edEbqRqmgk"}],"key":"XwTpBB96pr"}],"visibility":"show","key":"XerNp5uEuH"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":14.299041,"end_time":"2023-03-22T13:56:33.983607","exception":false,"start_time":"2023-03-22T13:56:19.684566","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select timestamps\nndwi1 = s2_cube.NDWI.sel(time='2023-06-17 10:00:00', method='nearest')\nndwi2 = s2_cube.NDWI.sel(time='2023-06-24 10:00:00', method='nearest')\nndwi3 = s2_cube.NDWI.sel(time='2023-06-29 10:00:00', method='nearest')\nndwi4 = s2_cube.NDWI.sel(time='2023-07-04 10:00:00', method='nearest')\nndwi5 = s2_cube.NDWI.sel(time='2023-07-07 10:00:00', method='nearest')\nndwi6 = s2_cube.NDWI.sel(time='2023-07-09 10:00:00', method='nearest')\n\n\n# Plot \nf = plt.figure(figsize=[15,11])\nax1 = f.add_subplot(2,3, 1)\nax2 = f.add_subplot(2,3, 2)\nax3 = f.add_subplot(2,3, 3)\nax4 = f.add_subplot(2,3, 4)\nax5 = f.add_subplot(2,3, 5)\nax6 = f.add_subplot(2,3, 6)\n\naxlist=[ax1,ax2,ax3,ax4,ax5,ax6]\n\nt = ndwi1.plot.imshow(ax=ax1, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi2.plot.imshow(ax=ax2, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi3.plot.imshow(ax=ax3, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi4.plot.imshow(ax=ax4, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi5.plot.imshow(ax=ax5, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi6.plot.imshow(ax=ax6, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\n\ncbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])\nf.colorbar(t, cax=cbar_ax, label=\"NDWI\")\n\n#we will save the output image so we need to ensure that it is fully rendered \nplt.tight_layout() \n\n# Save the figure to a PNG file\nplt.savefig('NDWI.png')\n\nplt.show()","visibility":"show","key":"rQOjqGsCX4"},{"type":"output","id":"FecxGXwUK0YXu0NtUbACD","data":[{"name":"stderr","output_type":"stream","text":"/tmp/ipykernel_490/1879529373.py:32: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.\n  plt.tight_layout()\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0dd7120e34ba2c354c60a1df441b3692","path":"/eodashboard-notebooks/build/0dd7120e34ba2c354c60a1df441b3692.png"},"text/plain":{"content":"\u003cFigure size 1500x1100 with 7 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"ubEE3kYRI9"}],"visibility":"show","key":"mzvKV9iNla"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.049805,"end_time":"2023-03-22T13:56:34.083722","exception":false,"start_time":"2023-03-22T13:56:34.033917","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We could use the NDWI to estimate the surface water extent. The more images we have available, the more reliable the estimate can be. Examining the satellite images above we observe that not all of the images would be useful, as some of the lake area is covered with clouds. To overcome this limitation and have a denser time series we could rely on synthetic aperture radar observations, for example from the Copernicus Sentinel-1 platform.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZGEkjXNFcq"}],"key":"Y6Z8NGTaUi"}],"visibility":"show","key":"voHp9ETWpO"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.044953,"end_time":"2023-03-22T13:56:34.173811","exception":false,"start_time":"2023-03-22T13:56:34.128858","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sentinel-1 description","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YhUmX1WXH3"}],"identifier":"sentinel-1-description","label":"Sentinel-1 description","html_id":"sentinel-1-description","implicit":true,"key":"kWnGC89m4a"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Like Sentinel-2, Sentinel-1 is also part of the Copernicus programme and collects data globally with a revisit time of 5 days. In contrast to Sentinel-2, Sentinel-1 SAR is an active sensor using SAR signals recording the backscatter. Due to the wavelengths used, SAR is not hindered by clouds and can be operated day and night.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xpkw3rI6AG"}],"key":"sjgUGkOD5z"}],"visibility":"show","key":"lABWeadrqT"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.053337,"end_time":"2023-03-22T13:56:34.278035","exception":false,"start_time":"2023-03-22T13:56:34.224698","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check Sentinel-1 GRD available bands","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cFcbSyLaDe"}],"identifier":"check-sentinel-1-grd-available-bands","label":"Check Sentinel-1 GRD available bands","html_id":"check-sentinel-1-grd-available-bands","implicit":true,"key":"w7MVwLroAB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jjroa0XB4q"}],"key":"zydKmoFSRP"}],"visibility":"show","key":"g7p5dcwq4t"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.083951,"end_time":"2023-03-22T13:56:34.415888","exception":false,"start_time":"2023-03-22T13:56:34.331937","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# List bands for S1-GRD\nSH.band_names('S1GRD')","visibility":"show","key":"DzKHuwoqcA"},{"type":"output","id":"dp7f8L4t3i53gvStukI7E","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"['VV', 'HH', 'VH', 'localIncidenceAngle', 'scatteringArea', 'shadowMask', 'HV']","content_type":"text/plain"}}}],"visibility":"show","key":"VOPQGZw2Yz"}],"visibility":"show","key":"M1RVYkhAKB"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.036057,"end_time":"2023-03-22T13:56:34.492397","exception":false,"start_time":"2023-03-22T13:56:34.456340","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build an xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WXBWtBytLC"}],"identifier":"build-an-xcube","label":"Build an xcube","html_id":"build-an-xcube","implicit":true,"key":"rwfOpUeqes"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ymN2WZ9dfD"}],"key":"KLxkFQ9rgb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"dataset_name","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uW6HdtTd5T"}],"key":"GGSv83i4DG"},{"type":"text","value":": the Sentinel Hub identification of the dataset. Here we will call ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Kj9bwdtkqV"},{"type":"inlineCode","value":"S1GRD","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UKezdyInv9"},{"type":"text","value":" for Sentinel-1 GRD. All available datasets can be listed with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"c5hgq2D6Em"},{"type":"inlineCode","value":"SH.dataset_names","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Us7lrKc4Bw"}],"key":"KJGWQIK3WY"}],"key":"qFnjXas0Yr"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"band_names","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"wCsboQubiJ"}],"key":"RTWteY5RYd"},{"type":"text","value":": the band names to be used in the xcube array (see previous code cell). Here, we will call just the VV polarisation band.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HvqgMZlhAn"}],"key":"QN0yNFb78b"}],"key":"UT4t9GpqOl"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"bbox","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"SoMTlJETsW"}],"key":"SijZ9JQ06w"},{"type":"text","value":": the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesn’t need to be set.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"aNOXWHSghf"}],"key":"FLFk5fOHTj"}],"key":"wo4OIg8yDr"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"spatial_res","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"cmQOkJDpIH"}],"key":"ezzLNRYYGn"},{"type":"text","value":": the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 10 meters, we set the resolution to 0.000089 degrees.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"yHxmstsoKi"}],"key":"SzyF6R9ucb"}],"key":"hDyKNR87zS"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"time_range","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"IMZZDAwdeo"}],"key":"Aqnm2bG8uU"},{"type":"text","value":": a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-1 GRD data is available from February 2015 onwards. In this example, we will fetch data for June 2023 - mid July 2023.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"m9FWRhMW9k"}],"key":"SEnfev1nzZ"}],"key":"MhCAcDxKCS"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"time_tolerance","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fh6UtgBFy6"}],"key":"jGMpemF8H0"},{"type":"text","value":": The tolerance used to identify whether a dataset should still be included within a time period. Here, ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"d39pwPRlJR"},{"type":"inlineCode","value":"30m","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"REJUpyzunE"},{"type":"text","value":" corresponds to 30 minutes, thus avoiding duplicate datasets.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"F9R1eIqDw5"}],"key":"Kt82liui04"}],"key":"qSTRzeE3Nk"}],"key":"sLNsXtmwPz"}],"visibility":"show","key":"cqzczuxXEH"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.093586,"end_time":"2023-03-22T13:56:34.624470","exception":false,"start_time":"2023-03-22T13:56:34.530884","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Setup xcube\ns1_cube_config = CubeConfig(dataset_name='S1GRD',\n                         band_names=['VV'],\n                         bbox=lake_bbox,\n                         spatial_res=0.000089,\n                         time_range=['2023-06-01', '2023-07-16'],\n                         time_tolerance='30m')","visibility":"show","key":"p9EljvtBTv"},{"type":"output","id":"rKzceP70uwxjioNh_gQiL","data":[],"visibility":"show","key":"MjgupiUVHD"}],"visibility":"show","key":"knorIujghL"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.062318,"end_time":"2023-03-22T13:56:34.792948","exception":false,"start_time":"2023-03-22T13:56:34.730630","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open the xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iRNgf5HfuW"}],"identifier":"open-the-xcube","label":"Open the xcube","html_id":"open-the-xcube","implicit":true,"key":"bkB5LH55DH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we open the cube and display its contents. The automatically generated credentials obtained earlier in this Jupyter Notebook are specified as a parameter when opening the cube.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"etUnU9ScXt"}],"key":"y6P96FE4BD"}],"visibility":"show","key":"jAj5NcnW2n"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.482689,"end_time":"2023-03-22T13:56:35.333780","exception":false,"start_time":"2023-03-22T13:56:34.851091","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open cube (on the fly)\ns1_cube = open_cube(s1_cube_config, **sh_credentials)\n\n# Display contents\ns1_cube","visibility":"show","key":"i2A6QOc6Fi"},{"type":"output","id":"n_Ap9g81gZ0dJAHgVhxEi","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/xcube_sh/sentinelhub.py:243: UserWarning: The argument 'infer_datetime_format' is deprecated and will be removed in a future version. A strict version of it is now the default, see https://pandas.pydata.org/pdeps/0004-consistent-to-datetime-parsing.html. You can safely remove this argument.\n  dt = pd.to_datetime(dt,\n/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/xcube_sh/sentinelhub.py:243: UserWarning: The argument 'infer_datetime_format' is deprecated and will be removed in a future version. A strict version of it is now the default, see https://pandas.pydata.org/pdeps/0004-consistent-to-datetime-parsing.html. You can safely remove this argument.\n  dt = pd.to_datetime(dt,\n"},{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"8ba8d77c5701aff0f7d737e348cb777a","path":"/eodashboard-notebooks/build/8ba8d77c5701aff0f7d737e348cb777a.html"},"text/plain":{"content":"\u003cxarray.Dataset\u003e\nDimensions:    (time: 11, lat: 1886, lon: 2122, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 44.71 44.71 44.71 44.71 ... 44.54 44.54 44.54 44.54\n  * lon        (lon) float64 12.09 12.09 12.09 12.09 ... 12.28 12.28 12.28 12.28\n  * time       (time) datetime64[ns] 2023-06-03T05:19:46 ... 2023-07-10T17:06:57\n    time_bnds  (time, bnds) datetime64[ns] dask.array\u003cchunksize=(11, 2), meta=np.ndarray\u003e\nDimensions without coordinates: bnds\nData variables:\n    VV         (time, lat, lon) float32 dask.array\u003cchunksize=(1, 943, 1061), meta=np.ndarray\u003e\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S1GRD Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-07-16T01:25:41.443109\n    time_coverage_start:     2023-06-03T05:19:46+00:00\n    time_coverage_end:       2023-07-10T17:06:57+00:00\n    time_coverage_duration:  P37DT11H47M11S\n    geospatial_lon_min:      12.09\n    geospatial_lat_min:      44.54\n    geospatial_lon_max:      12.278858\n    geospatial_lat_max:      44.707854\n    processing_level:        L1B","content_type":"text/plain"}}}],"visibility":"show","key":"hOMYseFr0j"}],"visibility":"show","key":"C2S4oHBgYp"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.06691,"end_time":"2023-03-22T13:56:35.448035","exception":false,"start_time":"2023-03-22T13:56:35.381125","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualising the water areas using SAR","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xVvbeUsUjF"}],"identifier":"visualising-the-water-areas-using-sar","label":"Visualising the water areas using SAR","html_id":"visualising-the-water-areas-using-sar","implicit":true,"key":"Qqyy4yrJsa"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We are going to use the VV band to visualise the flooding. From our earlier visualisation, we know that the area had some cloud coverage around the date 2023-07-04. We will search for Sentinel-1 acquisitions around that date in order to obtain a denser time series.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"spLH9vvLjc"}],"key":"b8salVQHZZ"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Radar data has very large dynamic range a very imbalanced histogram (\u003e95% of all values are smaller than 1, but the remaining 5 % can be impractically large). Thus, to obtain a visualisation with a better contrast in which the water bodies would be darker and the land pixels would be brighter, it is recommended to convert the data to log-scale.\nTo convert the pixel values from Digital Number to decibels we can mutiply the log10 of each DN pixel by 10. Secondly, as there will be pixels with a value of -inf after this operation, we need to account for this with the second function which will automatically assign 0 to these pixels.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"o4s81iUDPN"}],"key":"XGkrMBgcq0"}],"visibility":"show","key":"WmGD9hu9wv"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.091149,"end_time":"2023-03-22T13:56:35.585478","exception":false,"start_time":"2023-03-22T13:56:35.494329","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Convert VV Digital numbers to Decibels\nvv_dn = s1_cube.VV\nvv_db = 10 * (np.log10(vv_dn))\n\nvv_db = vv_db.where(np.isfinite(vv_db), 0)\n\nvv_db.attrs['long_name']='VV_dB'\nvv_db.attrs['units']='decibels'\n\ns1_cube['VV_dB']= vv_db","visibility":"show","key":"QjtVwRLWMz"},{"type":"output","id":"VxFRWCuTOLx1f8Nqqiyg4","data":[],"visibility":"show","key":"beHjB4SLxU"}],"visibility":"show","key":"RO5zqIJmC0"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.041988,"end_time":"2023-03-22T13:56:35.674910","exception":false,"start_time":"2023-03-22T13:56:35.632922","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Like previously, we are going to visualise the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wBcFjPThHI"},{"type":"inlineCode","value":"VV_dB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"B2JzV2gCC0"},{"type":"text","value":" variable we have just generated for our AOI.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ngy5dAyJcZ"}],"key":"dbsjQRVw4e"}],"visibility":"show","key":"OvllK2TJGN"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":2.356128,"end_time":"2023-03-22T13:56:38.087889","exception":false,"start_time":"2023-03-22T13:56:35.731761","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# select and define the timestamp you want to visualise \nVV_dB_timestamp = s1_cube.VV_dB.sel(time='2023-07-09 10:00:00', method='nearest')\n\n# plot the timestamp\nVV_dB_timestamp.plot.imshow(vmin=-40, vmax=0, cmap='winter', figsize=(10, 10))\n\n# save and display the plot\nplt.show()","visibility":"show","key":"vgH01yT0Be"},{"type":"output","id":"uARM8_BCLmnOyA5D_gzm8","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f4cdc99be519c6d889f687b1af7ad347","path":"/eodashboard-notebooks/build/f4cdc99be519c6d889f687b1af7ad347.png"},"text/plain":{"content":"\u003cFigure size 1000x1000 with 2 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"hZ4dSGaX1i"}],"visibility":"show","key":"vlWdRMAlRj"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.057616,"end_time":"2023-03-22T13:56:38.210574","exception":false,"start_time":"2023-03-22T13:56:38.152958","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This looks very similar to the NDWI we derived earlier showing the water extent fairly clearly (the blue areas). Let’s visualise it over several timestamps to confirm that this is a good variable to use to generate a lake mask.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kYMS8yfaDe"}],"key":"tU8WIW2QGV"}],"visibility":"show","key":"et5OMgXNiN"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":10.261827,"end_time":"2023-03-22T13:56:48.534644","exception":false,"start_time":"2023-03-22T13:56:38.272817","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#### Timestamp selection\nvv1 = s1_cube.VV_dB.sel(time='2023-06-03 10:00:00', method='nearest')\nvv2 = s1_cube.VV_dB.sel(time='2023-06-04 10:00:00', method='nearest')\nvv3 = s1_cube.VV_dB.sel(time='2023-06-15 10:00:00', method='nearest')\nvv4 = s1_cube.VV_dB.sel(time='2023-06-27 10:00:00', method='nearest')\nvv5 = s1_cube.VV_dB.sel(time='2023-07-09 10:00:00', method='nearest')\nvv6 = s1_cube.VV_dB.sel(time='2023-07-10 10:00:00', method='nearest')\n\n# Plot \nf = plt.figure(figsize=[16,11])\nax1 = f.add_subplot(2,3, 1)\nax2 = f.add_subplot(2,3, 2)\nax3 = f.add_subplot(2,3, 3)\nax4 = f.add_subplot(2,3, 4)\nax5 = f.add_subplot(2,3, 5)\nax6 = f.add_subplot(2,3, 6)\n\naxlist=[ax1,ax2,ax3,ax4,ax5,ax6]\n\nt = vv1.plot.imshow(ax=ax1, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv2.plot.imshow(ax=ax2, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv3.plot.imshow(ax=ax3, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv4.plot.imshow(ax=ax4, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv5.plot.imshow(ax=ax5, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv6.plot.imshow(ax=ax6, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\n\ncbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])\nf.colorbar(t, cax=cbar_ax, label=\"VV dB\")\n\nplt.show()","visibility":"show","key":"PPWqqbTxjc"},{"type":"output","id":"EGkrALTDMfmQksjNHe0RW","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"62875b2a4a6b3f4ca44b6bc5ce31a391","path":"/eodashboard-notebooks/build/62875b2a4a6b3f4ca44b6bc5ce31a391.png"},"text/plain":{"content":"\u003cFigure size 1600x1100 with 7 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"jlxzWmNLqZ"}],"visibility":"show","key":"CuNdQD5yxl"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.10006,"end_time":"2023-03-22T13:56:48.779497","exception":false,"start_time":"2023-03-22T13:56:48.679437","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Depending on the local conditions (e.g. terrain orientation, slope) and weather conditions, optical or radar imagery may be more useful. In this case both types of observations seem to provide a good view of the water surface area extent.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dweJOn6Yy0"}],"key":"v5CZQQK6ZG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Next we will generate a flood mask using a threshold.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jt65OCjWuw"}],"key":"mso4bSWRvM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"for SAR images, generally, as a good rule of thumb, in the VV band, values below -20 dB are usually surface water. We will try this value first, but we will also look to visualise how the flood mask changes if we adjust the threshold value.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"FZhjsEI9qY"}],"key":"CGnFrWXeoU"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"observing the NDWI range of values, we can chose values above 0.25 to correspond to the water class.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZOgQo1eKxN"}],"key":"DBPtwqt08r"}],"key":"LBiPHLxk9I"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"First, let’s generate the new variable using the ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"EQY1qKJIGq"},{"type":"inlineCode","value":".where","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rjl7qHBURW"},{"type":"text","value":" function in xarray.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BBwCvoizzA"}],"key":"zMezt5L3nr"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"At first glance, the below cell may not make much sense. It may read that the step 1 function as assigning a value of 1 to pixels in VV_dB that are equal or more than -20. However, what is actually happening is that the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Y9WPnmyCSM"},{"type":"inlineCode","value":".where","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"K7vt1KGJqm"},{"type":"text","value":" function preserves all the pixel values in the variable that are below -20 and assigns everything else a value of 1. More can be found in the xarray documentation ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"B0VOnshi2b"},{"type":"link","url":"http://xarray.pydata.org/en/stable/generated/xarray.DataArray.where.html","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"http://​xarray​.pydata​.org​/en​/stable​/generated​/xarray​.DataArray​.where​.html","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"oRgVvLzvVg"}],"urlSource":"http://xarray.pydata.org/en/stable/generated/xarray.DataArray.where.html","key":"mQk6WoPl3m"}],"key":"TdvibzKwLU"}],"visibility":"show","key":"EFhuqZljv8"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.115588,"end_time":"2023-03-22T13:56:48.973037","exception":false,"start_time":"2023-03-22T13:56:48.857449","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# mask the Sentinel-1 data\n\n# Assign all pixels equal or smaller than -20 a value of 1 and preserve the values of all other pixels \nstep1 = s1_cube.VV_dB.where(s1_cube.VV_dB \u003e -20, 1)\n\n# Assign all other pixels a value of 0. \nwater = step1.where(step1 == 1, 0)\n\nwater.attrs['long_name'] ='water'\nwater.attrs['units'] ='nounits'\n\ns1_cube['water'] = water","visibility":"show","key":"IgzBnKEqko"},{"type":"output","id":"Pds9_QSIvQX1L1U5CGjJu","data":[],"visibility":"show","key":"TFmDKpNnrH"}],"visibility":"show","key":"HdG0cUVAgs"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.075002,"end_time":"2023-03-22T13:56:49.125841","exception":false,"start_time":"2023-03-22T13:56:49.050839","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next let’s see what happens to the mask extent if we change the threshold to -15 dB and -25dB:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f8Yqr8yWF2"}],"key":"sF5qHJxLwj"}],"visibility":"show","key":"iKNaDJxv0C"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.149665,"end_time":"2023-03-22T13:56:49.346363","exception":false,"start_time":"2023-03-22T13:56:49.196698","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Sentinel-1\nwater_threshold1_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB \u003e -15, 1)\nwater_threshold2_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB \u003e -20, 1)\nwater_threshold3_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB \u003e -25, 1)\n\nwater_threshold1_step2 = water_threshold1_step1.where(water_threshold1_step1 == 1, 0)\nwater_threshold2_step2 = water_threshold2_step1.where(water_threshold2_step1 == 1, 0)\nwater_threshold3_step2 = water_threshold3_step1.where(water_threshold3_step1 == 1, 0)\n\nwater_threshold1 = water_threshold1_step2.sel(time='2023-06-15 10:00:00', method='nearest')\nwater_threshold2 = water_threshold2_step2.sel(time='2023-06-15 10:00:00', method='nearest')\nwater_threshold3 = water_threshold3_step2.sel(time='2023-06-15 10:00:00', method='nearest')","visibility":"show","key":"joC9YkmNyU"},{"type":"output","id":"brf0nWoo1dmZRfL7cbQ6C","data":[],"visibility":"show","key":"TrtmumBJfG"}],"visibility":"show","key":"Mamf7PvKGR"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.0819,"end_time":"2023-03-22T13:56:49.513732","exception":false,"start_time":"2023-03-22T13:56:49.431832","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we will plot the new thresholds we want to test:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TpKx0ePA7V"}],"key":"DrfzcK3bfB"}],"visibility":"show","key":"AT2WtvHKB7"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":1.651152,"end_time":"2023-03-22T13:56:51.257434","exception":false,"start_time":"2023-03-22T13:56:49.606282","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot \nf = plt.figure(figsize=[20,12])\nax1 = f.add_subplot(2,3, 1)\nax2 = f.add_subplot(2,3, 2)\nax3 = f.add_subplot(2,3, 3)\n\nwater_threshold1.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nwater_threshold2.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nwater_threshold3.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\n\nplt.show()","visibility":"show","key":"GWewTvvpag"},{"type":"output","id":"xyCwf3TQp-hYzHJdbci1e","data":[{"name":"stderr","output_type":"stream","text":"/home/conda/users/52c397debe78d7686aa36bd394f6f113e95009637029c5b71995fe48a567dcd4-20230418-061740-771350-145-edc-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"eab410d2bfcf4a0487be86e4bb7d64d8","path":"/eodashboard-notebooks/build/eab410d2bfcf4a0487be86e4bb7d64d8.png"},"text/plain":{"content":"\u003cFigure size 2000x1200 with 3 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"xH2cqdbcBe"}],"visibility":"show","key":"fxIABUe4Aa"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.115588,"end_time":"2023-03-22T13:56:48.973037","exception":false,"start_time":"2023-03-22T13:56:48.857449","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# mask the Sentinel-2 data\n\n# Assign all pixels equal or larger than 0.25 a value of 1 and preserve the values of pixels \nstep11 = ndwi1.where(ndwi1 \u003c 0.25, 1)\n\n# Assign all other pixels a value of 0. \nwater1 = step1.where(step1 == 1, 0)\n\nwater1.attrs['long_name'] ='water'\nwater1.attrs['units'] ='nounits'\n\ns2_cube['water'] = water1","visibility":"show","key":"IzrAm8hOOS"},{"type":"output","id":"bDU0L4ksyozOAAYwagrnP","data":[],"visibility":"show","key":"TPuAz9t0h2"}],"visibility":"show","key":"ErjUFrPn8v"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.149665,"end_time":"2023-03-22T13:56:49.346363","exception":false,"start_time":"2023-03-22T13:56:49.196698","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Sentinel-2\nwater_threshold1_step11 = ndwi1.where(ndwi1 \u003c 0.15, 1)\nwater_threshold2_step11 = ndwi1.where(ndwi1 \u003c 0.25, 1)\nwater_threshold3_step11 = ndwi1.where(ndwi1 \u003c 0.30, 1)\n\nwater_threshold1_step21 = water_threshold1_step11.where(water_threshold1_step11 == 1, 0)\nwater_threshold2_step21 = water_threshold2_step11.where(water_threshold2_step11 == 1, 0)\nwater_threshold3_step21 = water_threshold3_step11.where(water_threshold3_step11 == 1, 0)\n\nwater_threshold11 = water_threshold1_step21\nwater_threshold21 = water_threshold2_step21\nwater_threshold31 = water_threshold3_step21","visibility":"show","key":"RgyWQUNdg1"},{"type":"output","id":"gtncCKmphka0uB1dO7VQQ","data":[],"visibility":"show","key":"IQ4wQaz357"}],"visibility":"show","key":"YqKi9BNZjH"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":1.651152,"end_time":"2023-03-22T13:56:51.257434","exception":false,"start_time":"2023-03-22T13:56:49.606282","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot \nf = plt.figure(figsize=[20,12])\nax1 = f.add_subplot(2,3, 1)\nax2 = f.add_subplot(2,3, 2)\nax3 = f.add_subplot(2,3, 3)\n\nwater_threshold11.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nwater_threshold21.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nwater_threshold31.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\n\nplt.show()","visibility":"show","key":"jACM9ExMnL"},{"type":"output","id":"7IL80duQd8vdf3gI6N4Zg","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b1e1cbcb33de4a107bd3fe9027ef03c9","path":"/eodashboard-notebooks/build/b1e1cbcb33de4a107bd3fe9027ef03c9.png"},"text/plain":{"content":"\u003cFigure size 2000x1200 with 3 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"NB4jit2sHw"}],"visibility":"show","key":"emYTfCF7Bz"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.125311,"end_time":"2023-03-22T13:56:51.505250","exception":false,"start_time":"2023-03-22T13:56:51.379939","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Observe the differences in the water mask due to the threshold.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fgchrWCYca"}],"key":"HGM4j1craG"}],"visibility":"show","key":"mXQQjfnCCG"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.089827,"end_time":"2023-03-22T13:59:05.432985","exception":false,"start_time":"2023-03-22T13:59:05.343158","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Estimating the surface water area extent","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Vqzq8iIzAE"}],"identifier":"estimating-the-surface-water-area-extent","label":"Estimating the surface water area extent","html_id":"estimating-the-surface-water-area-extent","implicit":true,"key":"rIF9zSqZfz"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Let’s estimate the area covered by water during the time period we are examining.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"fJz8O14xZE"}],"key":"slzSpvs4eV"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We can also estimate which is the area that is most covered by water by dividing the sum of the water pixels by the number of timesteps in the data cube (the count).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CR4XZJR1xM"}],"key":"uhiI2tEIRt"}],"visibility":"show","key":"JYekDOugk3"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":0.148218,"end_time":"2023-03-22T13:59:05.666548","exception":false,"start_time":"2023-03-22T13:59:05.518330","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# previously we only kept 1 time step when we selected ndwi1\n# now we want to keep the full datacube in order to average in time\n\n# Assign all pixels equal or larger than 0.25 a value of 1 and preserve the values of all other pixels \nstep1 = s2_cube.NDWI.where(s2_cube.NDWI \u003c 0.25, 1)\n\n# Assign all other pixels a value of 0. \nwater = step1.where(step1 == 1, 0)\n\nwater.attrs['long_name'] ='water'\nwater.attrs['units'] ='nounits'\n\ns2_cube['water'] = water\n\n\nwater_sum = s2_cube.NDWI.sum(dim=\"time\")\nwater_count = s2_cube.NDWI.count(dim=\"time\")\nwater_average = water_sum / water_count\n\n\nwater_average.attrs['long_name']='water area'\nwater_average.attrs['units']='nounits'\n\nndwi['water_average']= water_average","visibility":"show","key":"ncg1KPARmy"},{"type":"output","id":"iI2PmvcWtrly0HIfT36ek","data":[],"visibility":"show","key":"bJMyKBoBkr"}],"visibility":"show","key":"qEWKuTXHQj"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.091074,"end_time":"2023-03-22T13:59:05.866773","exception":false,"start_time":"2023-03-22T13:59:05.775699","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now let’s plot the water_average into a plot:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VGG2o292pH"}],"key":"v86TMleMLe"}],"visibility":"show","key":"HwP2c4J2wJ"},{"type":"block","kind":"notebook-code","data":{"papermill":{"duration":3.655907,"end_time":"2023-03-22T13:59:09.645795","exception":false,"start_time":"2023-03-22T13:59:05.989888","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"water_average.plot.imshow(cmap='GnBu', vmin=0, vmax=0.5, figsize=(10, 10))\n\nplt.tight_layout()\n\n#expport to png\nplt.savefig('figure.png')\n\nplt.show()","visibility":"show","key":"Rh2pbbsWia"},{"type":"output","id":"RLQfIA0AG25WJmY46oDRd","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"db96fdbcbad016dc19d903cecc1b3010","path":"/eodashboard-notebooks/build/db96fdbcbad016dc19d903cecc1b3010.png"},"text/plain":{"content":"\u003cFigure size 1000x1000 with 2 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"B8293exdKT"}],"visibility":"show","key":"qX227ib1DD"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.111844,"end_time":"2023-03-22T13:59:09.880140","exception":false,"start_time":"2023-03-22T13:59:09.768296","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This looks great, we have identified the lake area very clearly here and can also observe how the lake may change in size over time.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GBOI61Qn1w"}],"key":"SSnJuFJOjA"}],"visibility":"show","key":"q10MhbhST5"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Access environmental variables and other datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UDVEUHjBmh"}],"identifier":"access-environmental-variables-and-other-datasets","label":"Access environmental variables and other datasets","html_id":"access-environmental-variables-and-other-datasets","implicit":true,"key":"njhG21t9wG"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I64NZX8Dq2"},{"type":"link","url":"https://nbviewer.hub.eox.at/notebooks/eurodatacube/notebooks/curated/EDC_xcube_generator_service.ipynb","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Notebook","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Q34G2QJYJL"}],"urlSource":"https://nbviewer.hub.eox.at/notebooks/eurodatacube/notebooks/curated/EDC_xcube_generator_service.ipynb","key":"mIL2smrt9O"},{"type":"text","value":" demonstrates how to:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G6n96h2GRL"}],"key":"zxSP9fX9eg"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"request data from selected Copernicus Services,\nrequest data from Copernicus Climate Data Store,\nrequest data from ESA Climate Change Initiative.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uVYsqWC0dV"}],"key":"gaArOfStIl"}],"key":"CIsQhAmpIu"}],"key":"EeThipha3Z"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Evaluation of Fire Impact on Populated Areas on a European Site","url":"/notebooks/fire-impact-analysis","group":"Notebooks"},"next":{"title":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel","url":"/notebooks/openchallengenotebook-c1-jessel-hezzi-roussel","group":"Notebooks"}}},"domain":"http://localhost:3000"},"project":{"subject":"Notebook examples","title":"EO Dashboard Notebooks","description":"Collection of examples relevant to the EO Dashboard project","github":"https://github.com/ESA-eodashboards/eodashboard-notebooks","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"slug":"notebooks.fire-impact-analysis","title":"Evaluation of Fire Impact on Populated Areas on a European Site","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/22a5ee1ff975cb9c3eb3b1e899bb858e.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.inland-water-with-edc","title":"Exploring Inland Water Bodies with Sentinel-2 data in EDC","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.openchallengenotebook-c1-jessel-hezzi-roussel","title":"Earth System Science Open Challenge 1: L. Jessel, S. Hezzi, M. Roussel","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/49e045ccedfe842015ba44cc25ccb377.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.veda-api-bids-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/5d71b8fb32fb3d611031d0ea697e5422.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"title":"Nightlights Notebook","level":2},{"slug":"notebooks.nightlights-notebook.night-lights-blending","title":"Monitoring socio-economic activities with nighttime light maps","description":"","date":"","thumbnail":"/eodashboard-notebooks/build/nighttime_northeaste-aa3818443fbc1f19a6259ceb482d2f4b.jpg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/eodashboard-notebooks/build/manifest-2671EB98.js";
import * as route0 from "/eodashboard-notebooks/build/root-LMCDRB6W.js";
import * as route1 from "/eodashboard-notebooks/build/routes/$-SJYMRUNJ.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/eodashboard-notebooks/build/entry.client-UNPC4GT3.js");</script></body></html>